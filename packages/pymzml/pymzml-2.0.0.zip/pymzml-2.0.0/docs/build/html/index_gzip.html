

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>4.1. Writing and Reading igzip files &mdash; pymzML 2.0.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="pymzML 2.0.0 documentation" href="index.html"/>
        <link rel="up" title="4. Examples and Advanced Usage" href="examples.html"/>
        <link rel="next" title="4.6. Implementing an own file class" href="custom_fileclass.html"/>
        <link rel="prev" title="4. Examples and Advanced Usage" href="examples.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> pymzML
          

          
          </a>

          
            
            
              <div class="version">
                2.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">2. Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">3. pymzML module content</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="examples.html">4. Examples and Advanced Usage</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.1. Writing and Reading igzip files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generalized-seekable-index-gzip-writer">4.2. Generalized Seekable index Gzip Writer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generalized-seekable-index-gzip-reader">4.3. Generalized Seekable index Gzip Reader</a></li>
<li class="toctree-l2"><a class="reference internal" href="#practical-example-moby-dick">4.4. Practical Example: Moby Dick</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creating-the-compressed-file">4.4.1. Creating the compressed file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#accessing-the-data">4.4.2. Accessing the data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#igzip-file-format-specification">4.5. igzip file format specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="custom_fileclass.html">4.6. Implementing an own file class</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_scripts.html">4.7. Example Scripts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pymzml_utils.html">3.3. Utils</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">pymzML</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
          <li><a href="examples.html">4. Examples and Advanced Usage</a> &raquo;</li>
      
    <li>4.1. Writing and Reading igzip files</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/index_gzip.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="writing-and-reading-igzip-files">
<h1>4.1. Writing and Reading igzip files<a class="headerlink" href="#writing-and-reading-igzip-files" title="Permalink to this headline">¶</a></h1>
<p>One key feature of pymzML is the ability to write and read indexed gzip files.
The utils module contains a script to easily convert plain or gzipped mzML files into indexed gzip files.
However, the <a class="reference internal" href="pymzml_utils.html#pymzml.utils.GSGW.GSGW" title="pymzml.utils.GSGW.GSGW"><code class="xref py py-func docutils literal"><span class="pre">GSGW()</span></code></a> and <a class="reference internal" href="pymzml_utils.html#pymzml.utils.GSGR.GSGR" title="pymzml.utils.GSGR.GSGR"><code class="xref py py-func docutils literal"><span class="pre">GSGR()</span></code></a> class can be used to index any type of data.
After these two classes have been introduced, a small example of how to use them for other data than mzML can be found.</p>
</div>
<div class="section" id="generalized-seekable-index-gzip-writer">
<h1>4.2. Generalized Seekable index Gzip Writer<a class="headerlink" href="#generalized-seekable-index-gzip-writer" title="Permalink to this headline">¶</a></h1>
<p>Please refer to <a class="reference internal" href="pymzml_utils.html#pymzml.utils.GSGW.GSGW" title="pymzml.utils.GSGW.GSGW"><code class="xref py py-func docutils literal"><span class="pre">GSGW()</span></code></a> for further information.</p>
</div>
<div class="section" id="generalized-seekable-index-gzip-reader">
<h1>4.3. Generalized Seekable index Gzip Reader<a class="headerlink" href="#generalized-seekable-index-gzip-reader" title="Permalink to this headline">¶</a></h1>
<p>Please refer to <a class="reference internal" href="pymzml_utils.html#pymzml.utils.GSGR.GSGR" title="pymzml.utils.GSGR.GSGR"><code class="xref py py-func docutils literal"><span class="pre">GSGR()</span></code></a> for further information.</p>
</div>
<div class="section" id="practical-example-moby-dick">
<h1>4.4. Practical Example: Moby Dick<a class="headerlink" href="#practical-example-moby-dick" title="Permalink to this headline">¶</a></h1>
<div class="section" id="creating-the-compressed-file">
<h2>4.4.1. Creating the compressed file<a class="headerlink" href="#creating-the-compressed-file" title="Permalink to this headline">¶</a></h2>
<p>To utilze <a class="reference internal" href="pymzml_utils.html#pymzml.utils.GSGW.GSGW" title="pymzml.utils.GSGW.GSGW"><code class="xref py py-func docutils literal"><span class="pre">GSGW()</span></code></a> for other data, one simply needs to parse the data blockwise, so every piece of data, which should be accessible by indexing is written in one go. The index used can be either an integer or a string.
The code example below parses each chapter of moby dick and indexes it with its corresponding chapter number.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">index_by_chapter</span><span class="p">(</span><span class="n">txt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterate the text file while collecting the data for each chapter and compressing it</span>

<span class="sd">    Args:</span>
<span class="sd">        txt(str): Moby Dick text as string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">chapter_start</span> <span class="o">=</span> <span class="n">regex_patterns</span><span class="o">.</span><span class="n">MOBY_DICK_CHAPTER_PATTERN</span>
    <span class="n">general_seekable_gzip_writer</span> <span class="o">=</span> <span class="n">GSGW</span><span class="p">(</span>
        <span class="n">file</span>        <span class="o">=</span> <span class="s1">&#39;Moby_Dick_indexed.gz&#39;</span><span class="p">,</span>
        <span class="n">max_idx</span>     <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">max_idx_len</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">output_path</span> <span class="o">=</span> <span class="s1">&#39;./Moby_Dick_indexed.gz&#39;</span>
    <span class="p">)</span>

    <span class="k">with</span> <span class="n">general_seekable_gzip_writer</span> <span class="k">as</span> <span class="n">index_writer</span><span class="p">:</span>
        <span class="n">current_chapter</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">txt</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">chapter_start</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">chapter_start</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                <span class="n">current_chapter_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s1">&#39;indexing chapter </span><span class="si">{0}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">current_chapter_number</span>
                    <span class="p">),</span>
                    <span class="n">end</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span>
                <span class="p">)</span>
                <span class="n">index_writer</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">current_chapter</span><span class="p">,</span> <span class="n">current_chapter_number</span><span class="p">)</span>
                <span class="n">current_chapter</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">current_chapter</span> <span class="o">+=</span> <span class="n">line</span>
        <span class="n">current_chapter_number</span>  <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">index_writer</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">current_chapter</span><span class="p">,</span> <span class="n">current_chapter_number</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s1">&#39;index chapter </span><span class="si">{0}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">current_chapter_number</span>
            <span class="p">),</span>
            <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span>
        <span class="p">)</span>
        <span class="n">index_writer</span><span class="o">.</span><span class="n">write_index</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Indexed </span><span class="si">{0}</span><span class="s1"> chapters&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current_chapter_number</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="accessing-the-data">
<h2>4.4.2. Accessing the data<a class="headerlink" href="#accessing-the-data" title="Permalink to this headline">¶</a></h2>
<p>In order to access the chapter in the compressed file, one simply needs to initialize the <a class="reference internal" href="pymzml_utils.html#pymzml.utils.GSGR.GSGR" title="pymzml.utils.GSGR.GSGR"><code class="xref py py-func docutils literal"><span class="pre">GSGR()</span></code></a> with the path to the created file and can access the chapters conveniently by the python bracket notation ([]).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">GSGR</span> <span class="k">import</span> <span class="n">GSGR</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">my_Reader</span> <span class="o">=</span> <span class="n">GSGR</span><span class="p">(</span><span class="s1">&#39;./Moby_Dick_indexed.gz&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">__doc__</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">chap_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Reading indexed gzip and retrieving chapter {0}</span>
<span class="sd">            &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chap_num</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Chapter {0} Took {1:.5f} seconds to retrieve chapter</span>
<span class="sd">            &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">my_Reader</span><span class="o">.</span><span class="n">read_block</span><span class="p">(</span><span class="n">chap_num</span><span class="p">),</span>
                <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">=</span> <span class="n">s</span>
            <span class="p">)</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="igzip-file-format-specification">
<h1>4.5. igzip file format specification<a class="headerlink" href="#igzip-file-format-specification" title="Permalink to this headline">¶</a></h1>
<p>In the following, the changes from igzip to gzip will be discussed.
If one fieldentry requires more than 1 byte, the byte count in indicated in brackets (capital x for arbitrary byte count)</p>
<p>For further information on the gzip format, see <a class="reference external" href="https://tools.ietf.org/html/rfc1952">https://tools.ietf.org/html/rfc1952</a> .</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="13%" />
<col width="10%" />
<col width="13%" />
<col width="30%" />
<col width="13%" />
<col width="10%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>ID1</td>
<td>ID2</td>
<td>CM</td>
<td>FLG</td>
<td>MTIME (x4)</td>
<td>XFL</td>
<td>OS</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>COMPRESSED BLOCKS</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="12%" />
<col width="12%" />
<col width="15%" />
<col width="12%" />
<col width="12%" />
<col width="12%" />
<col width="15%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td colspan="4">CRC32 (x4)</td>
<td colspan="4">ISIZE (x4)</td>
</tr>
</tbody>
</table>
<p>by setting the &#8216;Comment Flag&#8217; in FLG, an additional headerfield can be activated.</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>file comment, zero-terminated (xX)</td>
</tr>
</tbody>
</table>
<p>This field is then used to save the Uniq IDs, version, number of entries, index/offset length and index/offset pairs  and is terminated with a zero byte, like described in the following:</p>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="10%" />
<col width="18%" />
<col width="16%" />
<col width="22%" />
<col width="25%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>ID1</td>
<td>ID2</td>
<td>VERSION</td>
<td>IDXLEN</td>
<td>OFFSETLEN</td>
<td>ENTRYNUMBER</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Index (xX)</td>
<td>Offset (xX)</td>
</tr>
</tbody>
</table>
<p>...</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>x00</td>
</tr>
</tbody>
</table>
<p>The length of the ID and the offset field can be set when initializing the gzip writer, along with the maximal number of ID/offset pairs.</p>
<span class="target" id="module-pymzml.utils"></span></div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="custom_fileclass.html" class="btn btn-neutral float-right" title="4.6. Implementing an own file class" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="examples.html" class="btn btn-neutral" title="4. Examples and Advanced Usage" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Kösters, M., Leufken, J., Schulze, S., Sugimoto, K., Zahedi, R. P., Hippler, M., Leidel, S. A. and Fufezan, C..

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>