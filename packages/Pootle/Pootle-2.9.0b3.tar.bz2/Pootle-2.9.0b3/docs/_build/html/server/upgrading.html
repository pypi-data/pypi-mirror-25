
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Upgrading &#8212; Pootle 2.9.0b3 documentation</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.9.0b3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/bootstrap.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Administering a server" href="index.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
  </head>
  <body>
  <div id="navbar" class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container-fluid">
        <a class="brand" href="../index.html">Pootle</a>
        <span class="navbar-text pull-left"><b>2.9</b></span>
          <ul class="nav">
            <li class="divider-vertical"></li>
            
              <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../features/index.html">Features</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Upgrading</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Administering a server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/index.html">Developers</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions (FAQ)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../releases/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>
</ul>
</li>
              
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">Upgrading</a><ul>
<li><a class="reference internal" href="#stop-your-running-pootle">Stop your running Pootle</a></li>
<li><a class="reference internal" href="#backup-your-system">Backup your system</a></li>
<li><a class="reference internal" href="#migrate-your-database">Migrate your database</a></li>
<li><a class="reference internal" href="#latest-changes">Latest changes</a></li>
<li><a class="reference internal" href="#check-pootle-requirements">Check Pootle requirements</a></li>
<li><a class="reference internal" href="#activate-virtualenv">Activate virtualenv</a></li>
<li><a class="reference internal" href="#update-pip-and-setuptools">Update pip and setuptools</a></li>
<li><a class="reference internal" href="#upgrading-from-a-version-older-than-2-6">Upgrading from a version older than 2.6</a></li>
<li><a class="reference internal" href="#clean-up-stale-python-bytecode">Clean up stale Python bytecode</a></li>
<li><a class="reference internal" href="#upgrading-from-version-2-6-x-or-later">Upgrading from version 2.6.x or later</a></li>
<li><a class="reference internal" href="#update-and-check-your-settings">Update and check your settings</a></li>
<li><a class="reference internal" href="#start-an-rq-worker">Start an RQ Worker</a></li>
<li><a class="reference internal" href="#review-your-database-configuration">Review your database configuration</a></li>
<li><a class="reference internal" href="#migrate-your-database-schema">Migrate your database schema</a></li>
<li><a class="reference internal" href="#refreshing-checks">Refreshing checks</a></li>
<li><a class="reference internal" href="#refreshing-scores">Refreshing scores</a></li>
<li><a class="reference internal" href="#drop-cached-snippets">Drop cached snippets</a></li>
<li><a class="reference internal" href="#set-up-users">Set up users</a></li>
<li><a class="reference internal" href="#next-steps">Next steps</a></li>
</ul>
</li>
</ul>
</ul>
</li>
            
            
              
  <li><a href="installation.html"
         title="previous chapter">&laquo; Installation</a></li>
  <li><a href="index.html"
         title="next chapter">Administering a server &raquo;</a></li>
            
          </ul>
          <ul class="nav pull-right">
            
              
            
          
            
<form class="navbar-search pull-right" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
          </ul>
        </div>
      </div>
    </div>
  </div>

<div class="container content">
   
  <div class="section" id="upgrading">
<span id="id1"></span><h1>Upgrading<a class="headerlink" href="#upgrading" title="Permalink to this headline">¶</a></h1>
<p>These are the instructions for upgrading Pootle from an older version to the
current release.</p>
<div class="section" id="stop-your-running-pootle">
<span id="upgrading-stop-pootle"></span><h2>Stop your running Pootle<a class="headerlink" href="#stop-your-running-pootle" title="Permalink to this headline">¶</a></h2>
<p>Stop your running Pootle while you upgrade to prevent updates to your data
during the migration process. If you have RQ workers running stop those also.</p>
</div>
<div class="section" id="backup-your-system">
<span id="upgrading-system-backup"></span><h2>Backup your system<a class="headerlink" href="#backup-your-system" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Before upgrading we <strong>strongly</strong> recommend that you
<a class="reference internal" href="backup.html#backup"><span class="std std-ref">backup your current system</span></a>.</p>
</div>
</div>
<div class="section" id="migrate-your-database">
<span id="upgrading-db-migration"></span><h2>Migrate your database<a class="headerlink" href="#migrate-your-database" title="Permalink to this headline">¶</a></h2>
<p>If you are currently using SQLite for your database you will need to
<a class="reference internal" href="database_migration.html"><span class="doc">migrate to either MySQL (InnoDB) or PostgreSQL</span></a>
before you upgrade.</p>
</div>
<div class="section" id="latest-changes">
<span id="upgrading-latest-changes"></span><h2>Latest changes<a class="headerlink" href="#latest-changes" title="Permalink to this headline">¶</a></h2>
<p>Before upgrading Pootle familiarize yourself with <a class="reference internal" href="../releases/index.html"><span class="doc">important changes</span></a> since the version that you are upgrading from.</p>
</div>
<div class="section" id="check-pootle-requirements">
<span id="upgrading-requirements"></span><h2>Check Pootle requirements<a class="headerlink" href="#check-pootle-requirements" title="Permalink to this headline">¶</a></h2>
<p>You should check that you have all of the necessary <a class="reference internal" href="requirements.html#requirements"><span class="std std-ref">Pootle requirements</span></a> and have installed all required <a class="reference internal" href="requirements.html#requirements-packages"><span class="std std-ref">system packages</span></a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Pootle 2.7.0 or newer requires <strong>Python 2.7</strong></p>
<p class="last">If you are upgrading from a virtual environment using an earlier Python
version, you <strong>must</strong> upgrade or rebuild your virtual environment first.</p>
</div>
</div>
<div class="section" id="activate-virtualenv">
<span id="upgrading-activte-virtualenv"></span><h2>Activate virtualenv<a class="headerlink" href="#activate-virtualenv" title="Permalink to this headline">¶</a></h2>
<p>These instructions assume that you are using <strong class="command">virtualenv</strong> and you have
activated a virtual environment named <code class="docutils literal"><span class="pre">env</span></code> as follows:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">source</span> env/bin/activate
<span class="gp">(env) $</span>
</pre></div>
</div>
</div>
<div class="section" id="update-pip-and-setuptools">
<span id="upgrading-update-pip-setuptools"></span><h2>Update pip and setuptools<a class="headerlink" href="#update-pip-and-setuptools" title="Permalink to this headline">¶</a></h2>
<p>You should now upgrade <strong class="command">pip</strong> and <strong class="command">setuptools</strong> to the latest
version:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(env) $</span> pip install --upgrade pip setuptools
</pre></div>
</div>
</div>
<div class="section" id="upgrading-from-a-version-older-than-2-6">
<span id="upgrading-upgrading-2-6"></span><h2>Upgrading from a version older than 2.6<a class="headerlink" href="#upgrading-from-a-version-older-than-2-6" title="Permalink to this headline">¶</a></h2>
<p>If you are upgrading from a version older than 2.6 you will need to first
upgrade to the latest 2.6.x version and then you will be able to upgrade to the
latest version.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(env) $</span> pip install --upgrade <span class="s2">&quot;Pootle&gt;=2.6,&lt;2.7&quot;</span>
<span class="gp">(env) $</span> pootle setup
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>The 2.6.x releases are meant only as a migration step.</p>
<p class="last">You must upgrade immediately to the latest version once setup has
completed.</p>
</div>
</div>
<div class="section" id="clean-up-stale-python-bytecode">
<span id="upgrading-clean-bytecode"></span><h2>Clean up stale Python bytecode<a class="headerlink" href="#clean-up-stale-python-bytecode" title="Permalink to this headline">¶</a></h2>
<p>You should remove any stale Python bytecode files before upgrading.</p>
<p>Assuming you are in the root of your virtualenv folder you can run:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(env) $</span> pyclean .
</pre></div>
</div>
</div>
<div class="section" id="upgrading-from-version-2-6-x-or-later">
<span id="upgrading-upgrading-latest"></span><h2>Upgrading from version 2.6.x or later<a class="headerlink" href="#upgrading-from-version-2-6-x-or-later" title="Permalink to this headline">¶</a></h2>
<p>Upgrade to the latest Pootle version:</p>
<pre class="literal-block">
(env) $ pip install --pre --process-dependency-links --upgrade Pootle
</pre>
</div>
<div class="section" id="update-and-check-your-settings">
<span id="upgrading-check-settings"></span><h2>Update and check your settings<a class="headerlink" href="#update-and-check-your-settings" title="Permalink to this headline">¶</a></h2>
<p>You should now update your custom Pootle settings to add, remove or adjust any
settings that have changed. You may want to view the latest
<a class="reference internal" href="settings.html#settings-available"><span class="std std-ref">available settings</span></a>.</p>
<p>You can check to see if there are any issues with your configuration
settings that need to be resolved:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(env) $</span> pootle check
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you are upgrading from a version of Pootle that uses
<code class="file docutils literal"><span class="pre">localsettings.py</span></code> then you may want to merge your old custom settings
with your <a class="reference internal" href="settings.html#settings-customizing"><span class="std std-ref">settings conf file</span></a> (default location
<code class="file docutils literal"><span class="pre">~/.pootle/pootle.conf</span></code>).</p>
</div>
</div>
<div class="section" id="start-an-rq-worker">
<span id="upgrading-start-rq"></span><h2>Start an RQ Worker<a class="headerlink" href="#start-an-rq-worker" title="Permalink to this headline">¶</a></h2>
<p>Statistics tracking and various other background processes are managed by <a class="reference external" href="http://python-rq.org/">RQ</a>.  The <code class="xref std std-djadmin docutils literal"><span class="pre">rqworker</span></code> command needs to be run
continuously in order to process the jobs.</p>
<p>If you have not already done so you should
<a class="reference internal" href="requirements.html#requirements-packages"><span class="std std-ref">install and start a Redis server</span></a>.</p>
<p>You can start the worker in the background with the following command:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(env) $</span> pootle rqworker <span class="p">&amp;</span>
</pre></div>
</div>
<p>In a production environment you may want to <a class="reference internal" href="web.html#pootle-running-as-a-service"><span class="std std-ref">run RQ workers as services</span></a>.</p>
<p>See here for <a class="reference internal" href="rq.html#rq"><span class="std std-ref">further information about RQ jobs in Pootle</span></a>.</p>
</div>
<div class="section" id="review-your-database-configuration">
<span id="upgrading-review-database"></span><h2>Review your database configuration<a class="headerlink" href="#review-your-database-configuration" title="Permalink to this headline">¶</a></h2>
<p>Review the <a class="reference internal" href="mysql_installation.html"><span class="doc">MySQL</span></a> or <a class="reference internal" href="postgresql_installation.html"><span class="doc">PostgreSQL</span></a> installation instructions for any changes that you
need to make to your database.</p>
<p>If you run MySQL you will almost certainly need to make sure you have
<a class="reference external" href="https://docs.djangoproject.com/en/1.10/ref/databases/#mysql-time-zone-definitions" title="(in Django v1.10)"><span class="xref std std-ref">Time zone definition files</span></a> loaded
into the database.</p>
</div>
<div class="section" id="migrate-your-database-schema">
<span id="upgrading-schema-migration"></span><h2>Migrate your database schema<a class="headerlink" href="#migrate-your-database-schema" title="Permalink to this headline">¶</a></h2>
<p>Once you have updated your settings you can perform the database schema and
data upgrade by running. This is done as follows:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(env) $</span> pootle migrate --fake-initial
</pre></div>
</div>
<p>You will also need to update the stats data held in Pootle</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(env) $</span> pootle update_data
</pre></div>
</div>
</div>
<div class="section" id="refreshing-checks">
<span id="upgrading-refresh-checks"></span><h2>Refreshing checks<a class="headerlink" href="#refreshing-checks" title="Permalink to this headline">¶</a></h2>
<p>You must now update the translation checks. You will need to have an
<a class="reference internal" href="installation.html#installation-running-rqworker"><span class="std std-ref">RQ worker running</span></a> to complete this.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(env) $</span> pootle calculate_checks
</pre></div>
</div>
<p>This command will dispatch jobs to the RQ worker and may take some time.</p>
<p>If you wish to run <a class="reference internal" href="commands.html#django-admin-calculate_checks"><code class="xref std std-djadmin docutils literal"><span class="pre">calculate_checks</span></code></a> in the foreground without using
the RQ worker you can use the <a class="reference internal" href="commands.html#cmdoption-no-rq"><code class="xref std std-option docutils literal"><span class="pre">--no-rq</span></code></a> option.</p>
</div>
<div class="section" id="refreshing-scores">
<span id="upgrading-refresh-scores"></span><h2>Refreshing scores<a class="headerlink" href="#refreshing-scores" title="Permalink to this headline">¶</a></h2>
<p>If you are upgrading from a version prior to 2.8rc6, you will need to update
user scores using <a class="reference internal" href="commands.html#django-admin-refresh_scores"><code class="xref std std-djadmin docutils literal"><span class="pre">refresh_scores</span></code></a>.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(env) $</span> pootle refresh_scores --reset
<span class="gp">(env) $</span> pootle refresh_scores
</pre></div>
</div>
</div>
<div class="section" id="drop-cached-snippets">
<span id="upgrading-drop-cached-snippets"></span><h2>Drop cached snippets<a class="headerlink" href="#drop-cached-snippets" title="Permalink to this headline">¶</a></h2>
<p>Redis might have cached HTML snippets referring to outdated static assets. In
order for Pootle to return references to the newest assets these cached
snippets must go away:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(env) $</span> pootle flush_cache --django-cache
</pre></div>
</div>
</div>
<div class="section" id="set-up-users">
<span id="upgrading-setup-users"></span><h2>Set up users<a class="headerlink" href="#set-up-users" title="Permalink to this headline">¶</a></h2>
<p>Any accounts that do not have an email address registered will not be able to
log in. You can set the email for a user using the <a class="reference internal" href="commands.html#django-admin-update_user_email"><code class="xref std std-djadmin docutils literal"><span class="pre">update_user_email</span></code></a>
command.</p>
<p>For example to set the email for user <code class="docutils literal"><span class="pre">admin</span></code> to <code class="docutils literal"><span class="pre">admin&#64;example.com</span></code>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(env) $</span> pootle update_user_email admin admin@example.com
</pre></div>
</div>
<p>As of Pootle 2.7 users must now verify their email before they can log in.</p>
<p>You can use the <a class="reference internal" href="commands.html#django-admin-verify_user"><code class="xref std std-djadmin docutils literal"><span class="pre">verify_user</span></code></a> command to bypass email verification for
a specific user.</p>
<p>For example to automatically verify the admin user:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(env) $</span> pootle verify_user admin
</pre></div>
</div>
<p>If you wish to verify all of your existing users please see the
<a class="reference internal" href="commands.html#django-admin-verify_user"><code class="xref std std-djadmin docutils literal"><span class="pre">verify_user</span></code></a> command for further options.</p>
</div>
<div class="section" id="next-steps">
<span id="upgrading-next-steps"></span><h2>Next steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h2>
<p>Now that you have Pootle up and running you may want to consider some of the
following in order to build a production environment.</p>
<ul class="simple">
<li><a class="reference internal" href="web.html#pootle-running-as-a-service"><span class="std std-ref">Run Pootle and RQ workers as a service</span></a></li>
<li><a class="reference internal" href="../developers/customization.html#customization"><span class="std std-ref">Re-apply customisations</span></a></li>
<li><a class="reference internal" href="optimization.html"><span class="doc">Optimize your setup</span></a></li>
<li><a class="reference internal" href="../features/translation_memory.html#translation-memory"><span class="std std-ref">Set up a Translation Memory Server</span></a></li>
<li><a class="reference internal" href="settings.html#settings-available"><span class="std std-ref">Check out any new settings</span></a></li>
<li><a class="reference internal" href="commands.html#commands"><span class="std std-ref">Check out Pootle management commands</span></a></li>
</ul>
</div>
</div>


</div>
<hr>

<footer class="footer">
  <div class="container">
    <p class="pull-right"><a href="#">Back to top ↑</a></p>
    <ul class="unstyled muted">
      <li><small>
        &copy; 2004-2017.<br/>
      </small></li>
      <li><small>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.3.
      </small></li>
    </ul>
  </div>
</footer>
  </body>
</html>