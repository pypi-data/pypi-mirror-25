
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Running under a Web Server &#8212; Pootle 2.8.2 documentation</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.8.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/bootstrap.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Database Migration" href="database_migration.html" />
    <link rel="prev" title="Installation with PostgreSQL" href="postgresql_installation.html" /> 
  </head>
  <body>
  <div id="navbar" class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container-fluid">
        <a class="brand" href="../index.html">Pootle</a>
        <span class="navbar-text pull-left"><b>2.8</b></span>
          <ul class="nav">
            <li class="divider-vertical"></li>
            
              <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../features/index.html">Features</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="upgrading.html">Upgrading</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Administering a server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/index.html">Developers</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions (FAQ)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../releases/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>
</ul>
</li>
              
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">Running under a Web Server</a><ul>
<li><a class="reference internal" href="#running-pootle-and-rq-workers-as-a-service">Running Pootle and RQ workers as a Service</a></li>
<li><a class="reference internal" href="#running-under-apache">Running under Apache</a><ul>
<li><a class="reference internal" href="#proxying-with-apache">Proxying with Apache</a></li>
<li><a class="reference internal" href="#apache-with-mod-wsgi">Apache with mod_wsgi</a><ul>
<li><a class="reference internal" href="#htaccess">.htaccess</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#running-under-nginx">Running under Nginx</a><ul>
<li><a class="reference internal" href="#proxying-with-nginx">Proxying with Nginx</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
            
            
              
  <li><a href="postgresql_installation.html"
         title="previous chapter">&laquo; Installation with PostgreSQL</a></li>
  <li><a href="database_migration.html"
         title="next chapter">Database Migration &raquo;</a></li>
            
          </ul>
          <ul class="nav pull-right">
            
              
            
          
            
<form class="navbar-search pull-right" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
          </ul>
        </div>
      </div>
    </div>
  </div>

<div class="container content">
   
  <div class="section" id="running-under-a-web-server">
<span id="web"></span><h1>Running under a Web Server<a class="headerlink" href="#running-under-a-web-server" title="Permalink to this headline">¶</a></h1>
<p>Running Pootle with a front end web server will improve performance, give you
more flexibility, and might be better for security. It is strongly recommended
to run Pootle under Apache, Nginx, or a similar web server.</p>
<div class="section" id="running-pootle-and-rq-workers-as-a-service">
<span id="pootle-running-as-a-service"></span><h2>Running Pootle and RQ workers as a Service<a class="headerlink" href="#running-pootle-and-rq-workers-as-a-service" title="Permalink to this headline">¶</a></h2>
<p>If you plan to run Pootle and/or RQ workers as system services, you can use
whatever software you are familiar with for that purpose. For example
<a class="reference external" href="http://supervisord.org/">Supervisor</a>, <a class="reference external" href="https://circus.readthedocs.io/en/latest/">Circus</a> or <a class="reference external" href="http://cr.yp.to/daemontools.html">daemontools</a> might fit your needs.</p>
</div>
<div class="section" id="running-under-apache">
<span id="apache"></span><h2>Running under Apache<a class="headerlink" href="#running-under-apache" title="Permalink to this headline">¶</a></h2>
<p>You can use Apache either as a reverse proxy or straight with mod_wsgi.</p>
<div class="section" id="proxying-with-apache">
<span id="apache-reverse-proxy"></span><h3>Proxying with Apache<a class="headerlink" href="#proxying-with-apache" title="Permalink to this headline">¶</a></h3>
<p>If you want to reverse proxy through Apache, you will need to have <a class="reference external" href="https://httpd.apache.org/docs/current/mod/mod_proxy.html">mod_proxy</a> installed for
forwarding requests and configure it accordingly.</p>
<div class="highlight-apache"><div class="highlight"><pre><span></span><span class="nb">ProxyPass</span> / http://localhost:8000/
<span class="nb">ProxyPassReverse</span> / http://localhost:8000/
<span class="nb">ProxyPreserveHost</span> <span class="k">On</span>
</pre></div>
</div>
</div>
<div class="section" id="apache-with-mod-wsgi">
<span id="apache-mod-wsgi"></span><h3>Apache with mod_wsgi<a class="headerlink" href="#apache-with-mod-wsgi" title="Permalink to this headline">¶</a></h3>
<p>Make sure to review your global Apache settings (something like
<em>/etc/apache2/httpd.conf</em> or <em>/etc/httpd/conf/httpd.conf</em>) for the server-pool
settings. The default settings provided by Apache are too high for running a web
application like Pootle. The ideal settings depend heavily on your hardware and
the number of users you expect to have. A moderate server with 1GB memory might
set <code class="docutils literal"><span class="pre">MaxClients</span></code> to something like <code class="docutils literal"><span class="pre">20</span></code>, for example.</p>
<p>Make sure Apache has read access to all of Pootle’s files and write access to
the <a class="reference internal" href="settings.html#std:setting-POOTLE_TRANSLATION_DIRECTORY"><code class="xref std std-setting docutils literal"><span class="pre">POOTLE_TRANSLATION_DIRECTORY</span></code></a> directory.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Most of the paths present in the examples in this section are the
result of deploying Pootle using a Python virtualenv as told in the
<a class="reference internal" href="installation.html#installation-setup-environment"><span class="std std-ref">Setting up the Environment</span></a> section
from the <a class="reference internal" href="installation.html#installation"><span class="std std-ref">Quickstart installation</span></a> instructions.</p>
<p>If for any reason you have different paths, you will have to adjust the
examples before using them.</p>
<p class="last">For example the path <code class="file docutils literal"><span class="pre">/var/www/pootle/env/lib/python2.7/site-packages/</span></code>
will be different if you have another Python version, or if the Python
virtualenv is located in any other place.</p>
</div>
<p>First it is necessary to create a WSGI loader script:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">site</span>
<span class="kn">import</span> <span class="nn">sys</span>


<span class="c1"># You probably will need to change these paths to match your deployment,</span>
<span class="c1"># most likely because of the Python version you are using.</span>
<span class="n">ALLDIRS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;/var/www/pootle/env/lib/python2.7/site-packages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;/var/www/pootle/env/lib/python2.7/site-packages/pootle/apps&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># Remember original sys.path.</span>
<span class="n">prev_sys_path</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

<span class="c1"># Add each new site-packages directory.</span>
<span class="k">for</span> <span class="n">directory</span> <span class="ow">in</span> <span class="n">ALLDIRS</span><span class="p">:</span>
    <span class="n">site</span><span class="o">.</span><span class="n">addsitedir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>

<span class="c1"># Reorder sys.path so new directories at the front.</span>
<span class="n">new_sys_path</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">prev_sys_path</span><span class="p">:</span>
        <span class="n">new_sys_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[:</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_sys_path</span>

<span class="c1"># Set the Pootle settings module as DJANGO_SETTINGS_MODULE.</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;DJANGO_SETTINGS_MODULE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;pootle.settings&#39;</span>


<span class="c1"># Set the WSGI application.</span>
<span class="k">def</span> <span class="nf">application</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wrapper for Django&#39;s WSGIHandler().</span>

<span class="sd">    This allows to get values specified by SetEnv in the Apache</span>
<span class="sd">    configuration or interpose other changes to that environment, like</span>
<span class="sd">    installing middleware.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;POOTLE_SETTINGS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;POOTLE_SETTINGS&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="kn">from</span> <span class="nn">django.core.wsgi</span> <span class="kn">import</span> <span class="n">get_wsgi_application</span>
    <span class="n">_wsgi_application</span> <span class="o">=</span> <span class="n">get_wsgi_application</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">_wsgi_application</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>
</pre></div>
</div>
<p>Place it in <code class="file docutils literal"><span class="pre">/var/www/pootle/wsgi.py</span></code>. If you use a different location
remember to update the Apache configuration accordingly.</p>
<p>A sample Apache configuration with mod_wsgi might look like this:</p>
<div class="highlight-apache"><div class="highlight"><pre><span></span><span class="nb">WSGIRestrictEmbedded</span> <span class="k">On</span>
<span class="nb">WSGIPythonOptimize</span> <span class="m">1</span>

<span class="nt">&lt;VirtualHost</span> <span class="s">*:80</span><span class="nt">&gt;</span>
    <span class="c"># Domain for the Pootle server. Use &#39;localhost&#39; for local deployments.</span>
    <span class="c">#</span>
    <span class="c"># If you want to deploy on example.com/your-pootle/ rather than in</span>
    <span class="c"># my-pootle.example.com/ you will have to do the following changes to</span>
    <span class="c"># this sample Apache configuration:</span>
    <span class="c">#</span>
    <span class="c"># - Change the ServerName directive to:</span>
    <span class="c">#   ServerName example.com</span>
    <span class="c"># - Change the WSGIScriptAlias directive to (note that /your-pootle must</span>
    <span class="c">#   not end with a slash):</span>
    <span class="c">#   WSGIScriptAlias /your-pootle /var/www/pootle/wsgi.py</span>
    <span class="c"># - Change the Alias directive for &#39;assets&#39; to include the &#39;/your-pootle&#39;.</span>
    <span class="c"># - Include the following settings in your custom Pootle settings:</span>
    <span class="c">#   STATIC_URL = &#39;/your-pootle/assets/&#39;</span>
    <span class="c">#   FORCE_SCRIPT_NAME = &#39;/your-pootle&#39;</span>
    <span class="c"># - If you have previously calculated the stats:</span>
    <span class="c">#   - Restart the RQ workers.</span>
    <span class="c">#   - Run refresh_stats to recalculate the stats data.</span>
    <span class="nb">ServerName</span> my-pootle.example.com

    <span class="c"># Set the &#39;POOTLE_SETTINGS&#39; environment variable pointing at your custom</span>
    <span class="c"># Pootle settings file.  An initial settings file can be created using</span>
    <span class="c"># &#39;pootle init&#39;</span>
    <span class="c">#</span>
    <span class="c"># This might require enabling the &#39;env&#39; module.</span>
    <span class="nb">SetEnv</span> POOTLE_SETTINGS <span class="sx">/var/www/pootle/your_custom_settings.conf</span>


    <span class="c"># The following two optional lines enable the &quot;daemon mode&quot; which</span>
    <span class="c"># limits the number of processes and therefore also keeps memory use</span>
    <span class="c"># more predictable.</span>
    <span class="nb">WSGIDaemonProcess</span> pootle processes=2 threads=3 stack-size=1048576 maximum-requests=500 inactivity-timeout=300 display-name=%{GROUP} python-path=/var/www/pootle/env/lib/python2.7/site-packages
    <span class="nb">WSGIProcessGroup</span> pootle

    <span class="c"># Point to the WSGI loader script.</span>
    <span class="nb">WSGIScriptAlias</span> / <span class="sx">/var/www/pootle/wsgi.py</span>

    <span class="c"># Turn off directory listing by default.</span>
    <span class="nb">Options</span> -Indexes

    <span class="c"># Compress before being sent to the client over the network.</span>
    <span class="c"># This might require enabling the &#39;deflate&#39; module.</span>
    <span class="nb">SetOutputFilter</span> DEFLATE
    <span class="nb">AddOutputFilterByType</span> DEFLATE text/html text/css text/plain text/xml application/x-javascript

    <span class="c"># Set expiration for some types of files.</span>
    <span class="c"># This might require enabling the &#39;expires&#39; module.</span>
    <span class="nb">ExpiresActive</span> <span class="k">On</span>

    <span class="nb">ExpiresByType</span> image/jpg <span class="s2">&quot;access plus 10 years&quot;</span>
    <span class="nb">ExpiresByType</span> image/png <span class="s2">&quot;access plus 10 years&quot;</span>
    <span class="nb">ExpiresByType</span> text/css <span class="s2">&quot;access plus 10 years&quot;</span>
    <span class="nb">ExpiresByType</span> application/x-javascript <span class="s2">&quot;access plus 10 years&quot;</span>

    <span class="c"># Optimal caching by proxies.</span>
    <span class="c"># This might require enabling the &#39;headers&#39; module.</span>
    <span class="nb">Header</span> set Cache-Control <span class="s2">&quot;public&quot;</span>

    <span class="c"># Directly serve static files like css and images, no need to go</span>
    <span class="c"># through mod_wsgi and Django. For high performance consider having a</span>
    <span class="c"># separate server.</span>
    <span class="nb">Alias</span> <span class="sx">/assets</span> <span class="sx">/var/www/pootle/env/lib/python2.7/site-packages/pootle/assets</span>
    <span class="nt">&lt;Directory</span> <span class="s">/var/www/pootle/env/lib/python2.7/site-packages/pootle/assets</span><span class="nt">&gt;</span>
        <span class="nb">Require</span> <span class="k">all</span> granted
        <span class="c"># For apache 2.2, comment the line directly above, and uncommend the two lines directly below</span>
        <span class="c">#Order deny,allow</span>
        <span class="c">#Allow from all</span>
    <span class="nt">&lt;/Directory&gt;</span>

<span class="nt">&lt;/VirtualHost&gt;</span>
</pre></div>
</div>
<p>You can find more information in the <a class="reference external" href="https://docs.djangoproject.com/en/1.10/howto/deployment/wsgi/modwsgi/">Django docs about Apache and mod_wsgi</a>.</p>
<div class="section" id="htaccess">
<span id="apache-htaccess"></span><h4>.htaccess<a class="headerlink" href="#htaccess" title="Permalink to this headline">¶</a></h4>
<p>If you do not have access to the main Apache configuration, you should still be
able to configure things correctly using the <em>.htaccess</em> file.</p>
<p><a class="reference external" href="https://code.google.com/archive/p/modwsgi/wikis/ConfigurationGuidelines.wiki">More information</a>
on configuring <em>mod_wsgi</em> (including <em>.htaccess</em>)</p>
</div>
</div>
</div>
<div class="section" id="running-under-nginx">
<span id="nginx"></span><h2>Running under Nginx<a class="headerlink" href="#running-under-nginx" title="Permalink to this headline">¶</a></h2>
<p>Running Pootle under a web server such as Nginx will improve performance. For
more information about Nginx and WSGI, visit <a class="reference external" href="http://nginx.org/en/docs/http/ngx_http_uwsgi_module.html">Nginx’s WSGI module page</a></p>
<p>A Pootle server is made up of static and dynamic content. By default Pootle
serves all content, and for low-latency purposes it is better to get other
webserver to serve the content that does not change, the static content. It is
just the issue of low latency and making the translation experience more
interactive that calls you to proxy through Nginx.  The following steps show you
how to setup Pootle to proxy through Nginx.</p>
<div class="section" id="proxying-with-nginx">
<span id="nginx-proxy"></span><h3>Proxying with Nginx<a class="headerlink" href="#proxying-with-nginx" title="Permalink to this headline">¶</a></h3>
<p>The default Pootle server runs at port 8000 and for convenience and simplicity
does ugly things such as serving static files — you should definitely avoid that
in production environments.</p>
<p>By proxying Pootle through nginx, the web server will serve all the static media
and the dynamic content will be produced by the app server.</p>
<div class="highlight-nginx"><div class="highlight"><pre><span></span><span class="k">server</span> <span class="p">{</span>
   <span class="kn">listen</span>  <span class="mi">80</span><span class="p">;</span>
   <span class="kn">server_name</span>  <span class="s">pootle.example.com</span><span class="p">;</span>

   <span class="kn">access_log</span> <span class="s">/path/to/pootle/logs/nginx-access.log</span><span class="p">;</span>
   <span class="kn">gzip</span> <span class="no">on</span><span class="p">;</span> <span class="c1"># Enable gzip compression</span>

   <span class="kn">charset</span> <span class="s">utf-8</span><span class="p">;</span>

   <span class="kn">location</span> <span class="s">/assets</span> <span class="p">{</span>
       <span class="kn">alias</span> <span class="s">/path/to/pootle/env/lib/python2.6/site-packages/pootle/assets/</span><span class="p">;</span>
       <span class="kn">expires</span> <span class="s">14d</span><span class="p">;</span>
       <span class="kn">access_log</span> <span class="no">off</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
     <span class="kn">proxy_pass</span>         <span class="s">http://localhost:8000</span><span class="p">;</span>
     <span class="kn">proxy_redirect</span>     <span class="no">off</span><span class="p">;</span>

     <span class="kn">proxy_set_header</span>   <span class="s">Host</span>             <span class="nv">$host</span><span class="p">;</span>
     <span class="kn">proxy_set_header</span>   <span class="s">X-Real-IP</span>        <span class="nv">$remote_addr</span><span class="p">;</span>
     <span class="kn">proxy_set_header</span>   <span class="s">X-Forwarded-For</span>  <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
   <span class="p">}</span>
 <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>


</div>
<hr>

<footer class="footer">
  <div class="container">
    <p class="pull-right"><a href="#">Back to top ↑</a></p>
    <ul class="unstyled muted">
      <li><small>
        &copy; 2004-2017.<br/>
      </small></li>
      <li><small>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.3.
      </small></li>
    </ul>
  </div>
</footer>
  </body>
</html>