UU<div class="n-list n-indent"><div class="n-line" style="padding-left:0.0em;"><div class="n-leaf" style="color:#000080;font-weight: bold;">rule</div><div class="n-leaf">Send notifications to all unregistered users</div></div>
<div class="n-line" style="padding-left:0.0em;"><div class="n-leaf n-empty" style="color:#808080;font-weight: bold;">&nbsp;</div></div>
<div class="n-line" style="padding-left:0.0em;"><div class="n-leaf" style="color:#000080;font-weight: bold;">when</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-leaf" style="color:#660e7a;font-weight: bold;">comments</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf" style="color:#000080;font-weight: bold;">added</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-leaf" style="color:#000080;font-weight: bold;">isNotEmpty</div><div class="n-bigend"></div><div class="n-leaf">{</div><div class="n-bigstart"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:1.0em;"><div class="n-leaf" style="color:#000080;font-weight: bold;">if</div><div class="n-leaf n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-bigstart n-pright"></div><div class="n-bigstart n-pright"></div><div class="n-leaf" style="color:#660e7a;font-weight: bold;">All related emails</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf">isNotEmpty</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-leaf">{</div><div class="n-bigstart"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:2.0em;"><div class="n-leaf" style="color:#000080;font-weight: bold;">var</div><div class="n-bigstart"></div><div class="n-leaf">myComment</div><div class="n-bigend"></div><div class="n-leaf">=</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-leaf" style="color:#660e7a;font-weight: bold;">comments</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf" style="color:#000080;font-weight: bold;">added</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-leaf" style="color:#000080;font-weight: bold;">first</div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:2.0em;"><div class="n-leaf" style="color:#000080;font-weight: bold;">if</div><div class="n-leaf n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-bigstart n-pright"></div><div class="n-bigstart n-pright"></div><div class="n-leaf">myComment</div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf" style="color:#660e7a;font-weight: bold;">permittedGroup</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf">==</div><div class="n-leaf" style="color:#000080;font-weight: bold;">null</div><div class="n-bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-leaf">{</div><div class="n-bigstart"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf" style="color:#000080;font-weight: bold;">var</div><div class="n-bigstart"></div><div class="n-leaf">body</div><div class="n-bigend"></div><div class="n-leaf">=</div><div class="n-bigstart"></div><div class="n-leaf n-pright" style="color:#008000;">"</div><div class="n-leaf n-empty" style="color:#808080;font-weight: bold;">&nbsp;</div><div class="n-leaf n-pleft" style="color:#008000;">"</div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf n-empty" style="color:#808080;font-weight: bold;">&nbsp;</div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf" style="color:#808080;font-weight: bold;">//</div><div class="n-leaf" style="color:#808080;font-weight: bold;">getting subject</div><div class="n-bigend"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf" style="color:#000080;font-weight: bold;">var</div><div class="n-bigstart"></div><div class="n-leaf">subject</div><div class="n-bigend"></div><div class="n-leaf">=</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-leaf" style="color:#660e7a;font-weight: bold;">summary</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf" style="color:#000080;font-weight: bold;">if</div><div class="n-leaf n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-leaf n-pright">!</div><div class="n-bigstart n-pright"></div><div class="n-leaf n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-bigstart n-pright"></div><div class="n-leaf">subject</div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf">startsWith</div><div class="n-leaf n-pleft n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-leaf n-pright" style="color:#008000;">"</div><div class="n-leaf" style="color:#008000;font-weight: bold;">Re:</div><div class="n-leaf n-pleft" style="color:#008000;">"</div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">,</div><div class="n-leaf" style="color:#808080;font-weight: bold;">opts</div><div class="n-leaf n-pleft">)</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-leaf">{</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf">subject</div><div class="n-bigend"></div><div class="n-leaf">=</div><div class="n-list n-horizontal"><div class="n-list n-vertical"><div class="n-list n-horizontal"><div class="n-leaf" style="font-weight: bold;">l10n</div><div class="n-leaf" style="font-weight: bold;">(</div><div class="n-list n-horizontal"><div class="n-leaf" style="color:#008000;font-weight: bold;">Re:</div><div class="n-list n-horizontal"><div class="n-leaf n-pright">{</div><div class="n-list n-indent"><div class="n-bigstart"></div><div class="n-line" style="padding-left:0.0em;"><div class="n-leaf" style="color:#660e7a;font-weight: bold;">summary</div><div class="n-bigend"></div></div></div><div class="n-leaf n-pleft">}</div></div></div><div class="n-leaf" style="font-weight: bold;">)</div></div></div></div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div><div class="n-bigend"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf">}</div><div class="n-bigend"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf n-empty" style="color:#808080;font-weight: bold;">&nbsp;</div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf" style="color:#808080;font-weight: bold;">//</div><div class="n-leaf" style="color:#808080;font-weight: bold;">adding attaches</div><div class="n-bigend"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf" style="color:#000080;font-weight: bold;">var</div><div class="n-bigstart"></div><div class="n-leaf">text</div><div class="n-bigend"></div><div class="n-leaf">=</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-leaf">myComment</div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf" style="color:#660e7a;font-weight: bold;">text</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf" style="color:#000080;font-weight: bold;">for each</div><div class="n-bigstart"></div><div class="n-leaf">attach</div><div class="n-bigend"></div><div class="n-leaf" style="color:#000080;font-weight: bold;">in</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-leaf" style="color:#660e7a;font-weight: bold;">attachments</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf" style="color:#000080;font-weight: bold;">added</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf">{</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf">text</div><div class="n-bigend"></div><div class="n-leaf">=</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-leaf">text</div><div class="n-bigend"></div><div class="n-leaf">+</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-leaf n-pright" style="color:#008000;">"</div><div class="n-leaf" style="color:#008000;font-weight: bold;">\n[file:</div><div class="n-leaf n-pleft" style="color:#008000;">"</div><div class="n-bigend"></div><div class="n-leaf">+</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-leaf">attach</div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf" style="color:#660e7a;font-weight: bold;">name</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf">+</div><div class="n-bigstart"></div><div class="n-leaf n-pright" style="color:#008000;">"</div><div class="n-leaf" style="color:#008000;font-weight: bold;">]</div><div class="n-leaf n-pleft" style="color:#008000;">"</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div><div class="n-bigend"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf">}</div><div class="n-bigend"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf n-empty" style="color:#808080;font-weight: bold;">&nbsp;</div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf" style="color:#808080;font-weight: bold;">//</div><div class="n-leaf" style="color:#808080;font-weight: bold;">getting list of emails</div><div class="n-bigend"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf" style="color:#000080;font-weight: bold;">var</div><div class="n-bigstart"></div><div class="n-leaf">allRelatedEmails</div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf" style="color:#000080;font-weight: bold;">var</div><div class="n-bigstart"></div><div class="n-leaf">addToCC</div><div class="n-bigend"></div><div class="n-leaf">=</div><div class="n-bigstart"></div><div class="n-leaf n-pright" style="color:#008000;">"</div><div class="n-leaf n-empty" style="color:#808080;font-weight: bold;">&nbsp;</div><div class="n-leaf n-pleft" style="color:#008000;">"</div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf" style="color:#000080;font-weight: bold;">var</div><div class="n-bigstart"></div><div class="n-leaf">replyTo</div><div class="n-bigend"></div><div class="n-leaf">=</div><div class="n-bigstart"></div><div class="n-leaf n-pright" style="color:#008000;">"</div><div class="n-leaf n-empty" style="color:#808080;font-weight: bold;">&nbsp;</div><div class="n-leaf n-pleft" style="color:#008000;">"</div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf" style="color:#000080;font-weight: bold;">var</div><div class="n-bigstart"></div><div class="n-leaf">lastCommentAuthorPersonal</div><div class="n-bigend"></div><div class="n-leaf">=</div><div class="n-bigstart"></div><div class="n-leaf n-pright" style="color:#008000;">"</div><div class="n-leaf n-empty" style="color:#808080;font-weight: bold;">&nbsp;</div><div class="n-leaf n-pleft" style="color:#008000;">"</div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf n-empty" style="color:#808080;font-weight: bold;">&nbsp;</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf">allRelatedEmails</div><div class="n-bigend"></div><div class="n-leaf">=</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-leaf" style="color:#660e7a;font-weight: bold;">All related emails</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf">split</div><div class="n-leaf n-pleft n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-leaf n-pright" style="color:#008000;">"</div><div class="n-leaf" style="color:#008000;font-weight: bold;">&nbsp;</div><div class="n-leaf n-pleft" style="color:#008000;">"</div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">,</div><div class="n-bigstart"></div><div class="n-leaf">preserveAllTokens</div><div class="n-bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf" style="color:#808080;font-weight: bold;">//</div><div class="n-leaf" style="color:#808080;font-weight: bold;">case 1: the message from unregistered user, got from email</div><div class="n-bigend"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf" style="color:#000080;font-weight: bold;">if</div><div class="n-leaf n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-bigstart n-pright"></div><div class="n-bigstart n-pright"></div><div class="n-leaf" style="color:#660e7a;font-weight: bold;">Last message related emails</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf">isNotBlank</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-leaf">{</div><div class="n-bigstart"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf" style="color:#000080;font-weight: bold;">var</div><div class="n-bigstart"></div><div class="n-leaf">lastMessageRelatedEmails</div><div class="n-bigend"></div><div class="n-leaf">=</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-leaf" style="color:#660e7a;font-weight: bold;">Last message related emails</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf">split</div><div class="n-leaf n-pleft n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-leaf n-pright" style="color:#008000;">"</div><div class="n-leaf" style="color:#008000;font-weight: bold;">&nbsp;</div><div class="n-leaf n-pleft" style="color:#008000;">"</div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">,</div><div class="n-bigstart"></div><div class="n-leaf">preserveAllTokens</div><div class="n-bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf n-empty" style="color:#808080;font-weight: bold;">&nbsp;</div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf" style="color:#808080;font-weight: bold;">//</div><div class="n-leaf" style="color:#808080;font-weight: bold;">select only emails of those, who haven't received a copy of the message yet</div><div class="n-bigend"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf" style="color:#000080;font-weight: bold;">for each</div><div class="n-bigstart"></div><div class="n-leaf">email</div><div class="n-bigend"></div><div class="n-leaf" style="color:#000080;font-weight: bold;">in</div><div class="n-bigstart"></div><div class="n-leaf">allRelatedEmails</div><div class="n-bigend"></div><div class="n-leaf">{</div><div class="n-bigstart"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:5.0em;"><div class="n-leaf" style="color:#000080;font-weight: bold;">if</div><div class="n-leaf n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-bigstart n-pright"></div><div class="n-bigstart n-pright"></div><div class="n-leaf">email</div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf">isNotBlank</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf">&&</div><div class="n-bigstart"></div><div class="n-leaf n-pright">!</div><div class="n-bigstart n-pright"></div><div class="n-leaf n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-bigstart n-pright"></div><div class="n-bigstart n-pright"></div><div class="n-leaf">lastMessageRelatedEmails</div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf" style="color:#000080;font-weight: bold;">contains</div><div class="n-leaf n-pleft n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-leaf">email</div><div class="n-bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf">||</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-leaf">email</div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf">eq</div><div class="n-leaf n-pleft n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-bigstart n-pright"></div><div class="n-leaf">getNotificationEmail</div><div class="n-leaf n-pleft n-pright">(</div><div class="n-leaf n-empty" style="color:#808080;font-weight: bold;">&nbsp;</div><div class="n-leaf n-pleft">)</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">,</div><div class="n-bigstart"></div><div class="n-leaf">ignoreCase</div><div class="n-bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-leaf">{</div><div class="n-bigstart"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:6.0em;"><div class="n-leaf" style="color:#000080;font-weight: bold;">if</div><div class="n-leaf n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-bigstart n-pright"></div><div class="n-leaf">replyTo</div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-prightUU"></div><div class="n-leaf">isEmpty</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-leaf">{</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:7.0em;"><div class="n-leaf">replyTo</div><div class="n-bigend"></div><div class="n-leaf">=</div><div class="n-bigstart"></div><div class="n-leaf">email</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div><div class="n-bigend"></div></div>
<div class="n-line" style="padding-left:6.0em;"><div class="n-leaf">}</div><div class="n-bigstart"></div><div class="n-leaf" style="color:#000080;font-weight: bold;">else</div><div class="n-leaf">{</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:7.0em;"><div class="n-leaf">addToCC</div><div class="n-bigend"></div><div class="n-leaf">=</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-leaf">addToCC</div><div class="n-bigend"></div><div class="n-leaf">+</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-leaf n-pright" style="color:#008000;">"</div><div class="n-leaf" style="color:#008000;font-weight: bold;">&nbsp;</div><div class="n-leaf n-pleft" style="color:#008000;">"</div><div class="n-bigend"></div><div class="n-leaf">+</div><div class="n-bigstart"></div><div class="n-leaf">email</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div><div class="n-bigend"></div></div>
<div class="n-line" style="padding-left:6.0em;"><div class="n-leaf">}</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-bigend"></div></div>
<div class="n-line" style="padding-left:5.0em;"><div class="n-leaf">}</div><div class="n-bigend"></div><div class="n-bigend"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf">}</div><div class="n-bigend"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf n-empty" style="color:#808080;font-weight: bold;">&nbsp;</div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf" style="color:#808080;font-weight: bold;">//</div><div class="n-leaf" style="color:#808080;font-weight: bold;">all the new users should be added to list of all related emails for future comments</div><div class="n-bigend"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf" style="color:#000080;font-weight: bold;">for each</div><div class="n-bigstart"></div><div class="n-leaf">email</div><div class="n-bigend"></div><div class="n-leaf" style="color:#000080;font-weight: bold;">in</div><div class="n-bigstart"></div><div class="n-leaf">lastMessageRelatedEmails</div><div class="n-bigend"></div><div class="n-leaf">{</div><div class="n-bigstart"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:5.0em;"><div class="n-leaf" style="color:#000080;font-weight: bold;">if</div><div class="n-leaf n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-bigstart n-pright"></div><div class="n-bigstart n-pright"></div><div class="n-leaf">email</div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf">isNotBlank</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf">&&</div><div class="n-bigstart"></div><div class="n-leaf n-pright">!</div><div class="n-bigstart n-pright"></div><div class="n-leaf n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-bigstart n-pright"></div><div class="n-bigstart n-pright"></div><div class="n-leaf">allRelatedEmails</div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf" style="color:#000080;font-weight: bold;">contains</div><div class="n-leaf n-pleft n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-leaf">email</div><div class="n-bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf">||</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-leaf">email</div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf">eq</div><div class="n-leaf n-pleft n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-bigstart n-pright"></div><div class="n-leaf">getNotificationEmail</div><div class="n-leaf n-pleft n-pright">(</div><div class="n-leaf n-empty" style="color:#808080;font-weight: bold;">&nbsp;</div><div class="n-leaf n-pleft">)</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">,</div><div class="n-bigstart"></div><div class="n-leaf">ignoreCase</div><div class="n-bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-leaf">{</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:6.0em;"><div class="n-leaf" style="color:#660e7a;font-weight: bold;">All related emails</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf">=</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-leaf" style="color:#660e7a;font-weight: bold;">All related emails</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf">+</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-leaf n-pright" style="color:#008000;">"</div><div class="n-leaf" style="color:#008000;font-weight: bold;">&nbsp;</div><div class="n-leaf n-pleft" style="color:#008000;">"</div><div class="n-bigend"></div><div class="n-leaf">+</div><div class="n-bigstart"></div><div class="n-leaf">email</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div><div class="n-bigend"></div></div>
<div class="n-line" style="padding-left:5.0em;"><div class="n-leaf">}</div><div class="n-bigend"></div><div class="n-bigend"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf">}</div><div class="n-bigend"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf">lastCommentAuthorPersonal</div><div class="n-bigend"></div><div class="n-leaf">=</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-leaf">lastMessageRelatedEmails</div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-leaf" style="color:#000080;font-weight: bold;">first</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf" style="color:#660e7a;font-weight: bold;">Last message related emails</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf">=</div><div class="n-leaf" style="color:#000080;font-weight: bold;">null</div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf">body</div><div class="n-bigend"></div><div class="n-leaf">=</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-leaf">wikify</div><div class="n-leaf n-pleft n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-leaf">text</div><div class="n-bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div><div class="n-bigend"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf">}</div><div class="n-bigstart"></div><div class="n-leaf" style="color:#000080;font-weight: bold;">else</div><div class="n-leaf">{</div><div class="n-bigstart"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf" style="color:#808080;font-weight: bold;">//</div><div class="n-leaf" style="color:#808080;font-weight: bold;">case 2: comment from agent</div><div class="n-bigend"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf">replyTo</div><div class="n-bigend"></div><div class="n-leaf">=</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-leaf" style="color:#660e7a;font-weight: bold;">All related emails</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf">substringRelative</div><div class="n-leaf n-pleft n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-leaf n-pright" style="color:#008000;">"</div><div class="n-leaf" style="color:#008000;font-weight: bold;">&nbsp;</div><div class="n-leaf n-pleft" style="color:#008000;">"</div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">,</div><div class="n-bigstart"></div><div class="n-leaf">pos</div><div class="n-leaf n-pleft" style="font-weight: bold;">:</div><div class="n-leaf">before</div><div class="n-bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf">addToCC</div><div class="n-bigend"></div><div class="n-leaf">=</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-leaf" style="color:#660e7a;font-weight: bold;">All related emails</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf">remove</div><div class="n-leaf n-pleft n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-leaf">replyTo</div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">,</div><div class="n-bigstart"></div><div class="n-leaf">side</div><div class="n-leaf n-pleft" style="font-weight: bold;">:</div><div class="n-leaf">start</div><div class="n-bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf">trim</div><div class="n-leaf n-pleft n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-leaf">side</div><div class="n-leaf n-pleft" style="font-weight: bold;">:</div><div class="n-leaf">both</div><div class="n-bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf">lastCommentAuthorPersonal</div><div class="n-bigend"></div><div class="n-leaf">=</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-leaf">myComment</div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf" style="color:#660e7a;font-weight: bold;">author</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf" style="color:#660e7a;font-weight: bold;">fullName</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf" style="color:#808080;font-weight: bold;">//</div><div class="n-leaf" style="color:#808080;font-weight: bold;">getting quoted text</div><div class="n-bigend"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf" style="color:#000080;font-weight: bold;">var</div><div class="n-bigstart"></div><div class="n-leaf">quotedText</div><div class="n-bigend"></div><div class="n-leaf">=</div><div class="n-bigstart"></div><div class="n-leaf n-pright" style="color:#008000;">"</div><div class="n-leaf n-empty" style="color:#808080;font-weight: bold;">&nbsp;</div><div class="n-leaf n-pleft" style="color:#008000;">"</div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf" style="color:#000080;font-weight: bold;">var</div><div class="n-bigstart"></div><div class="n-leaf">lastVisibleComment</div><div class="n-bigend"></div><div class="n-leaf">=</div><div class="n-bigstart"></div><div class="n-leaf">myComment</div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf">lastVisibleComment</div><div class="n-bigend"></div><div class="n-leaf">=</div><div class="n-leaf" style="color:#000080;font-weight: bold;">null</div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf" style="color:#000080;font-weight: bold;">for each</div><div class="n-bigstart"></div><div class="n-leaf">comment</div><div class="n-bigend"></div><div class="n-leaf" style="color:#000080;font-weight: bold;">in</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-leaf" style="color:#660e7a;font-weight: bold;">comments</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf" style="color:#000080;font-weight: bold;">oldValue</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf">{</div><div class="n-bigstart"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:5.0em;"><div class="n-leaf" style="color:#000080;font-weight: bold;">if</div><div class="n-leaf n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-bigstart n-pright"></div><div class="n-bigstart n-pright"></div><div class="n-leaf">comment</div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf" style="color:#660e7a;font-weight: bold;">permittedGroup</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf">==</div><div class="n-leaf" style="color:#000080;font-weight: bold;">null</div><div class="n-bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-leaf">{</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:6.0em;"><div class="n-leaf">lastVisibleComment</div><div class="n-bigend"></div><div class="n-leaf">=</div><div class="n-bigstart"></div><div class="n-leaf">comment</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div><div class="n-bigend"></div></div>
<div class="n-line" style="padding-left:5.0em;"><div class="n-leaf">}</div><div class="n-bigend"></div><div class="n-bigend"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf">}</div><div class="n-bigend"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf" style="color:#000080;font-weight: bold;">if</div><div class="n-leaf n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-bigstart n-pright"></div><div class="n-leaf">lastVisibleComment</div><div class="n-bigend"></div><div class="n-leaf">==</div><div class="n-leaf" style="color:#000080;font-weight: bold;">null</div><div class="n-bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-leaf">{</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:5.0em;"><div class="n-leaf">quotedText</div><div class="n-bigend"></div><div class="n-leaf">=</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-leaf">wikify</div><div class="n-leaf n-pleft n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-leaf" style="color:#000080;font-weight: bold;">issue</div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf" style="color:#660e7a;font-weight: bold;">description</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div><div class="n-bigend"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf">}</div><div class="n-bigstart"></div><div class="n-leaf" style="color:#000080;font-weight: bold;">else</div><div class="n-leaf">{</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:5.0em;"><div class="n-leaf">quotedText</div><div class="n-bigend"></div><div class="n-leaf">=</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-leaf">wikify</div><div class="n-leaf n-pleft n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-bigstart n-pright"></div><div class="n-leaf">lastVisibleComment</div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf" style="color:#660e7a;font-weight: bold;">text</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div><div class="n-bigend"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf">}</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf">body</div><div class="n-bigend"></div><div class="n-leaf">=</div><div class="n-list n-horizontal"><div class="n-list n-vertical"><div class="n-list n-horizontal"><div class="n-leaf" style="font-weight: bold;">l10n</div><div class="n-leaf" style="font-weight: bold;">(</div><div class="n-list n-horizontal"><div class="n-leaf" style="color:#008000;font-weight: bold;">&lt;div style="font-family: sans-serif"&gt;</div><div class="n-leaf" style="color:#008000;font-weight: bold;">&lt;div style="padding: 10px 10px; font-size: 13px; border-bottom: 1px solid #D4D5D6;"&gt;</div><div class="n-list n-horizontal"><div class="n-leaf n-pright">{</div><div class="n-list n-indent"><div class="n-bigstart"></div><div class="n-line" style="padding-left:0.0em;"><div class="n-leaf">wikify</div><div class="n-leaf n-pleft n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-leaf">text</div><div class="n-*bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-bigend"></div></div></div><div class="n-leaf n-pleft">}</div></div><div class="n-leaf" style="color:#008000;font-weight: bold;">&lt;/div&gt;&lt;blockquote type="cite"&gt;&lt;div style="font-size: 13px; color: #888;"&gt;In reply to:&lt;br&gt;&lt;br&gt;</div><div class="n-list n-horizontal"><div class="n-leaf n-pright">{</div><div class="n-list n-indent"><div class="n-line" style="padding-left:0.0em;"><div class="n-leaf">quotedText</div></div></div><div class="n-leaf n-pleft">}</div></div><div class="n-leaf" style="color:#008000;font-weight: bold;">&lt;/div&gt;&lt;/blockquote&gt;&lt;div style="margin-left: 44px; padding: 4px 0 8px; color: #888; font-size: 11px; margin: 20px 0; padding: 8px 0; border-top: 1px solid #D4D5D6;"&gt;You</div><div class="n-leaf" style="color:#008000;font-weight: bold;">have received this message because you are a participant of the conversation in the issue</div><div class="n-list n-horizontal"><div class="n-leaf n-pright">{</div><div class="n-list n-indent"><div class="n-bigstart"></div><div class="n-line" style="padding-left:0.0em;"><div class="n-leaf">getId</div><div class="n-leaf n-pleft n-pright">(</div><div class="n-leaf n-empty" style="color:#808080;font-weight: bold;">&nbsp;</div><div class="n-leaf n-pleft">)</div><div class="n-bigend"></div></div></div><div class="n-leaf n-pleft">}</div></div><div class="n-leaf" style="color:#008000;font-weight: bold;">. Sincerely yours, YouTrack&lt;/div&gt;&lt;/div&gt;</div></div><div class="n-leaf" style="font-weight: bold;">)</div></div></div></div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div><div class="n-bigend"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf">}</div><div class="n-bigend"></div><div class="n-bigend"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf n-empty" style="color:#808080;font-weight: bold;">&nbsp;</div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf" style="color:#000080;font-weight: bold;">if</div><div class="n-leaf n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-bigstart n-pright"></div><div class="n-leaf">addToCC</div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf">isNotEmpty</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-leaf">{</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf">addToCC</div><div class="n-bigend"></div><div class="n-leaf">=</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-leaf">addToCC</div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf">replace</div><div class="n-leaf n-pleft n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-leaf n-pright" style="color:#008000;">"</div><div class="n-leaf" style="color:#008000;font-weight: bold;">&nbsp;</div><div class="n-leaf n-pleft" style="color:#008000;">"</div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">,</div><div class="n-bigstart"></div><div class="n-leaf n-pright" style="color:#008000;">"</div><div class="n-leaf" style="color:#008000;font-weight: bold;">,</div><div class="n-leaf n-pleft" style="color:#008000;">"</div><div class="n-bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div><div class="n-bigend"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf">}</div><div class="n-bigend"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf n-empty" style="color:#808080;font-weight: bold;">&nbsp;</div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf" style="color:#808080;font-weight: bold;">//</div><div class="n-leaf" style="color:#808080;font-weight: bold;">sending message when there is someone to send it to</div><div class="n-bigend"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf" style="color:#000080;font-weight: bold;">if</div><div class="n-leaf n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-bigstart n-pright"></div><div class="n-leaf">replyTo</div><div class="n-bigend"></div><div class="n-leaf n-pleft n-pright" style="font-weight: bold;">.</div><div class="n-bigstart n-pright"></div><div class="n-leaf">isNotEmpty</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-leaf">{</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-bigstart"></div></div>
<div class="n-line" style="padding-left:4.0em;"><div class="n-leaf">sendMail</div><div class="n-leaf n-pleft n-pright">(</div><div class="n-bigstart n-pright"></div><div class="n-leaf">lastCommentAuthorPersonal</div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">,</div><div class="n-bigstart"></div><div class="n-bigstart"></div><div class="n-leaf">getNotificationEmail</div><div class="n-leaf n-pleft n-pright">(</div><div class="n-leaf n-empty" style="color:#808080;font-weight: bold;">&nbsp;</div><div class="n-leaf n-pleft">)</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">,</div><div class="n-bigstart"></div><div class="n-leaf">replyTo</div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">,</div><div class="n-bigstart"></div><div class="n-leaf">addToCC</div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">,</div><div class="n-bigstart"></div><div class="n-leaf">subject</div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">,</div><div class="n-bigstart"></div><div class="n-leaf">body</div><div class="n-bigend"></div><div class="n-leaf n-pleft">)</div><div class="n-bigend"></div><div class="n-bigend"></div><div class="n-leaf n-pleft" style="font-weight: bold;">;</div><div class="n-bigend"></div><div class="n-bigend"></div></div>
<div class="n-line" style="padding-left:3.0em;"><div class="n-leaf">}</div><div class="n-bigend"></div><div class="n-bigend"></div></div>
<div class="n-line" style="padding-left:2.0em;"><div class="n-leaf">}</div><div class="n-bigend"></div><div class="n-bigend"></div></div>
<div class="n-line" style="padding-left:1.0em;"><div class="n-leaf">}</div><div class="n-bigend"></div><div class="n-bigend"></div></div>
<div class="n-line" style="padding-left:0.0em;"><div class="n-leaf">}</div></div></div>