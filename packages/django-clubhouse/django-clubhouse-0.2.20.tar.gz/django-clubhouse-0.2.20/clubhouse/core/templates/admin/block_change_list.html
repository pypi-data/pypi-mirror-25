{% extends "admin/change_list.html" %}
{% load staticfiles admin_list i18n clb_tags %}

{% block object-tools %}
    {% if has_add_permission %}
        <ul class="object-tools">
            {% block object-tools-items %}
            <li>
                <a id="add_block" href="add/{% if is_popup %}?_popup=1{% endif %}" class="focus">
                    {% blocktrans %}Add {{ name }}{% endblocktrans %}
                </a>
            </li>
            {% endblock %}
        </ul>
    {% endif %}
{% endblock %}


{% block javascripts %}
    {{ block.super }}

    <script type="text/javascript">
        {# TODO: create separate JS file for this #}
        grp.jQuery(function($) {
            var $addButton = $("#add_block");

            function createOverlay() {
                var $overlay = $('<div id="clb-overlay"></div>');

                $overlay.append($('<div class="module"></div>').append(
                    $("<h3></h3>").text("{% blocktrans with opts.verbose_name as name %}Add {{ name }}{% endblocktrans %}"),
                    '<p class="row">Select block type: <p>',
                    '<p class="row"><select id="block_type"><option value="null">---- Select ----</option>{% get_block_type_options %}<p>',
                    $('<p class="row clb-footer-row"></p>').append(
                        $('<a href="#" class="button clb-cancel-button">Cancel</a>').click(function(e) {
                            $overlay.remove();
                            $addButton.show();
                            e.preventDefault();
                            return false;
                        }),
                        $('<a href="#" class="button clb-continue-button" >Continue</a>').click(function(e) {
                            var admin_url = $("select#block_type").val();
                            if ( admin_url !== 'null' ) {
                                window.location.href = admin_url;
                            }
                        })
                    )
                ));

                $addButton.hide();
                $('#content-main').append($overlay);
            }

            $addButton.click(function(e) {
                e.preventDefault();
                createOverlay();
            });
        });
    </script>

{% endblock %}
