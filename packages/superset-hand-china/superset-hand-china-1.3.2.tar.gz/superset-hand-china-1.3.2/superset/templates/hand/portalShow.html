<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Hand | Dashboard</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <meta content="" name="description" />
  <meta content="" name="author" />
  <!-- BEGIN GLOBAL MANDATORY STYLES -->
  <!--<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&subset=all" rel="stylesheet" type="text/css" />-->
  <link href="/static/assets/resrouces/portalShow/css/googleapis-font.css" rel="stylesheet" type="text/css" />
  <link href="/static/assets/resrouces/portalShow/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
  <link href="/static/assets/resrouces/portalShow/css/simple-line-icons.min.css" rel="stylesheet" type="text/css" />
  <link href="/static/assets/resrouces/portalShow/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
  <link href="/static/assets/resrouces/portalShow/css/uniform.default.css" rel="stylesheet" type="text/css" />
  <link href="/static/assets/resrouces/portalShow/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css" />
  <!-- END GLOBAL MANDATORY STYLES -->
  <!-- BEGIN PAGE LEVEL PLUGINS -->
  <link href="/static/assets/resrouces/portalShow/css/morris.css" rel="stylesheet" type="text/css" />
  <!-- END PAGE LEVEL PLUGINS -->
  <!-- BEGIN THEME GLOBAL STYLES -->
  <link href="/static/assets/resrouces/portalShow/css/components.min.css" rel="stylesheet" id="style_components" type="text/css"
  />
  <link href="/static/assets/resrouces/portalShow/css/plugins.min.css" rel="stylesheet" type="text/css" />
  <!-- END THEME GLOBAL STYLES -->
  <!-- BEGIN THEME LAYOUT STYLES -->
  <link href="/static/assets/resrouces/portalShow/css/layout.min.css" rel="stylesheet" type="text/css" />
  <link href="/static/assets/resrouces/portalShow/themes/light2.min.css" rel="stylesheet" type="text/css" id="style_color"
  />
  <link href="/static/assets/resrouces/portalShow/css/custom.min.css" rel="stylesheet" type="text/css" />
  <link href="/static/assets/resrouces/portalShow/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
  <!-- END THEME LAYOUT STYLES -->
  <!-- tabs -->
  <link href="/static/assets/resrouces/portalShow/css/cleverTable/style.css" rel="stylesheet" type="text/css" />
  <link href="/static/assets/resrouces/portalShow/css/cleverTable/jquery-ui.css" rel="stylesheet" type="text/css" />
  <link href="/static/assets/resrouces/portalShow/css/cleverTable/themes/light2.css" rel="stylesheet" type="text/css" id="tabs_color"
  />
  <link rel="/static/assets/resrouces/portalShow/css/shortcut icon" href="/static/assets/resrouces/portalShow/hand_min.png"
  />
  <style>
        .page-content-wrapper .page-content {
        margin-left: 190px;
        margin-top: -27px;
        min-height: 600px;
        }
        #side-bar{
              padding: 0px;
              margin-left: -10px;
              margin-top: -27px;
        } 
    </style>
</head>
<!-- END HEAD -->
#{ }
<body class="page-header-fixed page-sidebar-closed-hide-logo page-content-white" style="display: none;">
<!-- get data from superset -->
<div id="app" data-bootstrap="{{ bootstrap_data }}"></div>
<!-- BEGIN HEADER -->
<div class="page-header navbar navbar-fixed-top">
  <!-- BEGIN HEADER INNER -->
  <div class="page-header-inner ">
    <!-- BEGIN LOGO -->
    <div class="page-logo" style="float: left;">
<a href="#"><img src="" class="logo-default" style="height: 46px; margin-top: 0px;" /></a>
<div class="menu-toggler sidebar-toggler"></div>
</div>
<!-- switch portal -->
<div class="page-actions">
  <div class="btn-group" style="float: left; margin-top: 8px; margin-left: 10px;">
<button type="button" class="btn red-haze btn-sm dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
              <span class="hidden-sm hidden-xs"><span id="portal"></span>&nbsp;</span>
              <i class="fa fa-angle-down"></i>
            </button>
<ul id="portals" class="dropdown-menu" role="menu">
  <li>
    <a href="/superset/portal/2/show"> <i class="fa fa-university"></i>{{_(" New Post ")}}</a>
  </li>
</ul>
</div>
</div>
<!-- END LOGO -->
<!-- BEGIN RESPONSIVE MENU TOGGLER -->
<a href="javascript:;" class="menu-toggler responsive-toggler" data-toggle="collapse" data-target=".navbar-collapse"></a>
<!-- END RESPONSIVE MENU TOGGLER -->
<!-- BEGIN TOP NAVIGATION MENU -->
<div class="top-menu">
  <ul class="nav navbar-nav pull-right">
    <li>
      <div id="console" style="margin-top: 3px; color: white; width: 40px; height: 40px; margin-right: 90px; cursor: pointer; display: none;">
<i id="qrcode" class="fa fa-server fa-2x  picon" style=" margin-top: 15px; margin-left: 5px; " aria-hidden="true" onclick="javascript:;location.href='/portalmodelview/list/'"></i>
</div>
</li>
<li>
  <!-- BEGIN THEME PANEL -->
  <div class="theme-panel hidden-xs hidden-sm" style="margin-top: 0px;">
<div class="toggler" style="width:40px;height:40px">
<span id="settings" class="icon-settings  picon" style="font-size: 24px;  display: block;width:40px;height:40px;margin-top: -7px;margin-left: -18px;"></span>
</div>
<div class="toggler-close"></div>
<div class="theme-options">
  <div class="theme-option theme-colors clearfix">
    <span>{{_("THEME COLOR")}}</span>
    <ul>
      <li id="default" class="color-default tooltips" data-style="default" data-container="body" data-original-title="Default"></li>
      <li id="darkblue" class="color-darkblue tooltips" data-style="darkblue" data-container="body" data-original-title="Dark Blue"></li>
      <li id="blue" class="color-blue tooltips" data-style="blue" data-container="body" data-original-title="Blue"></li>
      <li id="grey" class="color-grey tooltips" data-style="grey" data-container="body" data-original-title="Grey"></li>
      <li id="light" class="color-light tooltips" data-style="light" data-container="body" data-original-title="Light"></li>
      <li id="light2" class="color-light2 tooltips" data-style="light2" data-container="body" data-html="true" data-original-title="Light 2"></li>
    </ul>
  </div>
  <div class="theme-option">
    <span>{{_("Theme Style")}}</span>
    <select class="layout-style-option form-control input-sm">
                      <option value="square" selected="selected">Square corners</option>
                      <option value="rounded">Rounded corners</option></select>
  </div>
  <div class="theme-option">
    <span>{{_("Layout")}}</span>
    <select class="layout-option form-control input-sm">
                      <option value="fluid" selected="selected">Fluid</option>
                      <option value="boxed">Boxed</option></select>
  </div>
  <div class="theme-option">
    <span>{{_("Header")}}</span>
    <select class="page-header-option form-control input-sm">
                      <option value="fixed" selected="selected">Fixed</option>
                      <option value="default">Default</option></select>
  </div>
  <div class="theme-option">
    <span>{{_("Top Menu Dropdown")}}</span>
    <select class="page-header-top-dropdown-style-option form-control input-sm">
                      <option value="light" selected="selected">Light</option>
                      <option value="dark">Dark</option></select>
  </div>
  <div class="theme-option">
    <span>{{_("Sidebar Mode")}}</span>
    <select class="sidebar-option form-control input-sm">
                      <option value="fixed">Fixed</option>
                      <option value="default" selected="selected">Default</option></select>
  </div>
  <div class="theme-option">
    <span>{{_("Sidebar Menu")}}</span>
    <select class="sidebar-menu-option form-control input-sm">
                      <option value="accordion" selected="selected">Accordion</option>
                      <option value="hover">Hover</option></select>
  </div>
  <div class="theme-option">
    <span>{{_("Sidebar Style")}}</span>
    <select class="sidebar-style-option form-control input-sm">
                      <option value="default" selected="selected">Default</option>
                      <option value="light">Light</option></select>
  </div>
  <div class="theme-option">
    <span>{{_("Sidebar Position")}}</span>
    <select class="sidebar-pos-option form-control input-sm">
                      <option value="left" selected="selected">Left</option>
                      <option value="right">Right</option></select>
  </div>
  <div class="theme-option">
    <span>{{_("footer")}}</span>
    <select class="page-footer-option form-control input-sm">
                      <option value="fixed">Fixed</option>
                      <option value="default" selected="selected">Default</option></select>
  </div>
</div>
</div>
<!-- END THEME PANEL -->
</li>
<li class="dropdown dropdown-user">
  <a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
    <span class="username username-hide-on-mobile" id="profileName"></span>
    <i class="fa fa-angle-down"></i>
  </a>
  <ul class="dropdown-menu dropdown-menu-default">
    <li>
      <a href="#" onclick="opneUserInfoModal()">
<i class="icon-user"></i>{{_("Profile")}}</a>
</li>
<li>
  <a href="/logout/">
    <i class="icon-key"></i>{{_("Logout")}}</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<!-- END HEADER -->
<!-- BEGIN HEADER & CONTENT DIVIDER -->
<div class="clearfix"></div>
<!-- END HEADER & CONTENT DIVIDER -->
<!-- BEGIN CONTAINER -->
<div class="page-container">
  <!-- BEGIN SIDEBAR -->
  <div class="page-sidebar-wrapper">
    <!-- BEGIN SIDEBAR -->
    <!-- DOC: Set data-auto-scroll="false" to disable the sidebar from auto scrolling/focusing -->
    <!-- DOC: Change data-auto-speed="200" to adjust the sub menu slide up/down speed -->
    <div class="page-sidebar navbar-collapse collapse" id="side-bar" style="padding: 0px; margin-left: -10px; margin-top: -10px;">
<!-- BEGIN SIDEBAR MENU -->
<ul class="page-sidebar-menu  page-header-fixed " data-keep-expanded="false" data-auto-scroll="true" data-slide-speed="200"
  style="padding-top: -30px">
<li class="sidebar-search-wrapper">
  <!-- BEGIN RESPONSIVE QUICK SEARCH FORM -->
  <form class="sidebar-search">
    <a href="javascript:;" class="remove">
      <i class="icon-close"></i>
    </a>
    <div class="input-group">
      <input id="search" type="text" class="form-control" placeholder="{{_('Search..')}}" style="height: 30px; width: 150px; font-size: 12px">
<span class="input-group-btn">
                    <a href="javascript:;" onclick="query()" class="btn submit">
<i class="icon-magnifier"></i>
</a>
</span>
</div>
</form>
<!-- END RESPONSIVE QUICK SEARCH FORM -->
</li>
<li class="heading">
  <h3 class="uppercase" style="font-size: 12px;">{{ _("Dashboards") }}</h3>
</li>
</ul>
<!-- END SIDEBAR MENU -->
</div>
<!-- END SIDEBAR -->
</div>
<!-- END SIDEBAR -->
<!-- BEGIN CONTENT -->
<div class="page-content-wrapper">
  <!-- BEGIN CONTENT BODY -->
  <div class="page-content">
    <div id="tabs" style="margin-right: -10px; border: 0; padding: 0; height: 100%;">
<ul>
</ul>
</div>
</div>
<!-- END CONTENT BODY -->
</div>
</div>
<!-- END CONTAINER -->
<!-- BEGIN FOOTER -->
<div class="page-footer">
  <div class="page-footer-inner" style="font-size: 12px;" id="footer"> 2017 &copy; CopyRight by HAND.
<a href="http://docs.saas.hand-china.com/docs/hirp/zh_CN/latest/Dashboard/dashboard.html" target="_blank">welcome to use superset!</a>
</div>
<div class="scroll-to-top">
  <i class="icon-arrow-up"></i>
</div>
</div>
<!-- END FOOTER -->

<!-- 用户信息（Modal） -->
<div class="modal fade" id="userInfoModal" tabindex="-1" role="dialog" aria-labelledby="userInfoModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="text-indent: initial;"> &times;
</button>
<h4 class="modal-title">
  {{_("Profile")}}
</h4>
</div>
<div class="modal-body">
  <form class="form-horizontal" role="form">
    <div class="form-group">
      <label class="col-sm-4 control-label">{{_("User name")}}:</label>
      <div class="col-sm-8">
        <p class="form-control-static" id="username"></p>
      </div>
    </div>
    <div class="form-group">
      <label for="inputPassword" class="col-sm-4 control-label">{{_("Is Active:")}}</label>
      <div class="col-sm-8">
        <p class="form-control-static" id="isActive"></p>
      </div>
    </div>
    <div class="form-group">
      <label for="inputPassword" class="col-sm-4 control-label">{{_("Role:")}}</label>
      <div class="col-sm-8">
        <p class="form-control-static" id="role"></p>
      </div>
    </div>
    <div class="form-group">
      <label for="inputPassword" class="col-sm-4 control-label">{{_("Login count:")}}</label>
      <div class="col-sm-8">
        <p class="form-control-static" id="loginCount"></p>
      </div>
    </div>
    <div class="form-group">
      <label for="inputPassword" class="col-sm-4 control-label">{{_("First Name:")}}</label>
      <div class="col-sm-8">
        <p class="form-control-static" id="firstName"></p>
      </div>
    </div>
    <div class="form-group">
      <label for="inputPassword" class="col-sm-4 control-label">{{_("Last Name:")}}</label>
      <div class="col-sm-8">
        <p class="form-control-static" id="lastName"></p>
      </div>
    </div>
    <div class="form-group">
      <label for="inputPassword" class="col-sm-4 control-label">{{_("EMail:")}}</label>
      <div class="col-sm-8">
        <p class="form-control-static" id="email"></p>
      </div>
    </div>
  </form>
</div>
<div class="modal-footer">
  <button type="button" class="btn btn-default" data-dismiss="modal" onclick="javascript:; $('#updatePasswordMsg').html(''); $('#newPassword').val(''); $('#newPassword2').val(''); $('#updatePasswordModal').modal('show');">{{_("Reset Password")}}</button>
<button type="button" class="btn btn-default" data-dismiss="modal" onclick="openUpdateUserInfoModal()">{{_("Edit User Information")}}</button>
</div>
</div>
<!-- /.modal-content -->
</div>
<!-- /.modal -->
</div>

<!-- 修改密码（Modal） -->
<div class="modal fade" id="updatePasswordModal" tabindex="-1" role="dialog" aria-labelledby="updatePasswordModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="text-indent: initial;"> &times;
</button>
<h4 class="modal-title">
  {{_("Reset Password")}}
</h4>
</div>
<div class="modal-body">
  <div id="updatePasswordMsg"></div>
  <form class="form-horizontal" role="form">
    <div class="form-group">
      <label class="col-sm-4 control-label">{{_("NewPassword:")}}</label>
      <div class="col-sm-8">
        <input class="form-control-static" type="password" id="newPassword" />
      </div>
    </div>
    <div class="form-group">
      <label class="col-sm-4 control-label">{{_("Confirm Password:")}}</label>
      <div class="col-sm-8">
        <input class="form-control-static" type="password" id="newPassword2" />
      </div>
    </div>
  </form>
</div>
<div class="modal-footer">
  <button type="button" class="btn btn-default" onclick="returnUserInfo('updatePasswordModal')">{{_("Return")}}</button>
<button type="button" class="btn btn-default" onclick="updatePassword()">{{_("Modify")}}</button>
</div>
</div>
<!-- /.modal-content -->
</div>
<!-- /.modal -->
</div>

<!-- 修改个人信息（Modal） -->
<div class="modal fade" id="updateUserInfoModal" tabindex="-1" role="dialog" aria-labelledby="updateUserInfoModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="text-indent: initial;"> &times;
</button>
<h4 class="modal-title">
  {{_("Edit User Information")}}
</h4>
</div>
<div class="modal-body">
  <div id="updateUserInfoMsg"></div>
  <form class="form-horizontal" role="form">
    <div class="form-group">
      <label for="inputPassword" class="col-sm-4 control-label">{{_("First Name:")}}</label>
      <div class="col-sm-8">
        <input type="text" required class="form-control-static" id="firstName2" />
      </div>
    </div>
    <div class="form-group">
      <label for="inputPassword" class="col-sm-4 control-label">{{_("Last Name:")}}</label>
      <div class="col-sm-8">
        <input type="text" required class="form-control-static" id="lastName2" />
      </div>
    </div>
    <div class="form-group">
      <label for="inputPassword" class="col-sm-4 control-label">{{_("EMail:")}}</label>
      <div class="col-sm-8">
        <input type="mail" required class="form-control-static" id="email2" />
      </div>
    </div>
  </form>
</div>
<div class="modal-footer">
  <button type="button" class="btn btn-default" onclick="returnUserInfo('updateUserInfoModal')">{{_("Return")}}</button>
<button type="button" class="btn btn-default" onclick="updateUserInfo()">{{_("Modify")}}</button>
</div>
</div>
<!-- /.modal-content -->
</div>
<!-- /.modal -->
</div>
<!-- BEGIN CORE PLUGINS -->
<script src="/static/assets/resrouces/portalShow/js/jquery.min.js" type="text/javascript"></script>
<script src="/static/assets/resrouces/portalShow/js/bootstrap.min.js" type="text/javascript"></script>
<script src="/static/assets/resrouces/portalShow/js/js.cookie.min.js" type="text/javascript"></script>
<script src="/static/assets/resrouces/portalShow/js/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
<script src="/static/assets/resrouces/portalShow/js/jquery.uniform.min.js" type="text/javascript"></script>
<script src="/static/assets/resrouces/portalShow/js/bootstrap-switch.min.js" type="text/javascript"></script>
<!-- END CORE PLUGINS -->
<script src="/static/assets/resrouces/portalShow/js/morris.min.js" type="text/javascript"></script>
<script src="/static/assets/resrouces/portalShow/js/raphael-min.js" type="text/javascript"></script>
<script src="/static/assets/resrouces/portalShow/js/jquery.waypoints.min.js" type="text/javascript"></script>
<!-- BEGIN THEME GLOBAL SCRIPTS -->
<script src="/static/assets/resrouces/portalShow/js/app.js" type="text/javascript"></script>
<!-- END THEME GLOBAL SCRIPTS -->
<!-- END PAGE LEVEL SCRIPTS -->
<!-- BEGIN THEME LAYOUT SCRIPTS -->
<script src="/static/assets/resrouces/portalShow/js/layout.js" type="text/javascript"></script>
<script src="/static/assets/resrouces/portalShow/js/demo.js" type="text/javascript"></script>
<script src="/static/assets/resrouces/portalShow/js/quick-sidebar.min.js" type="text/javascript"></script>
<script src="/static/assets/resrouces/portalShow/js/jquery-ui.min.js" type="text/javascript"></script>
<!-- END THEME LAYOUT SCRIPTS -->
<!--cleaver table-->
<script src="/static/assets/resrouces/portalShow/js/cleaverTable/jquery.js" type="text/javascript"></script>
<script src="/static/assets/resrouces/portalShow/js/cleaverTable/jquery.contextMenu.js" type="text/javascript"></script>
<script src="/static/assets/resrouces/portalShow/js/cleaverTable/jquery.cleverTabs.js" type="text/javascript"></script>

<script>
  $(function () {
    $("#console").hover(function () {
      $("#console").css('background', '#3f4f62');
    }, function () {
      $("#console").css('background', '');
    })
  })
</script>

</html>

<script>
      var userInfo = null;
      var showConsole = null;
      var portal = null;
      var portals = null;
      var menus = [];
      var tabs;
      $(function () {
        // init tabs
        tabs = $$('#tabs').cleverTabs({
          setupContextMenu: false,
          lockOnlyOne: true,
        });

        // get data from superset
        var bootstrapData = JSON.parse($('#app').attr('data-bootstrap'));
        // console.info(bootstrapData);
        portal = bootstrapData.portal;
        portals = bootstrapData.portals;
        showConsole = bootstrapData.showConsole;
        $('#profileName').html(bootstrapData.username);
        menus = bootstrapData.menus;
        init();

        // let array to parent-children data
        var nodes = getJsonMenu(0, menus);
        // set nav bar
        var html = setNavBar(nodes);
        $('#side-bar ul').first().append(html);

        $(".page-sidebar-menu >.nav-item > a").click(function () {
          $(".page-sidebar-menu > .nav-item > a").removeClass("click").addClass("unclick");
          $(this).removeClass("unclick").addClass("click");
          // $('#side-bar > ul > li .sub-menu').css('display', 'none');
          // $(this).next().css('display', 'block');

        });

      });


      function init() {
        // set portal info(logo, footer)
        $.get('/static/assets/resrouces/portalManage/logo/logo_' + portal[0] + '_' + portal[4] + '.png').success(function (data) {
          $('.page-logo img').attr('src', '/static/assets/resrouces/portalManage/logo/logo_' + portal[0] + '_' + portal[4] + '.png');
        }).error(function (xhr, error) {
          if (xhr.status === 404) {
            $('.page-logo img').attr('src', '/static/assets/resrouces/portalShow/logo.png');
          }
        })
        $('#footer').html(portal[5]);

        // show console
        console.log(showConsole)
        if (showConsole) {
          $('#console').show();
        }
        // switch portal
        var portalStr = '';
        portals.forEach(p => {
          if (p[0] === portal[0]) {
            portalStr += '<li><a href="javascript:;" style="background: #4297d7;"><i class="fa fa-home" style="color: white;"></i><span style="margin-left: 10px; color: white; font-size: 12px;">' + p[1] + '</span></a></li>';
          } else {
            portalStr += '<li><a href="/hand/portal/' + p[0] + '/show"><i class="fa fa-home"></i><span style="margin-left: 10px;  font-size: 12px;">' + p[1] + '</span></a></li>';
          }
        });
        $('#portal').html(portal[1]);
        $('#portals').html(portalStr);

        // set default dashboard
        menus.forEach(menu => {
          if (menu[5] === 'true') {
            tabs.add({
              url: '/superset/dashboard/' + menu[3] + '?standalone=true&isControl=false&isTitle=false&isManager=false',
              label: menu[1]
            });
            var tab = tabs.getTabByUrl('/superset/dashboard/' + menu[3] + '?standalone=true&isControl=false&isTitle=false&isManager=false');
            tab.setLock(true);
          }
        });

        // set autoComplete
        var parentIds = [];
        menus.forEach(menu => {
          if (menu[2] !== 0 && $.inArray(menu[2], menus) === -1) {
            parentIds.push(menu[2]);
          }
        })
        var availableDashboards = [];
        menus.forEach(menu => {
          if ($.inArray(menu[0], parentIds) === -1) {
            availableDashboards.push({
              label: menu[1],
              value: menu[1]
            });
          }
        })
        // set search autocomplete input
        $("#search").autocomplete({
          source: availableDashboards
        });

        // init portal theme
        $.get('/hand/portal/getTheme').done(function (data) {
          var result = JSON.parse(data);
          $("#" + result.color).addClass("current");

          $(".theme-panel .layout-style-option").val(result.themeStyle);
          $(".theme-panel .layout-option").val(result.layout);
          $(".theme-panel .page-header-option").val(result.header);
          $(".theme-panel .page-header-top-dropdown-style-option").val(result.top_menu);
          $(".theme-panel .sidebar-option").val(result.sidebar_mode);
          $(".theme-panel .sidebar-menu-option").val(result.sidebar_menu);
          $(".theme-panel .sidebar-style-option").val(result.sidebar_style);
          $(".theme-panel .sidebar-pos-option").val(result.sidebar_position);
          $(".theme-panel .page-footer-option").val(result.footer);

        }).fail(function (xhr, error) {
          alert('error')
        });

      }

      // open new iframe
      function openFrame(name, href) {
        tabs.add({
          url: '/superset/dashboard/' + href + '?standalone=true&isControl=false&isTitle=false&isManager=false',
          label: name
        });
      }

      function query() {
        var flag = true;
        var dashboardName = $('#search').val();
        if (dashboardName === '') {
          return;
        }
        menus.forEach(menu => {
          if (dashboardName === menu[1]) {
            flag = false;
            $("#search").val("");
            openFrame(menu[1], menu[3]);
          }
        });
        if (flag) {
          alert('the dashboard does not exist');
        }
      }


      // let array to parent-children data
      function getJsonMenu(id, menus) {
        if (id !== 0) {
          var children = [];
          for (var i = 0; i < menus.length; i++) {
            var menu = menus[i];
            if (menu[2] === id) {
              var node = {
                id: menu[0],
                name: menu[1],
                parent_id: menu[2],
                dashboard_href: menu[3],
                open_way: menu[4],
                is_index: menu[5],
                icon: menu[6],
              };
              node.children = getJsonMenu(menu[0], menus);
              children.push(node);
            }
          }
          return children;
        }
        // id == 0
        var nodes = [];
        for (var i = 0; i < menus.length; i++) {
          var menu = menus[i];
          if (menu[2] === 0) {
            var node = {
              id: menu[0],
              name: menu[1],
              parent_id: menu[2],
              dashboard_href: menu[3],
              open_way: menu[4],
              is_index: menu[5],
              icon: menu[6],
            };
            node.children = getJsonMenu(menu[0], menus);
            nodes.push(node);
          }
        }
        return nodes;
      }

      // set nav bar
      function setNavBar(menuObj) {
        var vdom = [];
        if (menuObj instanceof Array) {
          var list = [];
          for (var item of menuObj) {
            list.push(setNavBar(item));
          }
          // console.info(list)
          vdom.push(
            list.join('')
          );
        } else {
          // set arrow
          var arrow = '';
          var aClick = '';
          if (menuObj.children.length > 0) {
            arrow = '<span class="arrow"></span>';
          }
          if (menuObj.children.length === 0) {
            aClick = ' onclick="openFrame(\'' + menuObj.name + '\', \'' + menuObj.dashboard_href + '\')" ';

          }
          if (menuObj.children.length > 0) {
            // have no child
            vdom.push(
              '<li class="nav-item " >' +
              '<a href="#"' + aClick + 'class="nav-link nav-toggle">' +
              '<i class="' + menuObj.icon + '"></i>' +
              '<span class="title" style="margin-left: 10px; font-size: 12px;">' + menuObj.name + '</span>' +
              arrow +
              '</a>' +
              '<ul class="sub-menu">' +
              setNavBar(menuObj.children) +
              '</ul>' +
              '</li>'
            );
          } else {
            vdom.push(
              '<li class="nav-item">' +
              '<a href="#"' + aClick + 'class="nav-link nav-toggle">' +
              '<i class="' + menuObj.icon + '"></i>' +
              '<span class="title" style="margin-left: 10px;font-size: 12px;">' + menuObj.name + '</span>' +
              arrow +
              '</a>' +
              setNavBar(menuObj.children) +
              '</li>'
            );
          }

        }
        return vdom.join('');
      }

      // update password
      function updatePassword() {
        if ($('#newPassword').val().trim().length < 6) {
          $('#updatePasswordMsg').html('<div class="alert alert-warning"><strong>警告!</strong> 密码长度不少于6位. </div>');
          return;
        }
        if ($('#newPassword').val() !== $('#newPassword2').val()) {
          $('#updatePasswordMsg').html('<div class="alert alert-warning"><strong>警告!</strong> 两次密码输入不一致. </div>');
          return;
        }
        $.post('/hand/portal/updatePassword', { newPassword: $('#newPassword').val() }, function (data) {
          if (data === 'success') {
            $('#updatePasswordMsg').html('<div class="alert alert-success"> 密码修改成功. </div>');
            setTimeout(function () {
              $('#updatePasswordModal').modal('hide');
            }, 300);
          } else {
            $('#updatePasswordMsg').html('<div class="alert alert-danger"> 密码修改失败. </div>');
          }
        });

      }

      function opneUserInfoModal() {
        $.get('/hand/portal/getUserInfo', function (data) {
          userInfo = JSON.parse(data);
          // set user info
          $('#username').html(userInfo.username);
          $('#isActive').html(userInfo.active === true ? 'True' : 'False');
          $('#role').html(userInfo.roles);
          $('#loginCount').html(userInfo.login_count);
          $('#firstName').html(userInfo.first_name);
          $('#lastName').html(userInfo.last_name);
          $('#email').html(userInfo.email);
          $('#userInfoModal').modal('show');
        });
      }

      function openUpdateUserInfoModal() {
        $('#updateUserInfoMsg').html('');
        $('#firstName2').val(userInfo.first_name);
        $('#lastName2').val(userInfo.last_name);
        $('#email2').val(userInfo.email);
        $('#updateUserInfoModal').modal('show');
      }

      // return to userInfo
      function returnUserInfo(model) {
        $('#' + model).modal('hide');
        $('#userInfoModal').modal('show');
      }

      // update user info
      function updateUserInfo() {
        if ($('#firstName2').val().trim() === '' || $('#lastName2').val().trim() === '' || $('#email2').val().trim() === '') {
          $('#updateUserInfoMsg').html('<div class="alert alert-warning"><strong>警告!</strong> 修改的信息不能为空 </div>');
          return;
        }
        $.post('/hand/portal/updateUserInfo',
          { firstName: $('#firstName2').val(), lastName: $('#lastName2').val(), email: $('#email2').val() },
          function (data) {
            if (data === 'success') {
              $('#updateUserInfoMsg').html('<div class="alert alert-success"> 信息修改成功. </div>');
              setTimeout(function () {
                $('#updateUserInfoModal').modal('hide');
              }, 300);
            } else {
              $('#updateUserInfoMsg').html('<div class="alert alert-danger"> 信息修改失败. </div>');
            }
          });

      }
</script>