<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>cis_interface.interface.PsiInterface &#8212; cis_interface 0.0.0 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for cis_interface.interface.PsiInterface</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">logging</span> <span class="k">import</span> <span class="n">debug</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">sysv_ipc</span> <span class="k">import</span> <span class="n">MessageQueue</span>
<span class="kn">from</span> <span class="nn">cis_interface.backwards</span> <span class="k">import</span> <span class="n">pickle</span>
<span class="kn">from</span> <span class="nn">cis_interface.interface.scanf</span> <span class="k">import</span> <span class="n">scanf</span>
<span class="kn">from</span> <span class="nn">cis_interface.dataio.AsciiFile</span> <span class="k">import</span> <span class="n">AsciiFile</span>
<span class="kn">from</span> <span class="nn">cis_interface.dataio.AsciiTable</span> <span class="k">import</span> <span class="n">AsciiTable</span>
<span class="kn">from</span> <span class="nn">cis_interface</span> <span class="k">import</span> <span class="n">backwards</span>


<span class="c1"># OS X limit is 2kb</span>
<span class="n">PSI_MSG_MAX</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">PSI_MSG_EOF</span> <span class="o">=</span> <span class="n">backwards</span><span class="o">.</span><span class="n">unicode2bytes</span><span class="p">(</span><span class="s2">&quot;EOF!!!&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="PsiMatlab"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiMatlab">[docs]</a><span class="k">def</span> <span class="nf">PsiMatlab</span><span class="p">(</span><span class="n">_type</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Short interface to identify functions called by Matlab.</span>

<span class="sd">    Args:</span>
<span class="sd">        _type (str): Name of class that should be returned.</span>
<span class="sd">        args (list): Additional arguments that should be passed to class</span>
<span class="sd">            initializer.</span>

<span class="sd">    Returns:</span>
<span class="sd">        obj: An instance of the requested class.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">_type</span><span class="p">)</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;matlab&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">obj</span></div>


<div class="viewcode-block" id="PsiInput"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiInput">[docs]</a><span class="k">class</span> <span class="nc">PsiInput</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Class for handling input from a message queue.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): The name of the message queue. Combined with the</span>
<span class="sd">            suffix &#39;_INT&#39;, it should match an environment variable containing</span>
<span class="sd">            a message queue key.</span>
<span class="sd">        </span>
<span class="sd">    Attributes:</span>
<span class="sd">        name (str): The name of the message queue.</span>
<span class="sd">        qname (str): The name of the message queue combined with the suffix</span>
<span class="sd">            &#39;_IN&#39;.</span>
<span class="sd">        q (:class:`sysv_ipc.MessageQueue`): Message queue.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">qName</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">q</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">matlab</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qName</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_IN&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PsiInput(</span><span class="si">%s</span><span class="s2">):&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;PsiInterface cant see </span><span class="si">%s</span><span class="s1"> in env.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">qName</span><span class="p">)</span>
            <span class="c1"># print(&#39;ERROR:  PsiInterface cant see &#39; + name + &#39; in env&#39;)</span>
            <span class="c1"># exit(-1)</span>
        <span class="n">qid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qName</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">qid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">qid</span><span class="p">)</span>
        <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PsiInput(</span><span class="si">%s</span><span class="s2">): qid </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">qid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q</span> <span class="o">=</span> <span class="n">MessageQueue</span><span class="p">(</span><span class="n">qid</span><span class="p">,</span> <span class="n">max_message_size</span><span class="o">=</span><span class="n">PSI_MSG_MAX</span><span class="p">)</span>
        <span class="n">clidebug</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PSI_CLIENT_DEBUG&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sleeptime</span> <span class="o">=</span> <span class="mf">0.25</span>
        <span class="k">if</span> <span class="n">clidebug</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sleeptime</span> <span class="o">=</span> <span class="mf">2.0</span>

<div class="viewcode-block" id="PsiInput.recv"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiInput.recv">[docs]</a>    <span class="k">def</span> <span class="nf">recv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Receive a message smaller than PSI_MSG_MAX. The process will</span>
<span class="sd">        sleep until there is a message in the queue to receive.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple (bool, str): The success or failure of receiving a message</span>
<span class="sd">                and the message received.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PsiInput(</span><span class="si">%s</span><span class="s2">).recv()&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">current_messages</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PsiInput(</span><span class="si">%s</span><span class="s2">): recv() - no data, sleep&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleeptime</span><span class="p">)</span>
            <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PsiInput(</span><span class="si">%s</span><span class="s2">).recv(): message ready, read it&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">receive</span><span class="p">()</span>  <span class="c1"># ignore ident</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PsiInput(</span><span class="si">%s</span><span class="s2">).recv(): read </span><span class="si">%d</span><span class="s2"> bytes&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
            <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PsiInput(</span><span class="si">%s</span><span class="s2">).recv(): exception </span><span class="si">%s</span><span class="s2">, return None&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">ex</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">payload</span></div>

<div class="viewcode-block" id="PsiInput.recv_nolimit"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiInput.recv_nolimit">[docs]</a>    <span class="k">def</span> <span class="nf">recv_nolimit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Receive a message larger than PSI_MSG_MAX that is sent in multiple</span>
<span class="sd">        parts.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple (bool, str): The success or failure of receiving a message</span>
<span class="sd">                and the complete message received.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PsiInput(</span><span class="si">%s</span><span class="s2">).recv_nolimit()&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>  <span class="c1"># pragma: debug</span>
            <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PsiInput(</span><span class="si">%s</span><span class="s2">).recv_nolimit(): &quot;</span> <span class="o">+</span>
                  <span class="s2">&quot;Failed to receive payload size.&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">payload</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># (leng_exp,) = scanf(&#39;%d&#39;, payload[1])</span>
            <span class="n">leng_exp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">payload</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">leng_exp</span><span class="p">:</span>
                <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>  <span class="c1"># pragma: debug</span>
                    <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PsiInput(</span><span class="si">%s</span><span class="s2">).recv_nolimit(): &quot;</span> <span class="o">+</span>
                          <span class="s2">&quot;read interupted at </span><span class="si">%d</span><span class="s2"> of </span><span class="si">%d</span><span class="s2"> bytes.&quot;</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">leng_exp</span><span class="p">)</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>
                <span class="n">data</span> <span class="o">+=</span> <span class="n">payload</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PsiInput(</span><span class="si">%s</span><span class="s2">).recv_nolimit(): read </span><span class="si">%d</span><span class="s2"> bytes&quot;</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PsiInput(</span><span class="si">%s</span><span class="s2">).recv_nolimit(): &quot;</span> <span class="o">+</span>
                  <span class="s2">&quot;exception </span><span class="si">%s</span><span class="s2">, return None&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">ex</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">payload</span></div></div>
        

<div class="viewcode-block" id="PsiOutput"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiOutput">[docs]</a><span class="k">class</span> <span class="nc">PsiOutput</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Class for handling output to a message queue.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): The name of the message queue. Combined with the</span>
<span class="sd">            suffix &#39;_OUT&#39;, it should match an environment variable containing</span>
<span class="sd">            a message queue key.</span>
<span class="sd">        </span>
<span class="sd">    Attributes:</span>
<span class="sd">        name (str): The name of the message queue.</span>
<span class="sd">        qname (str): The name of the message queue combined with the suffix</span>
<span class="sd">            &#39;_OUT&#39;.</span>
<span class="sd">        q (:class:`sysv_ipc.MessageQueue`): Message queue.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">matlab</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qName</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_OUT&#39;</span>
        <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PsiOputput(</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;PsiInterface cant see </span><span class="si">%s</span><span class="s1"> in env.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">qName</span><span class="p">)</span>
            <span class="c1"># print(&#39;ERROR:  PsiInterface cant see &#39; + name + &#39; in env&#39;)</span>
            <span class="c1"># exit(-1)</span>
        <span class="n">qid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_OUT&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q</span> <span class="o">=</span> <span class="n">MessageQueue</span><span class="p">(</span><span class="n">qid</span><span class="p">,</span> <span class="n">max_message_size</span><span class="o">=</span><span class="n">PSI_MSG_MAX</span><span class="p">)</span>
        <span class="k">return</span>

<div class="viewcode-block" id="PsiOutput.send"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiOutput.send">[docs]</a>    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Send a message smaller than PSI_MSG_MAX.</span>

<span class="sd">        Args:</span>
<span class="sd">            payload (str): Message to send.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Success or failure of sending the message.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PsiOutput(</span><span class="si">%s</span><span class="s2">).send(</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PsiOutput(</span><span class="si">%s</span><span class="s2">).sent(</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
            <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PsiOutput(</span><span class="si">%s</span><span class="s2">).send(</span><span class="si">%s</span><span class="s2">): exception: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">ex</span><span class="p">))</span>
        <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PsiOutput(</span><span class="si">%s</span><span class="s2">).send(</span><span class="si">%s</span><span class="s2">): returns </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">ret</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="PsiOutput.send_nolimit"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiOutput.send_nolimit">[docs]</a>    <span class="k">def</span> <span class="nf">send_nolimit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Send a message larger than PSI_MSG_MAX in multiple parts.</span>

<span class="sd">        Args:</span>
<span class="sd">            payload (str): Message to send.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Success or failure of sending the message.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%ld</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
            <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PsiOutput(</span><span class="si">%s</span><span class="s2">).send_nolimit: &quot;</span> <span class="o">+</span>
                  <span class="s2">&quot;Sending size of payload failed.&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ret</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">prev</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
            <span class="nb">next</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">prev</span> <span class="o">+</span> <span class="n">PSI_MSG_MAX</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">[</span><span class="n">prev</span><span class="p">:</span><span class="nb">next</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
                <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PsiOutput(</span><span class="si">%s</span><span class="s2">).send_nolimit(): &quot;</span> <span class="o">+</span>
                      <span class="s2">&quot;send interupted at </span><span class="si">%d</span><span class="s2"> of </span><span class="si">%d</span><span class="s2"> bytes.&quot;</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">prev</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span>
                <span class="k">break</span>
            <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PsiOutput(</span><span class="si">%s</span><span class="s2">).send_nolimit(): </span><span class="si">%d</span><span class="s2"> of </span><span class="si">%d</span><span class="s2"> bytes sent&quot;</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">next</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span>
            <span class="n">prev</span> <span class="o">=</span> <span class="nb">next</span>
        <span class="k">if</span> <span class="n">ret</span><span class="p">:</span>
            <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PsiOutput(</span><span class="si">%s</span><span class="s2">).send_nolimit </span><span class="si">%d</span><span class="s2"> bytes completed&quot;</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ret</span></div></div>

    
<div class="viewcode-block" id="PsiRpc"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiRpc">[docs]</a><span class="k">class</span> <span class="nc">PsiRpc</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Class for sending a message and then receiving a response.</span>

<span class="sd">    Args:</span>
<span class="sd">        outname (str): The name of the output message queue.</span>
<span class="sd">        outfmt (str): Format string used to format variables in a</span>
<span class="sd">            message sent to the output message queue.</span>
<span class="sd">        inname (str): The name of the input message queue.</span>
<span class="sd">        infmt (str): Format string used to recover variables from</span>
<span class="sd">            messages received from the input message queue.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outname</span><span class="p">,</span> <span class="n">outfmt</span><span class="p">,</span> <span class="n">inname</span><span class="p">,</span> <span class="n">infmt</span><span class="p">,</span> <span class="n">matlab</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">matlab</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inFmt</span> <span class="o">=</span> <span class="n">backwards</span><span class="o">.</span><span class="n">decode_escape</span><span class="p">(</span><span class="n">infmt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_outFmt</span> <span class="o">=</span> <span class="n">backwards</span><span class="o">.</span><span class="n">decode_escape</span><span class="p">(</span><span class="n">outfmt</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inFmt</span> <span class="o">=</span> <span class="n">infmt</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_outFmt</span> <span class="o">=</span> <span class="n">outfmt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_in</span> <span class="o">=</span> <span class="n">PsiInput</span><span class="p">(</span><span class="n">inname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_out</span> <span class="o">=</span> <span class="n">PsiOutput</span><span class="p">(</span><span class="n">outname</span><span class="p">)</span>

<div class="viewcode-block" id="PsiRpc.rpcSend"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiRpc.rpcSend">[docs]</a>    <span class="k">def</span> <span class="nf">rpcSend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Send arguments as a message created using the output format string.</span>

<span class="sd">        Args:</span>
<span class="sd">            \*args: All arguments are formatted using the output format string</span>
<span class="sd">                to create the message.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Success or failure of sending the message.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outmsg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outFmt</span> <span class="o">%</span> <span class="n">args</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">send_nolimit</span><span class="p">(</span><span class="n">outmsg</span><span class="p">)</span></div>

<div class="viewcode-block" id="PsiRpc.rpcRecv"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiRpc.rpcRecv">[docs]</a>    <span class="k">def</span> <span class="nf">rpcRecv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Receive a message and get arguments by parsing the recieved message</span>
<span class="sd">        using the input format string.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple (bool, tuple): Success or failure of receiving a message and</span>
<span class="sd">                the tuple of arguments retreived by parsing the message using</span>
<span class="sd">                the input format string.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">retval</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_in</span><span class="o">.</span><span class="n">recv_nolimit</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">retval</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">scanf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inFmt</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">retval</span><span class="p">,</span> <span class="n">args</span></div>

<div class="viewcode-block" id="PsiRpc.rpcCall"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiRpc.rpcCall">[docs]</a>    <span class="k">def</span> <span class="nf">rpcCall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Send arguments using the output format string to format a message</span>
<span class="sd">        and then receive values back by parsing the response message with the</span>
<span class="sd">        input format string.</span>

<span class="sd">        Args:</span>
<span class="sd">            \*args: All arguments are formatted using the output format string</span>
<span class="sd">                to create the message.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple (bool, tuple): Success or failure of receiving a message and</span>
<span class="sd">                the tuple of arguments retreived by parsing the message using</span>
<span class="sd">                the input format string.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpcSend</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpcRecv</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="PsiRpcServer"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiRpcServer">[docs]</a><span class="k">class</span> <span class="nc">PsiRpcServer</span><span class="p">(</span><span class="n">PsiRpc</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Class for handling requests and response for an RPC Server.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): The name of the server queues.</span>
<span class="sd">        infmt (str): Format string used to recover variables from</span>
<span class="sd">            messages received from the request queue.</span>
<span class="sd">        outfmt (str): Format string used to format variables in a</span>
<span class="sd">            message sent to the response queue.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">infmt</span><span class="p">,</span> <span class="n">outfmt</span><span class="p">,</span> <span class="n">matlab</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PsiRpcServer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">outfmt</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">infmt</span><span class="p">)</span></div>
    

<div class="viewcode-block" id="PsiRpcClient"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiRpcClient">[docs]</a><span class="k">class</span> <span class="nc">PsiRpcClient</span><span class="p">(</span><span class="n">PsiRpc</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Class for handling requests and response to an RPC Server from a</span>
<span class="sd">    client.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): The name of the server queues.</span>
<span class="sd">        outfmt (str): Format string used to format variables in a</span>
<span class="sd">            message sent to the request queue.</span>
<span class="sd">        infmt (str): Format string used to recover variables from</span>
<span class="sd">            messages received from the response queue.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">outfmt</span><span class="p">,</span> <span class="n">infmt</span><span class="p">,</span> <span class="n">matlab</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PsiRpcClient</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">outfmt</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">infmt</span><span class="p">)</span></div>
    

<span class="c1"># Specialized classes for ascii IO</span>
<div class="viewcode-block" id="PsiAsciiFileInput"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiAsciiFileInput">[docs]</a><span class="k">class</span> <span class="nc">PsiAsciiFileInput</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Class for generic ASCII input from either a file or message queue.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): Path to the local file that input should be read from (if</span>
<span class="sd">            src_type == 0) or the name of the input message queue that input</span>
<span class="sd">            should be received from.</span>
<span class="sd">        src_type (int, optional): If 0, input is read from a local file.</span>
<span class="sd">            Otherwise input is received from a message queue. Defauts to 1.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_type</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_file</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_psi</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">src_type</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">matlab</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="n">src_type</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="n">AsciiFile</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_psi</span> <span class="o">=</span> <span class="n">PsiInput</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="n">AsciiFile</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="PsiAsciiFileInput.recv_line"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiAsciiFileInput.recv_line">[docs]</a>    <span class="k">def</span> <span class="nf">recv_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Receive a single line of ASCII input.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple(bool, str): Success or failure of receiving a line and the</span>
<span class="sd">                line received (including the newline character).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">eof</span><span class="p">,</span> <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="p">(</span><span class="ow">not</span> <span class="n">eof</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span><span class="p">,</span> <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_psi</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">line</span> <span class="o">==</span> <span class="n">PSI_MSG_EOF</span><span class="p">):</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">ret</span><span class="p">,</span> <span class="n">line</span></div></div>


<div class="viewcode-block" id="PsiAsciiFileOutput"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiAsciiFileOutput">[docs]</a><span class="k">class</span> <span class="nc">PsiAsciiFileOutput</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Class for generic ASCII output to either a local file or message</span>
<span class="sd">    queue.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): Path to the local file where output should be written (if</span>
<span class="sd">            dst_type == 0) or the name of the message queue where output should</span>
<span class="sd">            be sent.</span>
<span class="sd">        dst_type (int, optional): If 0, output is written to a local file.</span>
<span class="sd">            Otherwise, output is sent to a message queue. Defaults to 1.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_type</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_file</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_psi</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">dst_type</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">matlab</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="n">dst_type</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="n">AsciiFile</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_psi</span> <span class="o">=</span> <span class="n">PsiOutput</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="n">AsciiFile</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="PsiAsciiFileOutput.send_eof"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiAsciiFileOutput.send_eof">[docs]</a>    <span class="k">def</span> <span class="nf">send_eof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Send an end-of-file message to the message queue.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_psi</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">PSI_MSG_EOF</span><span class="p">)</span></div>

<div class="viewcode-block" id="PsiAsciiFileOutput.send_line"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiAsciiFileOutput.send_line">[docs]</a>    <span class="k">def</span> <span class="nf">send_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Output a single ASCII line.</span>

<span class="sd">        Args:</span>
<span class="sd">            line (str): Line to output (including newline character).</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Success or failure of sending the line.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">writeline</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_psi</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div></div>


<span class="c1"># Specialized classes for ascii table IO</span>
<div class="viewcode-block" id="PsiAsciiTableInput"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiAsciiTableInput">[docs]</a><span class="k">class</span> <span class="nc">PsiAsciiTableInput</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Class for handling table-like formatted input.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): The path to the local file to read input from (if src_type</span>
<span class="sd">            == 0) or the name of the message queue input should be received</span>
<span class="sd">            from.</span>
<span class="sd">        src_type (int, optional): If 0, input is read from a local file.</span>
<span class="sd">            Otherwise, the input is received from a message queue. Defaults to</span>
<span class="sd">            1.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_type</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_table</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_psi</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">src_type</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">matlab</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="n">src_type</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table</span> <span class="o">=</span> <span class="n">AsciiTable</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_psi</span> <span class="o">=</span> <span class="n">PsiInput</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">ret</span><span class="p">,</span> <span class="n">format_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_psi</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR:  PsiAsciiTableInput could not &#39;</span> <span class="o">+</span>
                      <span class="s1">&#39;receive format string from input&#39;</span><span class="p">)</span>
                <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table</span> <span class="o">=</span> <span class="n">AsciiTable</span><span class="p">(</span>
                <span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">format_str</span><span class="o">=</span><span class="n">format_str</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;string_escape&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<div class="viewcode-block" id="PsiAsciiTableInput.recv_row"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiAsciiTableInput.recv_row">[docs]</a>    <span class="k">def</span> <span class="nf">recv_row</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Receive a single row of variables from the input.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple(bool, tuple): Success or failure of receiving the row and</span>
<span class="sd">                the variables recovered from the row.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">eof</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="p">(</span><span class="ow">not</span> <span class="n">eof</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_psi</span><span class="o">.</span><span class="n">recv_nolimit</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">ret</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">process_line</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">ret</span><span class="p">,</span> <span class="n">args</span></div>

<div class="viewcode-block" id="PsiAsciiTableInput.recv_array"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiAsciiTableInput.recv_array">[docs]</a>    <span class="k">def</span> <span class="nf">recv_array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Receive an entire array of table data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple(bool, np.ndarray): Success or failure of receiving the row</span>
<span class="sd">                and the array of table data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">read_array</span><span class="p">()</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_psi</span><span class="o">.</span><span class="n">recv_nolimit</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">ret</span><span class="p">:</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">bytes_to_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">arr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">ret</span><span class="p">,</span> <span class="n">arr</span></div></div>


<div class="viewcode-block" id="PsiAsciiTableOutput"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiAsciiTableOutput">[docs]</a><span class="k">class</span> <span class="nc">PsiAsciiTableOutput</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Class for handling table-like formatted output.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): The path to the local file where output should be saved</span>
<span class="sd">            (if dst_type == 0) or the name of the message queue where the</span>
<span class="sd">            output should be sent.</span>
<span class="sd">        fmt (str): A C style format string specifying how each &#39;row&#39; of output</span>
<span class="sd">            should be formated. This should include the newline character.</span>
<span class="sd">        dst_type (int, optional): If 0, output is sent to a local file.</span>
<span class="sd">            Otherwise, the output is sent to a message queue. Defaults to 1.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_type</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_table</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_psi</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">dst_type</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">matlab</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="n">dst_type</span>
        <span class="k">if</span> <span class="n">matlab</span><span class="p">:</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="n">backwards</span><span class="o">.</span><span class="n">decode_escape</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table</span> <span class="o">=</span> <span class="n">AsciiTable</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">format_str</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">writeformat</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_psi</span> <span class="o">=</span> <span class="n">PsiOutput</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table</span> <span class="o">=</span> <span class="n">AsciiTable</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">format_str</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_psi</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;string_escape&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<div class="viewcode-block" id="PsiAsciiTableOutput.send_eof"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiAsciiTableOutput.send_eof">[docs]</a>    <span class="k">def</span> <span class="nf">send_eof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Send an end-of-file message to the message queue.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_psi</span><span class="o">.</span><span class="n">send_nolimit</span><span class="p">(</span><span class="n">PSI_MSG_EOF</span><span class="p">)</span></div>

<div class="viewcode-block" id="PsiAsciiTableOutput.send_row"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiAsciiTableOutput.send_row">[docs]</a>    <span class="k">def</span> <span class="nf">send_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Output arguments as a formated row to either a local file or</span>
<span class="sd">        message queue.</span>

<span class="sd">        Args:</span>
<span class="sd">            \*args: All arguments are formated to create a table &#39;row&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Success or failure of outputing the row.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">writeline</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">format_line</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_psi</span><span class="o">.</span><span class="n">send_nolimit</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="PsiAsciiTableOutput.send_array"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiAsciiTableOutput.send_array">[docs]</a>    <span class="k">def</span> <span class="nf">send_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Output an array of table data to either a local file or message</span>
<span class="sd">        sueue.</span>

<span class="sd">        Args:</span>
<span class="sd">            arr (numpy.ndarray): Array of table data. The first dimension is</span>
<span class="sd">                assumed to be table rows and the second dimension is assumed to</span>
<span class="sd">                be table columns.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Success or failure of outputing the array.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">array_to_bytes</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_psi</span><span class="o">.</span><span class="n">send_nolimit</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div></div>

    
<div class="viewcode-block" id="PsiPickleInput"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiPickleInput">[docs]</a><span class="k">class</span> <span class="nc">PsiPickleInput</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Class for handling pickled input.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): The path to the local file to read input from (if src_type</span>
<span class="sd">            == 0) or the name of the message queue input should be received</span>
<span class="sd">            from.</span>
<span class="sd">        src_type (int, optional): If 0, input is read from a local file.</span>
<span class="sd">            Otherwise, the input is received from a message queue. Defaults to</span>
<span class="sd">            1.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_type</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">_file</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_psi</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">src_type</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">matlab</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="n">src_type</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_psi</span> <span class="o">=</span> <span class="n">PsiInput</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="PsiPickleInput.recv"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiPickleInput.recv">[docs]</a>    <span class="k">def</span> <span class="nf">recv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Receive a single pickled object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple(bool, object): Success or failure of receiving a pickled</span>
<span class="sd">                object and the unpickled object that was received.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">)</span>
                <span class="n">eof</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">eof</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="p">(</span><span class="ow">not</span> <span class="n">eof</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span><span class="p">,</span> <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_psi</span><span class="o">.</span><span class="n">recv_nolimit</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">pickle</span><span class="o">.</span><span class="n">UnpicklingError</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">ret</span><span class="p">,</span> <span class="n">obj</span></div></div>


<div class="viewcode-block" id="PsiPickleOutput"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiPickleOutput">[docs]</a><span class="k">class</span> <span class="nc">PsiPickleOutput</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Class for handling pickled output.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): The path to the local file where output should be saved</span>
<span class="sd">            (if dst_type == 0) or the name of the message queue where the</span>
<span class="sd">            output should be sent.</span>
<span class="sd">        fmt (str): A C style format string specifying how each &#39;row&#39; of output</span>
<span class="sd">            should be formated. This should include the newline character.</span>
<span class="sd">        dst_type (int, optional): If 0, output is sent to a local file.</span>
<span class="sd">            Otherwise, the output is sent to a message queue. Defaults to 1.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_type</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_file</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_psi</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">dst_type</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">matlab</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="n">dst_type</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_psi</span> <span class="o">=</span> <span class="n">PsiOutput</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="PsiPickleOutput.send"><a class="viewcode-back" href="../../../cis_interface.interface.html#cis_interface.interface.PsiInterface.PsiPickleOutput.send">[docs]</a>    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Output an object as a pickled string to either a local file or</span>
<span class="sd">        message queue.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (object): Any python object that can be pickled.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Success or failure of outputing the pickled object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">)</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="n">pickle</span><span class="o">.</span><span class="n">PicklingError</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="n">pickle</span><span class="o">.</span><span class="n">PicklingError</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">ret</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_psi</span><span class="o">.</span><span class="n">send_nolimit</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Meagan Lang, David Raila.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>