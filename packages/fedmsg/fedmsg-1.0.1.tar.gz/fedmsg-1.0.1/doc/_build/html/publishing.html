
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Publishing &#8212; fedmsg 1.0.1 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Subscribing" href="subscribing.html" />
    <link rel="prev" title="Commands" href="commands.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="publishing">
<h1>Publishing<a class="headerlink" href="#publishing" title="Permalink to this headline">¶</a></h1>
<p>Before you start publishing messages, it is recommended that you call
<a class="reference internal" href="api.html#fedmsg.init" title="fedmsg.init"><code class="xref py py-func docutils literal"><span class="pre">fedmsg.init()</span></code></a>. This should be done from every Python thread you intend
to publish messages from, and should be done early in your application’s
initialization. The reason for this is that this call creates a thread-local
<a class="reference external" href="https://pyzmq.readthedocs.io/en/stable/api/zmq.html#zmq.Context" title="(in PyZMQ v16.0.2)"><code class="xref py py-class docutils literal"><span class="pre">zmq.Context</span></code></a> and bind to a socket for publishing.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Since the network’s latency is not 0, it can take some time before
a subscriber has set up its connection to the publishing socket. When a
publishing socket has no subscribers, it simply drops the published message.
Currently, the only way to avoid lost messages is to initialize the socket
as early as you can.</p>
</div>
<p>To publish a message, call <a class="reference internal" href="api.html#fedmsg.publish" title="fedmsg.publish"><code class="xref py py-func docutils literal"><span class="pre">fedmsg.publish()</span></code></a>. Your message should be a
Python dictionary capable of being JSON-serialized. Additionally, any strings
it contains should be a text type. That is, <code class="xref py py-class docutils literal"><span class="pre">unicode</span></code> in Python 2 and
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.6)"><code class="xref py py-class docutils literal"><span class="pre">str</span></code></a> in Python 3.</p>
<div class="section" id="publishing-through-a-relay">
<h2>Publishing Through a Relay<a class="headerlink" href="#publishing-through-a-relay" title="Permalink to this headline">¶</a></h2>
<p>It’s possible to avoid having each thread bind to a socket for publishing. To
do so, you need to set up a <a class="reference internal" href="commands.html#command-relay"><span class="std std-ref">fedmsg-relay</span></a> service. Once it’s running, you
need to set <a class="reference internal" href="configuration.html#conf-active"><span class="std std-ref">active</span></a> to <code class="docutils literal"><span class="pre">True</span></code>, which causes publishing sockets to
connect to the socket specified in <a class="reference internal" href="configuration.html#conf-relay-inbound"><span class="std std-ref">relay_inbound</span></a>.</p>
</div>
<div class="section" id="publishing-without-zeromq">
<span id="publishing-sans-zmq"></span><h2>Publishing Without ZeroMQ<a class="headerlink" href="#publishing-without-zeromq" title="Permalink to this headline">¶</a></h2>
<p>fedmsg also supports publishing your messages via <a class="reference external" href="https://stomp.github.io/">STOMP</a>. Brokers that support STOMP include <a class="reference external" href="https://www.rabbitmq.com/">RabbitMQ</a> and <a class="reference external" href="http://activemq.apache.org/">Apache ActiveMQ</a>.
Consult the <a class="reference internal" href="configuration.html#conf-stomp"><span class="std std-ref">STOMP Configuration</span></a> for details on how to configure this.</p>
</div>
<div class="section" id="common-problems">
<h2>Common Problems<a class="headerlink" href="#common-problems" title="Permalink to this headline">¶</a></h2>
<p>There are a set of problems users commonly encounter when publishing messages,
nearly all of them related to configuration. Check the logs to see if there are
any helpful messages.</p>
<div class="section" id="zeromq-not-enabled">
<h3>ZeroMQ Not Enabled<a class="headerlink" href="#zeromq-not-enabled" title="Permalink to this headline">¶</a></h3>
<p>fedmsg supports publishing messages using protocols other than ZeroMQ. If you neglect
to set <a class="reference internal" href="configuration.html#conf-zmq-enabled"><span class="std std-ref">zmq_enabled</span></a> to <code class="docutils literal"><span class="pre">True</span></code>, fedmsg will attempt to publish the message
with <a class="reference external" href="https://moksha.readthedocs.io/en/latest/main/MokshaHub/">Moksha’s Hub</a>. If the
hub has not been initialized, you’ll receive an <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#AttributeError" title="(in Python v3.6)"><code class="xref py py-class docutils literal"><span class="pre">AttributeError</span></code></a> when you call
<a class="reference internal" href="api.html#fedmsg.publish" title="fedmsg.publish"><code class="xref py py-func docutils literal"><span class="pre">fedmsg.publish()</span></code></a>.</p>
</div>
<div class="section" id="no-endpoints-available">
<h3>No Endpoints Available<a class="headerlink" href="#no-endpoints-available" title="Permalink to this headline">¶</a></h3>
<p>Currently, unless you are publishing through a relay, you must declare a list
of endpoints that fedmsg can bind to. Each Python thread, when <a class="reference internal" href="api.html#fedmsg.init" title="fedmsg.init"><code class="xref py py-func docutils literal"><span class="pre">fedmsg.init()</span></code></a>
is called, iterates through the list and attempts to bind to each address. If it
is unable to bind to any address, an <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#IOError" title="(in Python v3.6)"><code class="xref py py-class docutils literal"><span class="pre">IOError</span></code></a> is raised. The solution is
to add more endpoints to the configuration.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/fedmsg.png" alt="Logo"/>
    
    <h1 class="logo logo-name">fedmsg</h1>
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=fedora-infra&repo=fedmsg&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="commands.html">Commands</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Publishing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#publishing-through-a-relay">Publishing Through a Relay</a></li>
<li class="toctree-l2"><a class="reference internal" href="#publishing-without-zeromq">Publishing Without ZeroMQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="#common-problems">Common Problems</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="subscribing.html">Subscribing</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html">Deploying fedmsg</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">Developer Interface</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="commands.html" title="previous chapter">Commands</a></li>
      <li>Next: <a href="subscribing.html" title="next chapter">Subscribing</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2012 - 2017, Red Hat. Inc, and others.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/publishing.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>