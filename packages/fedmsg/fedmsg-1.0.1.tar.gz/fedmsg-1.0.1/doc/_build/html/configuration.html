
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Configuration &#8212; fedmsg 1.0.1 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Commands" href="commands.html" />
    <link rel="prev" title="Installation" href="installation.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="configuration">
<span id="conf"></span><h1>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h1>
<p>fedmsg requires some configuration before it will work properly.</p>
<div class="section" id="general-configuration">
<h2>General configuration<a class="headerlink" href="#general-configuration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="active">
<span id="conf-active"></span><h3>active<a class="headerlink" href="#active" title="Permalink to this headline">¶</a></h3>
<p>A boolean that, if <code class="docutils literal"><span class="pre">True</span></code>, will cause the publishing socket to connect to the
<a class="reference internal" href="#conf-relay-inbound"><span class="std std-ref">relay_inbound</span></a> socket, rather than binding its own socket.</p>
</div>
<div class="section" id="topic-prefix">
<span id="conf-topic-prefix"></span><h3>topic_prefix<a class="headerlink" href="#topic-prefix" title="Permalink to this headline">¶</a></h3>
<p>A string prefixed to the topics of all outgoing messages.</p>
<p>The default value is <code class="docutils literal"><span class="pre">org.fedoraproject</span></code>.</p>
</div>
<div class="section" id="environment">
<span id="conf-environment"></span><h3>environment<a class="headerlink" href="#environment" title="Permalink to this headline">¶</a></h3>
<p>A string that must be one of <code class="docutils literal"><span class="pre">['prod',</span> <span class="pre">'stg',</span> <span class="pre">'dev']</span></code>.  It signifies
the environment in which this fedmsg process is running and can be used
to weakly separate different logical buses running in the same
infrastructure.  It is used by <a class="reference internal" href="api.html#fedmsg.publish" title="fedmsg.publish"><code class="xref py py-func docutils literal"><span class="pre">fedmsg.publish()</span></code></a> when it is
constructing a fully-qualified topic.</p>
</div>
<div class="section" id="status-directory">
<span id="conf-status-directory"></span><h3>status_directory<a class="headerlink" href="#status-directory" title="Permalink to this headline">¶</a></h3>
<p>A string that is the absolute path to a directory where consumers can save the
status of their last processed message.  In conjunction with
<a class="reference internal" href="#datagrepper-url">datagrepper_url</a>, allows for automatic retrieval of backlog on daemon
startup.</p>
</div>
<div class="section" id="datagrepper-url">
<span id="conf-datagrepper-url"></span><h3>datagrepper_url<a class="headerlink" href="#datagrepper-url" title="Permalink to this headline">¶</a></h3>
<p>A URL to an instance of the <a class="reference external" href="https://github.com/fedora-infra/datagrepper">datagrepper</a> web service, such as
<a class="reference external" href="https://apps.fedoraproject.org/datagrepper/raw">https://apps.fedoraproject.org/datagrepper/raw</a>.  Can be used in conjunction with
<a class="reference internal" href="#status-directory">status_directory</a> to allow for automatic retrieval of backlog on daemon
startup.</p>
</div>
<div class="section" id="endpoints">
<span id="conf-endpoints"></span><h3>endpoints<a class="headerlink" href="#endpoints" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">dict</span></code> - A mapping of “service keys” to “zeromq endpoints”; the
heart of fedmsg.</p>
<p><code class="docutils literal"><span class="pre">endpoints</span></code> is “a list of possible addresses from which fedmsg can
send messages.”  Thus, “subscribing to the bus” means subscribing to
every address listed in this dictionary.</p>
<p><code class="docutils literal"><span class="pre">endpoints</span></code> is also an index where a fedmsg process can look up
what port it should bind to to begin emitting messages.</p>
<p>When <a class="reference internal" href="api.html#fedmsg.init" title="fedmsg.init"><code class="xref py py-func docutils literal"><span class="pre">fedmsg.init()</span></code></a> is invoked, a “name” is determined.  It is
either passed explicitly, or guessed from the call stack.  The name is
combined with the hostname of the process and used as a lookup key in
the <code class="docutils literal"><span class="pre">endpoints</span></code> dict.</p>
<p>When sending, fedmsg will attempt to bind to each of the addresses
listed under its service key until it can succeed in acquiring the port.
There needs to be as many endpoints listed as there will be
<code class="docutils literal"><span class="pre">processes</span> <span class="pre">*</span> <span class="pre">threads</span></code> trying to publish messages for a given
service key.</p>
<p>For example, the following config provides for four WSGI processes on
bodhi on the machine app01 to send fedmsg messages.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">endpoints</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="s2">&quot;bodhi.app01&quot;</span><span class="p">:</span>  <span class="p">[</span>
<span class="gp">... </span>              <span class="s2">&quot;tcp://app01.phx2.fedoraproject.org:3000&quot;</span><span class="p">,</span>
<span class="gp">... </span>              <span class="s2">&quot;tcp://app01.phx2.fedoraproject.org:3001&quot;</span><span class="p">,</span>
<span class="gp">... </span>              <span class="s2">&quot;tcp://app01.phx2.fedoraproject.org:3002&quot;</span><span class="p">,</span>
<span class="gp">... </span>              <span class="s2">&quot;tcp://app01.phx2.fedoraproject.org:3003&quot;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">],</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>If apache is configured to start up five WSGI processes, the fifth
one will produce tracebacks complaining with
<code class="docutils literal"><span class="pre">IOError(&quot;Couldn't</span> <span class="pre">find</span> <span class="pre">an</span> <span class="pre">available</span> <span class="pre">endpoint.&quot;)</span></code>.</p>
<p>If apache is configured to start up four WSGI processes, but with two
threads each, four of those threads will raise exceptions with the same
complaints.</p>
<p>A process subscribing to the fedmsg bus will connect a zeromq SUB
socket to every endpoint listed in the <code class="docutils literal"><span class="pre">endpoints</span></code> dict.  Using
the above config, it would connect to the four ports on
app01.phx2.fedoraproject.org.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>This is possibly the most complicated and hardest to
understand part of fedmsg.  It is the black sheep of the design.  All
of the simplicity enjoyed by the python API is achieved at cost of
offloading the complexity here.</p>
<p class="last">Some work could be done to clarify the language used for “name” and
“service key”.  It is not always consistent in <code class="xref py py-mod docutils literal"><span class="pre">fedmsg.core</span></code>.</p>
</div>
</div>
<div class="section" id="srv-endpoints">
<span id="conf-srv-endpoints"></span><h3>srv_endpoints<a class="headerlink" href="#srv-endpoints" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">list</span></code> - A list of domain names for which to query SRV records
to get the associated endpoints.</p>
<p>When using fedmsg.config.load_config(), the DNS lookup is done and the
resulting endpoints are added to config[‘endpoint’][$DOMAINNAME]</p>
<p>For example, the following would query the endpoints for foo.example.com.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">srv_endpoints</span><span class="o">=</span><span class="p">[</span><span class="n">foo</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="p">]</span>
<span class="go">...)</span>
</pre></div>
</div>
</div>
<div class="section" id="replay-endpoints">
<span id="conf-replay-endpoints"></span><h3>replay_endpoints<a class="headerlink" href="#replay-endpoints" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">dict</span></code> - A mapping of service keys, the same as for <a class="reference internal" href="#endpoints">endpoints</a>
to replay endpoints, each key having only one. The replay endpoints are
special ZMQ endpoints using a specific protocol to allow the client to
request a playback of messages in case some have been dropped, for
instance due to network failures.</p>
<p>If the service has a replay endpoint specified, fedmsg will automatically
try to detect such failures and properly query the endpoint to get the
playback if needed.</p>
</div>
<div class="section" id="relay-inbound">
<span id="conf-relay-inbound"></span><h3>relay_inbound<a class="headerlink" href="#relay-inbound" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">str</span></code> - A list of special zeromq endpoints where the inbound,
passive zmq SUB sockets for for instances of <code class="docutils literal"><span class="pre">fedmsg-relay</span></code> are
listening.</p>
<p>Commands like <code class="docutils literal"><span class="pre">fedmsg-logger</span></code> actively connect here and publish their
messages.</p>
<p>See <a class="reference internal" href="commands.html"><span class="doc">Commands</span></a> for more information.</p>
</div>
<div class="section" id="relay-outbound">
<span id="conf-relay-outbound"></span><h3>relay_outbound<a class="headerlink" href="#relay-outbound" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">str</span></code> - A list of special zeromq endpoints where the outbound
sockets for instances of <code class="docutils literal"><span class="pre">fedmsg-relay</span></code> should bind.</p>
</div>
<div class="section" id="fedmsg-consumers-gateway-port">
<span id="conf-fedmsg-consumers-gateway-port"></span><h3>fedmsg.consumers.gateway.port<a class="headerlink" href="#fedmsg-consumers-gateway-port" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">int</span></code> - A port number for the special outbound zeromq PUB socket
posted by <a class="reference internal" href="commands.html#fedmsg.commands.gateway.gateway" title="fedmsg.commands.gateway.gateway"><code class="xref py py-func docutils literal"><span class="pre">fedmsg.commands.gateway.gateway()</span></code></a>.  The
<code class="docutils literal"><span class="pre">fedmsg-gateway</span></code> command is described in more detail in
<a class="reference internal" href="commands.html"><span class="doc">Commands</span></a>.</p>
</div>
</div>
<div class="section" id="authentication-and-authorization">
<h2>Authentication and Authorization<a class="headerlink" href="#authentication-and-authorization" title="Permalink to this headline">¶</a></h2>
<p>The following settings relate to message authentication and authorization.</p>
<div class="section" id="sign-messages">
<span id="conf-sign-messages"></span><h3>sign_messages<a class="headerlink" href="#sign-messages" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">bool</span></code> - If set to true, then <code class="xref py py-mod docutils literal"><span class="pre">fedmsg.core</span></code> will try to sign
every message sent using the machinery from <a class="reference internal" href="api.html#module-fedmsg.crypto" title="fedmsg.crypto"><code class="xref py py-mod docutils literal"><span class="pre">fedmsg.crypto</span></code></a>.</p>
<p>It is often useful to set this to <cite>False</cite> when developing.  You may not
have X509 certs or the tools to generate them just laying around.  If
disabled, you will likely want to also disable
<a class="reference internal" href="#validate-signatures">validate_signatures</a>.</p>
</div>
<div class="section" id="validate-signatures">
<span id="conf-validate-signatures"></span><h3>validate_signatures<a class="headerlink" href="#validate-signatures" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">bool</span></code> - If set to true, then the base class
<a class="reference internal" href="api.html#fedmsg.consumers.FedmsgConsumer" title="fedmsg.consumers.FedmsgConsumer"><code class="xref py py-class docutils literal"><span class="pre">fedmsg.consumers.FedmsgConsumer</span></code></a> will try to use
<a class="reference internal" href="api.html#fedmsg.crypto.validate" title="fedmsg.crypto.validate"><code class="xref py py-func docutils literal"><span class="pre">fedmsg.crypto.validate()</span></code></a> to validate messages before handing
them off to the particular consumer for which the message is bound.</p>
<p>This is also used by <a class="reference internal" href="api.html#module-fedmsg.meta" title="fedmsg.meta"><code class="xref py py-mod docutils literal"><span class="pre">fedmsg.meta</span></code></a> to denote trustworthiness
in the natural language representations produced by that module.</p>
</div>
<div class="section" id="crypto-backend">
<span id="conf-crypto-backend"></span><h3>crypto_backend<a class="headerlink" href="#crypto-backend" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">str</span></code> - The name of the <a class="reference internal" href="api.html#module-fedmsg.crypto" title="fedmsg.crypto"><code class="xref py py-mod docutils literal"><span class="pre">fedmsg.crypto</span></code></a> backend that should
be used to sign outgoing messages.  It may be either ‘x509’ or ‘gpg’.</p>
</div>
<div class="section" id="crypto-validate-backends">
<span id="conf-crypto-validate-backends"></span><h3>crypto_validate_backends<a class="headerlink" href="#crypto-validate-backends" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">list</span></code> - A list of names of <a class="reference internal" href="api.html#module-fedmsg.crypto" title="fedmsg.crypto"><code class="xref py py-mod docutils literal"><span class="pre">fedmsg.crypto</span></code></a> backends that
may be used to validate incoming messages.</p>
</div>
<div class="section" id="ssldir">
<span id="conf-ssldir"></span><h3>ssldir<a class="headerlink" href="#ssldir" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">str</span></code> - This should be directory on the filesystem
where the certificates used by <a class="reference internal" href="api.html#module-fedmsg.crypto" title="fedmsg.crypto"><code class="xref py py-mod docutils literal"><span class="pre">fedmsg.crypto</span></code></a> can be found.
Typically <code class="docutils literal"><span class="pre">/etc/pki/fedmsg/</span></code>.</p>
</div>
<div class="section" id="crl-location">
<span id="conf-crl-location"></span><h3>crl_location<a class="headerlink" href="#crl-location" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">str</span></code> - This should be a URL where the certificate revocation list can
be found.  This is checked by <a class="reference internal" href="api.html#fedmsg.crypto.validate" title="fedmsg.crypto.validate"><code class="xref py py-func docutils literal"><span class="pre">fedmsg.crypto.validate()</span></code></a> and
cached on disk.</p>
</div>
<div class="section" id="crl-cache">
<span id="conf-crl-cache"></span><h3>crl_cache<a class="headerlink" href="#crl-cache" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">str</span></code> - This should be the path to a filename on the filesystem where
the CRL downloaded from <a class="reference internal" href="#crl-location">crl_location</a> can be saved.  The python
process should have write access there.</p>
</div>
<div class="section" id="crl-cache-expiry">
<span id="conf-crl-cache-expiry"></span><h3>crl_cache_expiry<a class="headerlink" href="#crl-cache-expiry" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">int</span></code> - Number of seconds to keep the CRL cached before checking
<a class="reference internal" href="#crl-location">crl_location</a> for a new one.</p>
</div>
<div class="section" id="ca-cert-location">
<span id="conf-ca-cert-location"></span><h3>ca_cert_location<a class="headerlink" href="#ca-cert-location" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">str</span></code> - This should be a URL where the certificate authority cert can
be found.  This is checked by <a class="reference internal" href="api.html#fedmsg.crypto.validate" title="fedmsg.crypto.validate"><code class="xref py py-func docutils literal"><span class="pre">fedmsg.crypto.validate()</span></code></a> and
cached on disk.</p>
</div>
<div class="section" id="ca-cert-cache">
<span id="conf-ca-cert-cache"></span><h3>ca_cert_cache<a class="headerlink" href="#ca-cert-cache" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">str</span></code> - This should be the path to a filename on the filesystem where
the CA cert downloaded from <a class="reference internal" href="#ca-cert-location">ca_cert_location</a> can be saved.  The
python process should have write access there.</p>
</div>
<div class="section" id="ca-cert-cache-expiry">
<span id="conf-ca-cert-cache-expiry"></span><h3>ca_cert_cache_expiry<a class="headerlink" href="#ca-cert-cache-expiry" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">int</span></code> - Number of seconds to keep the CA cert cached before checking
<a class="reference internal" href="#ca-cert-location">ca_cert_location</a> for a new one.</p>
</div>
<div class="section" id="certnames">
<span id="conf-certnames"></span><h3>certnames<a class="headerlink" href="#certnames" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">dict</span></code> - This should be a mapping of certnames to cert prefixes.</p>
<p>The keys should be of the form <code class="docutils literal"><span class="pre">&lt;service&gt;.&lt;host&gt;</span></code>.  For example:
<code class="docutils literal"><span class="pre">bodhi.app01</span></code>.</p>
<p>The values should be the prefixes of cert/key pairs to be found in
<a class="reference internal" href="#ssldir">ssldir</a>.  For example, if
<code class="docutils literal"><span class="pre">bodhi-app01.stg.phx2.fedoraproject.org.crt</span></code> and
<code class="docutils literal"><span class="pre">bodhi-app01.stg.phx2.fedoraproject.org.key</span></code> are to be found in
<a class="reference internal" href="#ssldir">ssldir</a>, then the value
<code class="docutils literal"><span class="pre">bodhi-app01.stg.phx2.fedoraproject.org</span></code> should appear in the
<a class="reference internal" href="#certnames">certnames</a> dict.</p>
<p>Putting it all together, this value could be specified as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">certnames</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">&quot;bodhi.app01&quot;</span><span class="p">:</span> <span class="s2">&quot;bodhi-app01.stg.phx2.fedoraproject.org&quot;</span><span class="p">,</span>
    <span class="c1"># ... other certname mappings may follow here.</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>This is one of the most cumbersome parts of fedmsg.  The reason we
have to enumerate all these redundant mappings between
“service.hostname” and “service-fqdn” has to do with the limitations
of reverse dns lookup.  Case in point, try running the following on
app01.stg inside Fedora Infrastructure’s environment.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">socket</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">socket</span><span class="o">.</span><span class="n">getfqdn</span><span class="p">()</span>
</pre></div>
</div>
<p class="last">You might expect it to print “app01.stg.phx2.fedoraproject.org”, but
it doesn’t.  It prints “memcached04.phx2.fedoraproject.org”.  Since
we can’t rely on programatically extracting the fully qualified
domain names of the host machine during runtime, we need to
explicitly list all of the certs in the config.</p>
</div>
</div>
<div class="section" id="routing-nitpicky">
<span id="conf-routing-nitpicky"></span><h3>routing_nitpicky<a class="headerlink" href="#routing-nitpicky" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">bool</span></code> - When set to True, messages whose topics do not appear in
<a class="reference internal" href="#routing-policy">routing_policy</a> automatically fail the validation process
described in <a class="reference internal" href="api.html#module-fedmsg.crypto" title="fedmsg.crypto"><code class="xref py py-mod docutils literal"><span class="pre">fedmsg.crypto</span></code></a>.  It defaults to <code class="docutils literal"><span class="pre">False</span></code>.</p>
</div>
<div class="section" id="routing-policy">
<span id="conf-routing-policy"></span><h3>routing_policy<a class="headerlink" href="#routing-policy" title="Permalink to this headline">¶</a></h3>
<p>A Python dictionary mapping fully-qualified topic names to lists of cert
names.  If a message’s topic appears in the <a class="reference internal" href="#routing-policy">routing_policy</a> and
the name on its certificate does not appear in the associated list, then
that message fails the validation process in <a class="reference internal" href="api.html#module-fedmsg.crypto" title="fedmsg.crypto"><code class="xref py py-mod docutils literal"><span class="pre">fedmsg.crypto</span></code></a>.</p>
<p>For example, a routing policy might look like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">routing_policy</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">&quot;org.fedoraproject.prod.bodhi.buildroot_override.untag&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;bodhi-app01.phx2.fedoraproject.org&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bodhi-app02.phx2.fedoraproject.org&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bodhi-app03.phx2.fedoraproject.org&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bodhi-app04.phx2.fedoraproject.org&quot;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above loosely translates to “messages about bodhi buildroot
overrides being untagged may only come from the first four app
servers.”  If a message with that topic bears a cert signed by any
other name, then that message fails the validation process.</p>
<p>Expect that your <a class="reference internal" href="#conf-routing-policy"><span class="std std-ref">routing_policy</span></a> (if you define one) will
become quite long.</p>
<p>The default is an empty dictionary.</p>
</div>
</div>
<div class="section" id="zeromq">
<h2>ZeroMQ<a class="headerlink" href="#zeromq" title="Permalink to this headline">¶</a></h2>
<p>The following settings are ZeroMQ configuration options.</p>
<div class="section" id="high-water-mark">
<span id="conf-high-water-mark"></span><h3>high_water_mark<a class="headerlink" href="#high-water-mark" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">int</span></code> - An option to zeromq that specifies a hard limit on the maximum
number of outstanding messages to be queued in memory before reaching an
exceptional state.</p>
<p>For our pub/sub zeromq sockets, the exceptional state means <em>dropping
messages</em>.  See the upstream documentation for <a class="reference external" href="http://api.zeromq.org/2-1:zmq-setsockopt">ZMQ_HWM</a> and <a class="reference external" href="http://api.zeromq.org/2-1:zmq-socket">ZMQ_PUB</a>.</p>
<p>A value of <code class="docutils literal"><span class="pre">0</span></code> means “no limit” and is the
recommended value for fedmsg.  It is referenced when initializing
sockets in <a class="reference internal" href="api.html#fedmsg.init" title="fedmsg.init"><code class="xref py py-func docutils literal"><span class="pre">fedmsg.init()</span></code></a>.</p>
</div>
<div class="section" id="io-threads">
<span id="conf-io-threads"></span><h3>io_threads<a class="headerlink" href="#io-threads" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">int</span></code> - An option that specifies the size of a zeromq thread pool to
handle I/O operations.  See the upstream documentation for <a class="reference external" href="http://api.zeromq.org/2-1:zmq-init">zmq_init</a>.</p>
<p>This value is referenced when initializing the zeromq context in
<a class="reference internal" href="api.html#fedmsg.init" title="fedmsg.init"><code class="xref py py-func docutils literal"><span class="pre">fedmsg.init()</span></code></a>.</p>
</div>
<div class="section" id="post-init-sleep">
<span id="conf-post-init-sleep"></span><h3>post_init_sleep<a class="headerlink" href="#post-init-sleep" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">float</span></code> - A number of seconds to sleep after initializing and before
sending any messages.  Setting this to a value greater than zero is
required so that zeromq doesn’t drop messages that we ask it to send
before the pub socket is finished initializing.</p>
<p>Experimentation needs to be done to determine and sufficiently small and
safe value for this number.  <code class="docutils literal"><span class="pre">1</span></code> is definitely safe, but annoyingly
large.</p>
</div>
<div class="section" id="zmq-enabled">
<span id="conf-zmq-enabled"></span><h3>zmq_enabled<a class="headerlink" href="#zmq-enabled" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">bool</span></code> - A value that must be true.  It is present solely
for compatibility/interoperability with <a class="reference external" href="http://mokshaproject.net">moksha</a>.</p>
</div>
<div class="section" id="zmq-reconnect-ivl">
<span id="conf-zmq-reconnect-ivl"></span><h3>zmq_reconnect_ivl<a class="headerlink" href="#zmq-reconnect-ivl" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">int</span></code> - Number of miliseconds that zeromq will wait to reconnect
until it gets a connection if an endpoint is unavailable. This is in
miliseconds. See upstream <a class="reference external" href="http://api.zeromq.org/3-2:zmq-setsockopt">zmq options</a> for more information.</p>
</div>
<div class="section" id="zmq-reconnect-ivl-max">
<span id="conf-zmq-reconnect-ivl-max"></span><h3>zmq_reconnect_ivl_max<a class="headerlink" href="#zmq-reconnect-ivl-max" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">int</span></code> - Max delay that you can reconfigure to reduce reconnect storm
spam.  This is in miliseconds. See upstream <a class="reference external" href="http://api.zeromq.org/3-2:zmq-setsockopt">zmq options</a> for more information.</p>
</div>
<div class="section" id="zmq-strict">
<span id="conf-zmq-strict"></span><h3>zmq_strict<a class="headerlink" href="#zmq-strict" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">bool</span></code> - When false, allow splats (‘*’) in topic names when
subscribing.  When true, disallow splats and accept only strict matches
of topic names.</p>
<p>This is an argument to <a class="reference external" href="http://mokshaproject.net">moksha</a> and arose
there to help abstract away differences between the “topics” of zeromq
and the “routing_keys” of AMQP.</p>
</div>
<div class="section" id="zmq-tcp-keepalive">
<span id="conf-zmq-tcp-keepalive"></span><h3>zmq_tcp_keepalive<a class="headerlink" href="#zmq-tcp-keepalive" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">int</span></code> - Interpreted as a boolean.  If non-zero, then keepalive options
will be set.
See upstream <a class="reference external" href="http://api.zeromq.org/3-2:zmq-setsockopt">zmq options</a> and general <a class="reference external" href="http://tldp.org/HOWTO/TCP-Keepalive-HOWTO/overview.html">overview</a>.</p>
</div>
<div class="section" id="zmq-tcp-keepalive-cnt">
<span id="conf-zmq-tcp-keepalive-cnt"></span><h3>zmq_tcp_keepalive_cnt<a class="headerlink" href="#zmq-tcp-keepalive-cnt" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">int</span></code> - Number of keepalive packets to send before considering the
connection dead.
See upstream <a class="reference external" href="http://api.zeromq.org/3-2:zmq-setsockopt">zmq options</a> and general <a class="reference external" href="http://tldp.org/HOWTO/TCP-Keepalive-HOWTO/overview.html">overview</a>.</p>
</div>
<div class="section" id="zmq-tcp-keepalive-idle">
<span id="conf-zmq-tcp-keepalive-idle"></span><h3>zmq_tcp_keepalive_idle<a class="headerlink" href="#zmq-tcp-keepalive-idle" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">int</span></code> - Number of seconds to wait after last data packet before
sending the first keepalive packet.
See upstream <a class="reference external" href="http://api.zeromq.org/3-2:zmq-setsockopt">zmq options</a> and general <a class="reference external" href="http://tldp.org/HOWTO/TCP-Keepalive-HOWTO/overview.html">overview</a>.</p>
</div>
<div class="section" id="zmq-tcp-keepalive-intvl">
<span id="conf-zmq-tcp-keepalive-intvl"></span><h3>zmq_tcp_keepalive_intvl<a class="headerlink" href="#zmq-tcp-keepalive-intvl" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">int</span></code> - Number of seconds to wait inbetween sending subsequent
keepalive packets.
See upstream <a class="reference external" href="http://api.zeromq.org/3-2:zmq-setsockopt">zmq options</a> and general <a class="reference external" href="http://tldp.org/HOWTO/TCP-Keepalive-HOWTO/overview.html">overview</a>.</p>
</div>
</div>
<div class="section" id="irc">
<h2>IRC<a class="headerlink" href="#irc" title="Permalink to this headline">¶</a></h2>
<div class="section" id="conf-irc">
<span id="id10"></span><h3>irc<a class="headerlink" href="#conf-irc" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">list</span></code> - A list of ircbot configuration dicts.  This is the primary
way of configuring the <code class="docutils literal"><span class="pre">fedmsg-irc</span></code> bot implemented in
<a class="reference internal" href="commands.html#fedmsg.commands.ircbot.ircbot" title="fedmsg.commands.ircbot.ircbot"><code class="xref py py-func docutils literal"><span class="pre">fedmsg.commands.ircbot.ircbot()</span></code></a>.</p>
<p>Each dict contains a number of possible options.  Take the following
example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">irc</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>        <span class="nb">dict</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">network</span><span class="o">=</span><span class="s1">&#39;irc.freenode.net&#39;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">port</span><span class="o">=</span><span class="mi">6667</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">nickname</span><span class="o">=</span><span class="s1">&#39;fedmsg-dev&#39;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">channel</span><span class="o">=</span><span class="s1">&#39;fedora-fedmsg&#39;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">timeout</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span>
<span class="gp">...</span>
<span class="gp">... </span>            <span class="n">make_pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">make_terse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">make_short</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">...</span>
<span class="gp">... </span>            <span class="n">filters</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<span class="gp">... </span>                <span class="n">topic</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;koji&#39;</span><span class="p">],</span>
<span class="gp">... </span>                <span class="n">body</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ralph&#39;</span><span class="p">],</span>
<span class="gp">... </span>            <span class="p">),</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>    <span class="p">],</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>Here, one bot is configured.  It is to connect to the freenode network
on port 6667.  The bot’s name will be <code class="docutils literal"><span class="pre">fedmsg-dev</span></code> and it will
join the <code class="docutils literal"><span class="pre">#fedora-fedmsg</span></code> channel.</p>
<p><code class="docutils literal"><span class="pre">make_pretty</span></code> specifies that colors should be used, if possible.</p>
<p><code class="docutils literal"><span class="pre">make_terse</span></code> specifies that the “natural language” representations
produced by <a class="reference internal" href="api.html#module-fedmsg.meta" title="fedmsg.meta"><code class="xref py py-mod docutils literal"><span class="pre">fedmsg.meta</span></code></a> should be echoed into the channel instead
of raw or dumb representations.</p>
<p><code class="docutils literal"><span class="pre">make_short</span></code> specifies that any url associated with the message
should be shortened with a link shortening service.  If <cite>True</cite>, the
<a class="reference external" href="https://da.gd/">https://da.gd/</a> service will be used.  You can alternatively specify a
<cite>callable</cite> to use your own custom url shortener, like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">make_short</span><span class="o">=</span><span class="k">lambda</span> <span class="n">url</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://api.bitly.com/v3/shorten?login=YOURLOGIN&amp;apiKey=YOURAPIKEY&amp;longUrl=</span><span class="si">%s</span><span class="s1">&amp;format=txt&#39;</span> <span class="o">%</span> <span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">filters</span></code> dict is not very smart.  In the above case, any message
that has ‘koji’ anywhere in the topic or ‘ralph’ anywhere in the JSON
body will be discarded and not echoed into <code class="docutils literal"><span class="pre">#fedora-fedmsg</span></code>.  This is
an area that could use some improvement.</p>
</div>
<div class="section" id="irc-color-lookup">
<span id="conf-irc-color-lookup"></span><h3>irc_color_lookup<a class="headerlink" href="#irc-color-lookup" title="Permalink to this headline">¶</a></h3>
<p>A dictionary mapping module names to <a class="reference external" href="https://www.mirc.com/colors.html">MIRC irc color names</a>.  For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">irc_color_lookup</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s2">&quot;fas&quot;</span><span class="p">:</span> <span class="s2">&quot;light blue&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;bodhi&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;git&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;tagger&quot;</span><span class="p">:</span> <span class="s2">&quot;brown&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;wiki&quot;</span><span class="p">:</span> <span class="s2">&quot;purple&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;logger&quot;</span><span class="p">:</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;pkgdb&quot;</span><span class="p">:</span> <span class="s2">&quot;teal&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;buildsys&quot;</span><span class="p">:</span> <span class="s2">&quot;yellow&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;planet&quot;</span><span class="p">:</span> <span class="s2">&quot;light green&quot;</span><span class="p">,</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="irc-method">
<span id="conf-irc-method"></span><h3>irc_method<a class="headerlink" href="#irc-method" title="Permalink to this headline">¶</a></h3>
<p>the name of the method used to publish the messages on IRC.
Valid values are <code class="docutils literal"><span class="pre">msg</span></code> and <code class="docutils literal"><span class="pre">notice</span></code>.</p>
<p>The default is <code class="docutils literal"><span class="pre">notice</span></code>.</p>
</div>
</div>
<div class="section" id="stomp-configuration">
<span id="conf-stomp"></span><h2>STOMP Configuration<a class="headerlink" href="#stomp-configuration" title="Permalink to this headline">¶</a></h2>
<p>When using STOMP, you need to set <a class="reference internal" href="#conf-zmq-enabled"><span class="std std-ref">zmq_enabled</span></a> to <code class="docutils literal"><span class="pre">False</span></code>.
Additionally, if you’re using STOMP with TLS (recommended), you do not need
fedmsg’s cryptographic signatures to validate messages so you can turn those
off by setting <a class="reference internal" href="#conf-validate-signatures"><span class="std std-ref">validate_signatures</span></a> to <code class="docutils literal"><span class="pre">False</span></code></p>
<div class="section" id="stomp-uri">
<span id="conf-stomp-uri"></span><h3>stomp_uri<a class="headerlink" href="#stomp-uri" title="Permalink to this headline">¶</a></h3>
<p>A string of comma-separated brokers. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">stomp_uri</span><span class="o">=</span><span class="s1">&#39;broker01.example.com:61612,broker02.example.com:61612&#39;</span>
</pre></div>
</div>
<p>There is no default for this setting.</p>
</div>
<div class="section" id="stomp-heartbeat">
<span id="conf-stomp-heartbeat"></span><h3>stomp_heartbeat<a class="headerlink" href="#stomp-heartbeat" title="Permalink to this headline">¶</a></h3>
<p>The STOMP heartbeat interval, in milliseconds.</p>
<p>There is no default for this setting.</p>
</div>
<div class="section" id="stomp-user">
<span id="conf-stomp-user"></span><h3>stomp_user<a class="headerlink" href="#stomp-user" title="Permalink to this headline">¶</a></h3>
<p>The username to use with STOMP when authenticating with the broker.</p>
<p>There is no default for this setting.</p>
</div>
<div class="section" id="stomp-pass">
<span id="conf-stomp-pass"></span><h3>stomp_pass<a class="headerlink" href="#stomp-pass" title="Permalink to this headline">¶</a></h3>
<p>The password to use with STOMP when authenticating with the broker.</p>
<p>There is no default for this setting.</p>
</div>
<div class="section" id="stomp-ssl-crt">
<span id="conf-stomp-ssl-crt"></span><h3>stomp_ssl_crt<a class="headerlink" href="#stomp-ssl-crt" title="Permalink to this headline">¶</a></h3>
<p>The PEM-encoded x509 client certificate to use when authenticating with the broker.</p>
<p>There is no default for this setting.</p>
</div>
<div class="section" id="stomp-ssl-key">
<span id="conf-stomp-ssl-key"></span><h3>stomp_ssl_key<a class="headerlink" href="#stomp-ssl-key" title="Permalink to this headline">¶</a></h3>
<p>The PEM-encoded private key for the <a class="reference internal" href="#conf-stomp-ssl-crt"><span class="std std-ref">stomp_ssl_crt</span></a>.</p>
<p>There is no default for this setting.</p>
</div>
<div class="section" id="stomp-queue">
<span id="conf-stomp-queue"></span><h3>stomp_queue<a class="headerlink" href="#stomp-queue" title="Permalink to this headline">¶</a></h3>
<p>If set, this will cause the Moksha hub to only listen to the specified queue for all fedmsg
consumers. If it is not specified, the Moksha hub will listen to all topics declared by all
fedmsg consumers.</p>
<p>There is no default for this setting.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/fedmsg.png" alt="Logo"/>
    
    <h1 class="logo logo-name">fedmsg</h1>
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=fedora-infra&repo=fedmsg&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general-configuration">General configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#authentication-and-authorization">Authentication and Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#zeromq">ZeroMQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="#irc">IRC</a></li>
<li class="toctree-l2"><a class="reference internal" href="#stomp-configuration">STOMP Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="commands.html">Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="publishing.html">Publishing</a></li>
<li class="toctree-l1"><a class="reference internal" href="subscribing.html">Subscribing</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html">Deploying fedmsg</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">Developer Interface</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="installation.html" title="previous chapter">Installation</a></li>
      <li>Next: <a href="commands.html" title="next chapter">Commands</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2012 - 2017, Red Hat. Inc, and others.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/configuration.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>