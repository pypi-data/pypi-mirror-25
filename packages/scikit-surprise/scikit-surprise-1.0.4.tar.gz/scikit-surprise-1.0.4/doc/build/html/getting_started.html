

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Getting Started &mdash; Surprise 1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Surprise 1 documentation" href="index.html"/>
        <link rel="next" title="Using prediction algorithms" href="prediction_algorithms.html"/>
        <link rel="prev" title="Welcome to Surprise’ documentation!" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Surprise
          

          
          </a>

          
            
            
              <div class="version">
                0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#basic-usage">Basic usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#load-a-custom-dataset">Load a custom dataset</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#load-an-entire-dataset-from-a-file-or-a-dataframe">Load an entire dataset from a file or a dataframe</a></li>
<li class="toctree-l3"><a class="reference internal" href="#load-a-dataset-with-predefined-folds">Load a dataset with predefined folds</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-usage">Advanced usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tune-algorithm-parameters-with-gridsearch">Tune algorithm parameters with GridSearch</a></li>
<li class="toctree-l3"><a class="reference internal" href="#manually-iterate-over-folds">Manually iterate over folds</a></li>
<li class="toctree-l3"><a class="reference internal" href="#train-on-a-whole-trainset-and-specifically-query-for-predictions">Train on a whole trainset and specifically query for predictions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-line-usage">Command line usage</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="prediction_algorithms.html">Using prediction algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="building_custom_algo.html">How to build your own prediction algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="notation_standards.html">Notation standards, References</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">FAQ</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="prediction_algorithms_package.html">prediction_algorithms package</a></li>
<li class="toctree-l1"><a class="reference internal" href="similarities.html">similarities module</a></li>
<li class="toctree-l1"><a class="reference internal" href="accuracy.html">accuracy module</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataset.html">dataset module</a></li>
<li class="toctree-l1"><a class="reference internal" href="evaluate.html">evaluate module</a></li>
<li class="toctree-l1"><a class="reference internal" href="dump.html">dump module</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Surprise</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Getting Started</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/getting_started.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="getting-started">
<span id="id1"></span><h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<div class="section" id="basic-usage">
<span id="load-builtin-example"></span><h2>Basic usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://nicolashug.github.io/Surprise/">Surprise</a> has a set of built-in
<a class="reference internal" href="prediction_algorithms.html#prediction-algorithms"><span class="std std-ref">algorithms</span></a> and <a class="reference internal" href="dataset.html#dataset"><span class="std std-ref">datasets</span></a> for you
to play with. In its simplest form, it takes about four lines of code to
evaluate the performance of an algorithm:</p>
<div class="literal-block-wrapper docutils container" id="basic-usage-py">
<div class="code-block-caption"><span class="caption-text">From file <code class="docutils literal"><span class="pre">examples/basic_usage.py</span></code></span><a class="headerlink" href="#basic-usage-py" title="Permalink to this code">¶</a></div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">surprise</span> <span class="k">import</span> <span class="n">SVD</span>
<span class="kn">from</span> <span class="nn">surprise</span> <span class="k">import</span> <span class="n">Dataset</span>
<span class="kn">from</span> <span class="nn">surprise</span> <span class="k">import</span> <span class="n">evaluate</span><span class="p">,</span> <span class="n">print_perf</span>


<span class="c1"># Load the movielens-100k dataset (download it if needed),</span>
<span class="c1"># and split it into 3 folds for cross-validation.</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">load_builtin</span><span class="p">(</span><span class="s1">&#39;ml-100k&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">n_folds</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># We&#39;ll use the famous SVD algorithm.</span>
<span class="n">algo</span> <span class="o">=</span> <span class="n">SVD</span><span class="p">()</span>

<span class="c1"># Evaluate performances of our algorithm on the dataset.</span>
<span class="n">perf</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">measures</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAE&#39;</span><span class="p">])</span>

<span class="n">print_perf</span><span class="p">(</span><span class="n">perf</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>If <a class="reference external" href="https://nicolashug.github.io/Surprise/">Surprise</a> cannot find the
<a class="reference external" href="http://grouplens.org/datasets/movielens/">movielens-100k dataset</a>, it will
offer to download it and will store it under the <code class="docutils literal"><span class="pre">.surprise_data</span></code> folder in
your home directory.  The <a class="reference internal" href="dataset.html#surprise.dataset.DatasetAutoFolds.split" title="surprise.dataset.DatasetAutoFolds.split"><code class="xref py py-meth docutils literal"><span class="pre">split()</span></code></a> method automatically splits the
dataset into 3 folds and the <a class="reference internal" href="evaluate.html#surprise.evaluate.evaluate" title="surprise.evaluate.evaluate"><code class="xref py py-func docutils literal"><span class="pre">evaluate()</span></code></a>
function runs the cross-validation procedure and compute some <a class="reference internal" href="accuracy.html#module-surprise.accuracy" title="surprise.accuracy"><code class="xref py py-mod docutils literal"><span class="pre">accuracy</span></code></a> measures.</p>
</div>
<div class="section" id="load-a-custom-dataset">
<span id="load-custom"></span><h2>Load a custom dataset<a class="headerlink" href="#load-a-custom-dataset" title="Permalink to this headline">¶</a></h2>
<p>You can of course use a custom dataset. <a class="reference external" href="https://nicolashug.github.io/Surprise/">Surprise</a> offers two ways of loading a custom
dataset:</p>
<ul class="simple">
<li>you can either specify a single file (e.g. a csv file) or a pandas dataframe
with all the ratings and use the <a class="reference internal" href="dataset.html#surprise.dataset.DatasetAutoFolds.split" title="surprise.dataset.DatasetAutoFolds.split"><code class="xref py py-meth docutils literal"><span class="pre">split</span>
<span class="pre">()</span></code></a> method to perform
cross-validation, or <a class="reference internal" href="#train-on-whole-trainset"><span class="std std-ref">train on the whole dataset</span></a> ;</li>
<li>or if your dataset is already split into predefined folds, you can specify a
list of files for training and testing.</li>
</ul>
<p>Either way, you will need to define a <a class="reference internal" href="dataset.html#surprise.dataset.Reader" title="surprise.dataset.Reader"><code class="xref py py-class docutils literal"><span class="pre">Reader</span></code></a>
object for <a class="reference external" href="https://nicolashug.github.io/Surprise/">Surprise</a> to be able to
parse the file(s) or the dataframe. We’ll see now how to handle both cases.</p>
<div class="section" id="load-an-entire-dataset-from-a-file-or-a-dataframe">
<span id="load-from-file-example"></span><h3>Load an entire dataset from a file or a dataframe<a class="headerlink" href="#load-an-entire-dataset-from-a-file-or-a-dataframe" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">To load a dataset from a file (e.g. a csv file), you will need the
<a class="reference internal" href="dataset.html#surprise.dataset.Dataset.load_from_file" title="surprise.dataset.Dataset.load_from_file"><code class="xref py py-meth docutils literal"><span class="pre">load_from_file()</span></code></a> method:</p>
<div class="literal-block-wrapper docutils container" id="load-custom-dataset-py">
<div class="code-block-caption"><span class="caption-text">From file <code class="docutils literal"><span class="pre">examples/load_custom_dataset.py</span></code></span><a class="headerlink" href="#load-custom-dataset-py" title="Permalink to this code">¶</a></div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># path to dataset file</span>
<span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~/.surprise_data/ml-100k/ml-100k/u.data&#39;</span><span class="p">)</span>

<span class="c1"># As we&#39;re loading a custom dataset, we need to define a reader. In the</span>
<span class="c1"># movielens-100k dataset, each line has the following format:</span>
<span class="c1"># &#39;user item rating timestamp&#39;, separated by &#39;\t&#39; characters.</span>
<span class="n">reader</span> <span class="o">=</span> <span class="n">Reader</span><span class="p">(</span><span class="n">line_format</span><span class="o">=</span><span class="s1">&#39;user item rating timestamp&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">load_from_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">reader</span><span class="o">=</span><span class="n">reader</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">n_folds</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># data can now be used normally</span>
</pre></div>
</div>
</div>
<p>For more details about readers and how to use them, see the <a class="reference internal" href="dataset.html#surprise.dataset.Reader" title="surprise.dataset.Reader"><code class="xref py py-class docutils literal"><span class="pre">Reader</span>
<span class="pre">class</span></code></a> documentation.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As you already know from the previous section, the Movielens-100k dataset
is built-in so a much quicker way to load the dataset is to do <code class="docutils literal"><span class="pre">data</span> <span class="pre">=</span>
<span class="pre">Dataset.load_builtin('ml-100k')</span></code>. We will of course ignore this here.</p>
</div>
</li>
</ul>
<ul id="load-from-df-example">
<li><p class="first">To load a dataset from a pandas dataframe, you will need the
<a class="reference internal" href="dataset.html#surprise.dataset.Dataset.load_from_df" title="surprise.dataset.Dataset.load_from_df"><code class="xref py py-meth docutils literal"><span class="pre">load_from_df()</span></code></a> method. You
will also need a <a class="reference internal" href="dataset.html#surprise.dataset.Reader" title="surprise.dataset.Reader"><code class="xref py py-class docutils literal"><span class="pre">Reader</span></code></a> object, but only
the <code class="docutils literal"><span class="pre">rating_scale</span></code> parameter must be specified. The dataframe must have
three columns, corresponding to the user (raw) ids, the item (raw) ids, and
the ratings in this order. Each row thus corresponds to a given rating. This
is not restrictive as you can reorder the columns of your dataframe easily.</p>
<div class="literal-block-wrapper docutils container" id="load-dom-dataframe-py">
<div class="code-block-caption"><span class="caption-text">From file <code class="docutils literal"><span class="pre">examples/load_from_dataframe.py</span></code></span><a class="headerlink" href="#load-dom-dataframe-py" title="Permalink to this code">¶</a></div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">algo</span> <span class="o">=</span> <span class="n">NormalPredictor</span><span class="p">()</span>

<span class="c1"># Creation of the dataframe. Column names are irrelevant.</span>
<span class="n">ratings_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;itemID&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                <span class="s1">&#39;userID&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="s1">&#39;user_foo&#39;</span><span class="p">],</span>
                <span class="s1">&#39;rating&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ratings_dict</span><span class="p">)</span>

<span class="c1"># A reader is still needed but only the rating_scale param is requiered.</span>
<span class="n">reader</span> <span class="o">=</span> <span class="n">Reader</span><span class="p">(</span><span class="n">rating_scale</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>The dataframe initially looks like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>      <span class="n">itemID</span>  <span class="n">rating</span>    <span class="n">userID</span>
<span class="mi">0</span>       <span class="mi">1</span>       <span class="mi">3</span>         <span class="mi">9</span>
<span class="mi">1</span>       <span class="mi">1</span>       <span class="mi">2</span>        <span class="mi">32</span>
<span class="mi">2</span>       <span class="mi">1</span>       <span class="mi">4</span>         <span class="mi">2</span>
<span class="mi">3</span>       <span class="mi">2</span>       <span class="mi">3</span>        <span class="mi">45</span>
<span class="mi">4</span>       <span class="mi">2</span>       <span class="mi">1</span>  <span class="n">user_foo</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="load-a-dataset-with-predefined-folds">
<span id="load-from-folds-example"></span><h3>Load a dataset with predefined folds<a class="headerlink" href="#load-a-dataset-with-predefined-folds" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="load-custom-dataset-predefined-folds-py">
<div class="code-block-caption"><span class="caption-text">From file <code class="docutils literal"><span class="pre">examples/load_custom_dataset_predefined_folds.py</span></code></span><a class="headerlink" href="#load-custom-dataset-predefined-folds-py" title="Permalink to this code">¶</a></div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># path to dataset folder</span>
<span class="n">files_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~/.surprise_data/ml-100k/ml-100k/&#39;</span><span class="p">)</span>

<span class="c1"># This time, we&#39;ll use the built-in reader.</span>
<span class="n">reader</span> <span class="o">=</span> <span class="n">Reader</span><span class="p">(</span><span class="s1">&#39;ml-100k&#39;</span><span class="p">)</span>

<span class="c1"># folds_files is a list of tuples containing file paths:</span>
<span class="c1"># [(u1.base, u1.test), (u2.base, u2.test), ... (u5.base, u5.test)]</span>
<span class="n">train_file</span> <span class="o">=</span> <span class="n">files_dir</span> <span class="o">+</span> <span class="s1">&#39;u</span><span class="si">%d</span><span class="s1">.base&#39;</span>
<span class="n">test_file</span> <span class="o">=</span> <span class="n">files_dir</span> <span class="o">+</span> <span class="s1">&#39;u</span><span class="si">%d</span><span class="s1">.test&#39;</span>
<span class="n">folds_files</span> <span class="o">=</span> <span class="p">[(</span><span class="n">train_file</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span> <span class="n">test_file</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">load_from_folds</span><span class="p">(</span><span class="n">folds_files</span><span class="p">,</span> <span class="n">reader</span><span class="o">=</span><span class="n">reader</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Of course, nothing prevents you from only loading a single file for training
and a single file for testing. However, the <code class="docutils literal"><span class="pre">folds_files</span></code> parameter still
needs to be a <code class="docutils literal"><span class="pre">list</span></code>.</p>
</div>
</div>
<div class="section" id="advanced-usage">
<h2>Advanced usage<a class="headerlink" href="#advanced-usage" title="Permalink to this headline">¶</a></h2>
<p>We will here get a little deeper on what can <a class="reference external" href="https://nicolashug.github.io/Surprise/">Surprise</a> do for you.</p>
<div class="section" id="tune-algorithm-parameters-with-gridsearch">
<span id="tuning-algorithm-parameters"></span><h3>Tune algorithm parameters with GridSearch<a class="headerlink" href="#tune-algorithm-parameters-with-gridsearch" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="evaluate.html#surprise.evaluate.evaluate" title="surprise.evaluate.evaluate"><code class="xref py py-func docutils literal"><span class="pre">evaluate()</span></code></a> function gives us the
results on one set of parameters given to the algorithm. If the user wants
to try the algorithm on a different set of parameters, the
<a class="reference internal" href="evaluate.html#surprise.evaluate.GridSearch" title="surprise.evaluate.GridSearch"><code class="xref py py-class docutils literal"><span class="pre">GridSearch</span></code></a> class comes to the rescue.
Given a <code class="docutils literal"><span class="pre">dict</span></code> of parameters, this
class exhaustively tries all the combination of parameters and helps get the
best combination for an accuracy measurement. It is analogous to
<a class="reference external" href="http://scikit-learn.org/stable/modules/generated/sklearn.model_selection.GridSearchCV.html">GridSearchCV</a> from scikit-learn.</p>
<p>For instance, suppose that we want to tune the parameters of the
<a class="reference internal" href="matrix_factorization.html#surprise.prediction_algorithms.matrix_factorization.SVD" title="surprise.prediction_algorithms.matrix_factorization.SVD"><code class="xref py py-class docutils literal"><span class="pre">SVD</span></code></a>. Some of
the parameters of this algorithm are <code class="docutils literal"><span class="pre">n_epochs</span></code>, <code class="docutils literal"><span class="pre">lr_all</span></code> and <code class="docutils literal"><span class="pre">reg_all</span></code>.
Thus we define a parameters grid as follows</p>
<div class="literal-block-wrapper docutils container" id="grid-search-usage-py">
<div class="code-block-caption"><span class="caption-text">From file <code class="docutils literal"><span class="pre">examples/grid_search_usage.py</span></code></span><a class="headerlink" href="#grid-search-usage-py" title="Permalink to this code">¶</a></div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n_epochs&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="s1">&#39;lr_all&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.002</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">],</span>
              <span class="s1">&#39;reg_all&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">]}</span>
</pre></div>
</div>
</div>
<p>Next we define a <a class="reference internal" href="evaluate.html#surprise.evaluate.GridSearch" title="surprise.evaluate.GridSearch"><code class="xref py py-class docutils literal"><span class="pre">GridSearch</span></code></a> instance
and give it the class
<a class="reference internal" href="matrix_factorization.html#surprise.prediction_algorithms.matrix_factorization.SVD" title="surprise.prediction_algorithms.matrix_factorization.SVD"><code class="xref py py-class docutils literal"><span class="pre">SVD</span></code></a> as an
algorithm, and <code class="docutils literal"><span class="pre">param_grid</span></code>. We will compute both the
RMSE and FCP values for all the combination. Thus the following definition:</p>
<div class="literal-block-wrapper docutils container" id="grid-search-usage2-py">
<div class="code-block-caption"><span class="caption-text">From file <code class="docutils literal"><span class="pre">examples/grid_search_usage.py</span></code></span><a class="headerlink" href="#grid-search-usage2-py" title="Permalink to this code">¶</a></div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearch</span><span class="p">(</span><span class="n">SVD</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">measures</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;FCP&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>Now that <a class="reference internal" href="evaluate.html#surprise.evaluate.GridSearch" title="surprise.evaluate.GridSearch"><code class="xref py py-class docutils literal"><span class="pre">GridSearch</span></code></a> instance is ready,
we can evaluate the algorithm on any data with the
<a class="reference internal" href="evaluate.html#surprise.evaluate.GridSearch.evaluate" title="surprise.evaluate.GridSearch.evaluate"><code class="xref py py-meth docutils literal"><span class="pre">GridSearch.evaluate()</span></code></a> method,
exactly like with the regular
<a class="reference internal" href="evaluate.html#surprise.evaluate.evaluate" title="surprise.evaluate.evaluate"><code class="xref py py-func docutils literal"><span class="pre">evaluate()</span></code></a> function:</p>
<div class="literal-block-wrapper docutils container" id="grid-search-usage3-py">
<div class="code-block-caption"><span class="caption-text">From file <code class="docutils literal"><span class="pre">examples/grid_search_usage.py</span></code></span><a class="headerlink" href="#grid-search-usage3-py" title="Permalink to this code">¶</a></div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">load_builtin</span><span class="p">(</span><span class="s1">&#39;ml-100k&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">n_folds</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">grid_search</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Everything is ready now to read the results. For example, we get the best RMSE
and FCP scores and parameters as follows:</p>
<div class="literal-block-wrapper docutils container" id="grid-search-usage4-py">
<div class="code-block-caption"><span class="caption-text">From file <code class="docutils literal"><span class="pre">examples/grid_search_usage.py</span></code></span><a class="headerlink" href="#grid-search-usage4-py" title="Permalink to this code">¶</a></div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># best RMSE score</span>
<span class="nb">print</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_score</span><span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">])</span>
<span class="c1"># &gt;&gt;&gt; 0.96117566386</span>

<span class="c1"># combination of parameters that gave the best RMSE score</span>
<span class="nb">print</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_params</span><span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">])</span>
<span class="c1"># &gt;&gt;&gt; {&#39;reg_all&#39;: 0.4, &#39;lr_all&#39;: 0.005, &#39;n_epochs&#39;: 10}</span>

<span class="c1"># best FCP score</span>
<span class="nb">print</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_score</span><span class="p">[</span><span class="s1">&#39;FCP&#39;</span><span class="p">])</span>
<span class="c1"># &gt;&gt;&gt; 0.702279736531</span>

<span class="c1"># combination of parameters that gave the best FCP score</span>
<span class="nb">print</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_params</span><span class="p">[</span><span class="s1">&#39;FCP&#39;</span><span class="p">])</span>
<span class="c1"># &gt;&gt;&gt; {&#39;reg_all&#39;: 0.6, &#39;lr_all&#39;: 0.005, &#39;n_epochs&#39;: 10}</span>
</pre></div>
</div>
</div>
<p>For further analysis, we can easily read all the results in a pandas
<code class="docutils literal"><span class="pre">DataFrame</span></code> as follows:</p>
<div class="literal-block-wrapper docutils container" id="grid-search-usage5-py">
<div class="code-block-caption"><span class="caption-text">From file <code class="docutils literal"><span class="pre">examples/grid_search_usage.py</span></code></span><a class="headerlink" href="#grid-search-usage5-py" title="Permalink to this code">¶</a></div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>  <span class="c1"># noqa</span>

<span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">cv_results</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition note" id="iterate-over-folds">
<p class="first admonition-title">Note</p>
<p>Dictionary parameters such as <code class="docutils literal"><span class="pre">bsl_options</span></code> and <code class="docutils literal"><span class="pre">sim_options</span></code> require
particular treatment. See usage example below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>
              <span class="s1">&#39;sim_options&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;msd&#39;</span><span class="p">,</span> <span class="s1">&#39;cosine&#39;</span><span class="p">],</span>
                              <span class="s1">&#39;min_support&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
                              <span class="s1">&#39;user_based&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">]}</span>
              <span class="p">}</span>
</pre></div>
</div>
<p>Naturally, both can be combined, for example for the
<a class="reference internal" href="knn_inspired.html#surprise.prediction_algorithms.knns.KNNBaseline" title="surprise.prediction_algorithms.knns.KNNBaseline"><code class="xref py py-class docutils literal"><span class="pre">KNNBaseline</span></code></a>
algorithm:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bsl_options&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;als&#39;</span><span class="p">,</span> <span class="s1">&#39;sgd&#39;</span><span class="p">],</span>
                              <span class="s1">&#39;reg&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]},</span>
              <span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
              <span class="s1">&#39;sim_options&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;msd&#39;</span><span class="p">,</span> <span class="s1">&#39;cosine&#39;</span><span class="p">],</span>
                              <span class="s1">&#39;min_support&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
                              <span class="s1">&#39;user_based&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">]}</span>
              <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="manually-iterate-over-folds">
<h3>Manually iterate over folds<a class="headerlink" href="#manually-iterate-over-folds" title="Permalink to this headline">¶</a></h3>
<p>We have so far used the <a class="reference internal" href="evaluate.html#surprise.evaluate.evaluate" title="surprise.evaluate.evaluate"><code class="xref py py-func docutils literal"><span class="pre">evaluate()</span></code></a>
function that does all the hard work for us. If you want to have better control
on your experiments, you can use the <a class="reference internal" href="dataset.html#surprise.dataset.Dataset.folds" title="surprise.dataset.Dataset.folds"><code class="xref py py-meth docutils literal"><span class="pre">folds()</span></code></a> generator of your dataset, and then the
<a class="reference internal" href="algobase.html#surprise.prediction_algorithms.algo_base.AlgoBase.train" title="surprise.prediction_algorithms.algo_base.AlgoBase.train"><code class="xref py py-meth docutils literal"><span class="pre">train()</span></code></a> and
<a class="reference internal" href="algobase.html#surprise.prediction_algorithms.algo_base.AlgoBase.test" title="surprise.prediction_algorithms.algo_base.AlgoBase.test"><code class="xref py py-meth docutils literal"><span class="pre">test()</span></code></a> methods
of your algorithm on each of the folds:</p>
<div class="literal-block-wrapper docutils container" id="iterate-over-folds-py">
<div class="code-block-caption"><span class="caption-text">From file <code class="docutils literal"><span class="pre">examples/iterate_over_folds.py</span></code></span><a class="headerlink" href="#iterate-over-folds-py" title="Permalink to this code">¶</a></div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">load_builtin</span><span class="p">(</span><span class="s1">&#39;ml-100k&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">n_folds</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">algo</span> <span class="o">=</span> <span class="n">BaselineOnly</span><span class="p">()</span>

<span class="k">for</span> <span class="n">trainset</span><span class="p">,</span> <span class="n">testset</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">folds</span><span class="p">():</span>

    <span class="c1"># train and test algorithm.</span>
    <span class="n">algo</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">trainset</span><span class="p">)</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">testset</span><span class="p">)</span>

    <span class="c1"># Compute and print Root Mean Squared Error</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">accuracy</span><span class="o">.</span><span class="n">rmse</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="train-on-a-whole-trainset-and-specifically-query-for-predictions">
<span id="train-on-whole-trainset"></span><h3>Train on a whole trainset and specifically query for predictions<a class="headerlink" href="#train-on-a-whole-trainset-and-specifically-query-for-predictions" title="Permalink to this headline">¶</a></h3>
<p>We will here review how to get a prediction for specified users and items. In
the mean time, we will also review how to train on a whole dataset, without
performing cross-validation (i.e. there is no test set).</p>
<p>The latter is pretty straightforward: all you need is to load a dataset, and
the <a class="reference internal" href="dataset.html#surprise.dataset.DatasetAutoFolds.build_full_trainset" title="surprise.dataset.DatasetAutoFolds.build_full_trainset"><code class="xref py py-meth docutils literal"><span class="pre">build_full_trainset()</span></code></a> method to build the
<a class="reference internal" href="dataset.html#surprise.dataset.Trainset" title="surprise.dataset.Trainset"><code class="xref py py-class docutils literal"><span class="pre">trainset</span></code></a> and train you algorithm:</p>
<div class="literal-block-wrapper docutils container" id="query-for-predictions-py">
<div class="code-block-caption"><span class="caption-text">From file <code class="docutils literal"><span class="pre">examples/query_for_predictions.py</span></code></span><a class="headerlink" href="#query-for-predictions-py" title="Permalink to this code">¶</a></div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">load_builtin</span><span class="p">(</span><span class="s1">&#39;ml-100k&#39;</span><span class="p">)</span>

<span class="c1"># Retrieve the trainset.</span>
<span class="n">trainset</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">build_full_trainset</span><span class="p">()</span>

<span class="c1"># Build an algorithm, and train it.</span>
<span class="n">algo</span> <span class="o">=</span> <span class="n">KNNBasic</span><span class="p">()</span>
<span class="n">algo</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">trainset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now, there’s no way we could call the <a class="reference internal" href="algobase.html#surprise.prediction_algorithms.algo_base.AlgoBase.test" title="surprise.prediction_algorithms.algo_base.AlgoBase.test"><code class="xref py py-meth docutils literal"><span class="pre">test()</span></code></a> method, because we
have no testset. But you can still get predictions for the users and items you
want.</p>
<p>Let’s say you’re interested in user 196 and item 302 (make sure they’re in the
trainset!), and you know that the true rating <span class="math">\(r_{ui} = 4\)</span>. All you need
is call the <a class="reference internal" href="algobase.html#surprise.prediction_algorithms.algo_base.AlgoBase.predict" title="surprise.prediction_algorithms.algo_base.AlgoBase.predict"><code class="xref py py-meth docutils literal"><span class="pre">predict()</span></code></a> method:</p>
<div class="literal-block-wrapper docutils container" id="query-for-predictions2-py">
<div class="code-block-caption"><span class="caption-text">From file <code class="docutils literal"><span class="pre">examples/query_for_predictions.py</span></code></span><a class="headerlink" href="#query-for-predictions2-py" title="Permalink to this code">¶</a></div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">uid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="mi">196</span><span class="p">)</span>  <span class="c1"># raw user id (as in the ratings file). They are **strings**!</span>
<span class="n">iid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="mi">302</span><span class="p">)</span>  <span class="c1"># raw item id (as in the ratings file). They are **strings**!</span>

<span class="c1"># get a prediction for specific users and items.</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">iid</span><span class="p">,</span> <span class="n">r_ui</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The <a class="reference internal" href="algobase.html#surprise.prediction_algorithms.algo_base.AlgoBase.predict" title="surprise.prediction_algorithms.algo_base.AlgoBase.predict"><code class="xref py py-meth docutils literal"><span class="pre">predict()</span></code></a> uses <strong>raw</strong> ids
(read <a class="reference internal" href="FAQ.html#raw-inner-note"><span class="std std-ref">this</span></a>). As the dataset we have used has been read
from a file, the raw ids are strings (even if they represent numbers).</p>
<p>If the <a class="reference internal" href="algobase.html#surprise.prediction_algorithms.algo_base.AlgoBase.predict" title="surprise.prediction_algorithms.algo_base.AlgoBase.predict"><code class="xref py py-meth docutils literal"><span class="pre">predict()</span></code></a> method is called
with user or item ids that were not part of the trainset, it’s up to the
algorithm to decide if it still can make a prediction or not. If it can’t,
<a class="reference internal" href="algobase.html#surprise.prediction_algorithms.algo_base.AlgoBase.predict" title="surprise.prediction_algorithms.algo_base.AlgoBase.predict"><code class="xref py py-meth docutils literal"><span class="pre">predict()</span></code></a>
will still predict the mean of all ratings <span class="math">\(\mu\)</span>.</p>
<p>Obviously, it is perfectly fine to use the <a class="reference internal" href="algobase.html#surprise.prediction_algorithms.algo_base.AlgoBase.predict" title="surprise.prediction_algorithms.algo_base.AlgoBase.predict"><code class="xref py py-meth docutils literal"><span class="pre">predict()</span></code></a> method directly
during a cross-validation process. It’s then up to you to ensure that the user
and item ids are present in the trainset though.</p>
</div>
<div class="section" id="command-line-usage">
<h3>Command line usage<a class="headerlink" href="#command-line-usage" title="Permalink to this headline">¶</a></h3>
<p>Surprise can also be used from the command line, for example:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">surprise</span> <span class="o">-</span><span class="n">algo</span> <span class="n">SVD</span> <span class="o">-</span><span class="n">params</span> <span class="s2">&quot;{&#39;n_epochs&#39;: 5, &#39;verbose&#39;: True}&quot;</span> <span class="o">-</span><span class="n">load</span><span class="o">-</span><span class="n">builtin</span> <span class="n">ml</span><span class="o">-</span><span class="mi">100</span><span class="n">k</span> <span class="o">-</span><span class="n">n</span><span class="o">-</span><span class="n">folds</span> <span class="mi">3</span>
</pre></div>
</div>
<p>See detailed usage by running:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">surprise</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="prediction_algorithms.html" class="btn btn-neutral float-right" title="Using prediction algorithms" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Welcome to Surprise’ documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Nicolas Hug.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>