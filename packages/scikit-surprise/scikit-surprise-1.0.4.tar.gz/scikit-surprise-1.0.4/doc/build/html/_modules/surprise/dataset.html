

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>surprise.dataset &mdash; Surprise 1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Surprise 1 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Surprise
          

          
          </a>

          
            
            
              <div class="version">
                0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../prediction_algorithms.html">Using prediction algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../building_custom_algo.html">How to build your own prediction algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notation_standards.html">Notation standards, References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../FAQ.html">FAQ</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../prediction_algorithms_package.html">prediction_algorithms package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../similarities.html">similarities module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../accuracy.html">accuracy module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dataset.html">dataset module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../evaluate.html">evaluate module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dump.html">dump module</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Surprise</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>surprise.dataset</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for surprise.dataset</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">the :mod:`dataset` module defines some tools for managing datasets.</span>

<span class="sd">Users may use both *built-in* and user-defined datasets (see the</span>
<span class="sd">:ref:`getting_started` page for examples). Right now, three built-in datasets</span>
<span class="sd">are available:</span>

<span class="sd">* The `movielens-100k &lt;http://grouplens.org/datasets/movielens/&gt;`_ dataset.</span>
<span class="sd">* The `movielens-1m &lt;http://grouplens.org/datasets/movielens/&gt;`_ dataset.</span>
<span class="sd">* The `Jester &lt;http://eigentaste.berkeley.edu/dataset/&gt;`_ dataset 2.</span>

<span class="sd">Built-in datasets can all be loaded (or downloaded if you haven&#39;t already)</span>
<span class="sd">using the :meth:`Dataset.load_builtin` method. For each built-in dataset,</span>
<span class="sd">Surprise also provide predefined :class:`readers &lt;Reader&gt;` which are useful if</span>
<span class="sd">you want to use a custom dataset that has the same format as a built-in one.</span>

<span class="sd">Summary:</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :nosignatures:</span>

<span class="sd">    Dataset.load_builtin</span>
<span class="sd">    Dataset.load_from_file</span>
<span class="sd">    Dataset.load_from_folds</span>
<span class="sd">    Dataset.folds</span>
<span class="sd">    DatasetAutoFolds.split</span>
<span class="sd">    Reader</span>
<span class="sd">    Trainset</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span>
                        <span class="n">unicode_literals</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">namedtuple</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="k">import</span> <span class="nb">input</span>
<span class="kn">from</span> <span class="nn">six.moves.urllib.request</span> <span class="k">import</span> <span class="n">urlretrieve</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="k">import</span> <span class="nb">range</span>
<span class="kn">from</span> <span class="nn">six</span> <span class="k">import</span> <span class="n">iteritems</span>


<span class="c1"># directory where builtin datasets are stored. For now it&#39;s in the home</span>
<span class="c1"># directory under the .surprise_data. May be ask user to define it?</span>
<span class="n">DATASETS_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/.surprise_data/&#39;</span>

<span class="c1"># a builtin dataset has</span>
<span class="c1"># - an url (where to download it)</span>
<span class="c1"># - a path (where it is located on the filesystem)</span>
<span class="c1"># - the parameters of the corresponding reader</span>
<span class="n">BuiltinDataset</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;BuiltinDataset&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="p">,</span> <span class="s1">&#39;reader_params&#39;</span><span class="p">])</span>

<span class="n">BUILTIN_DATASETS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ml-100k&#39;</span><span class="p">:</span>
        <span class="n">BuiltinDataset</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://files.grouplens.org/datasets/movielens/ml-100k.zip&#39;</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="n">DATASETS_DIR</span> <span class="o">+</span> <span class="s1">&#39;ml-100k/ml-100k/u.data&#39;</span><span class="p">,</span>
            <span class="n">reader_params</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">line_format</span><span class="o">=</span><span class="s1">&#39;user item rating timestamp&#39;</span><span class="p">,</span>
                               <span class="n">rating_scale</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                               <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="p">),</span>
    <span class="s1">&#39;ml-1m&#39;</span><span class="p">:</span>
        <span class="n">BuiltinDataset</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://files.grouplens.org/datasets/movielens/ml-1m.zip&#39;</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="n">DATASETS_DIR</span> <span class="o">+</span> <span class="s1">&#39;ml-1m/ml-1m/ratings.dat&#39;</span><span class="p">,</span>
            <span class="n">reader_params</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">line_format</span><span class="o">=</span><span class="s1">&#39;user item rating timestamp&#39;</span><span class="p">,</span>
                               <span class="n">rating_scale</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                               <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;::&#39;</span><span class="p">)</span>
        <span class="p">),</span>
    <span class="s1">&#39;jester&#39;</span><span class="p">:</span>
        <span class="n">BuiltinDataset</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://eigentaste.berkeley.edu/dataset/jester_dataset_2.zip&#39;</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="n">DATASETS_DIR</span> <span class="o">+</span> <span class="s1">&#39;jester/jester_ratings.dat&#39;</span><span class="p">,</span>
            <span class="n">reader_params</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">line_format</span><span class="o">=</span><span class="s1">&#39;user item rating&#39;</span><span class="p">,</span>
                               <span class="n">rating_scale</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="p">)</span>
<span class="p">}</span>


<div class="viewcode-block" id="Dataset"><a class="viewcode-back" href="../../dataset.html#surprise.dataset.Dataset">[docs]</a><span class="k">class</span> <span class="nc">Dataset</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Base class for loading datasets.</span>

<span class="sd">    Note that you should never instantiate the :class:`Dataset` class directly</span>
<span class="sd">    (same goes for its derived classes), but instead use one of the three</span>
<span class="sd">    available methods for loading datasets.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="o">=</span> <span class="n">reader</span>

<div class="viewcode-block" id="Dataset.load_builtin"><a class="viewcode-back" href="../../dataset.html#surprise.dataset.Dataset.load_builtin">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load_builtin</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ml-100k&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load a built-in dataset.</span>

<span class="sd">        If the dataset has not already been loaded, it will be downloaded and</span>
<span class="sd">        saved. You will have to split your dataset using the :meth:`split</span>
<span class="sd">        &lt;DatasetAutoFolds.split&gt;` method. See an example in the :ref:`User</span>
<span class="sd">        Guide &lt;load_builtin_example&gt;`.</span>


<span class="sd">        Args:</span>
<span class="sd">            name(:obj:`string`): The name of the built-in dataset to load.</span>
<span class="sd">                Accepted values are &#39;ml-100k&#39;, &#39;ml-1m&#39;, and &#39;jester&#39;.</span>
<span class="sd">                Default is &#39;ml-100k&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A :obj:`Dataset` object.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the ``name`` parameter is incorrect.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="n">BUILTIN_DATASETS</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;unknown dataset &#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span>
                             <span class="s1">&#39;. Accepted values are &#39;</span> <span class="o">+</span>
                             <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BUILTIN_DATASETS</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>

        <span class="c1"># if dataset does not exist, offer to download it</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
            <span class="n">answered</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">answered</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dataset &#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; could not be found. Do you want &#39;</span>
                      <span class="s1">&#39;to download it? [Y/n] &#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">choice</span> <span class="o">=</span> <span class="nb">input</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">choice</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;omg this is so nice of you!!&#39;</span><span class="p">]:</span>
                    <span class="n">answered</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">choice</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;hell no why would i want that?!&#39;</span><span class="p">]:</span>
                    <span class="n">answered</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ok then, I&#39;m out!&quot;</span><span class="p">)</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">DATASETS_DIR</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">DATASETS_DIR</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Trying to download dataset from &#39;</span> <span class="o">+</span> <span class="n">dataset</span><span class="o">.</span><span class="n">url</span> <span class="o">+</span> <span class="s1">&#39;...&#39;</span><span class="p">)</span>
            <span class="n">urlretrieve</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">DATASETS_DIR</span> <span class="o">+</span> <span class="s1">&#39;tmp.zip&#39;</span><span class="p">)</span>

            <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">DATASETS_DIR</span> <span class="o">+</span> <span class="s1">&#39;tmp.zip&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp_zip</span><span class="p">:</span>
                <span class="n">tmp_zip</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">DATASETS_DIR</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>

            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">DATASETS_DIR</span> <span class="o">+</span> <span class="s1">&#39;tmp.zip&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done! Dataset&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;has been saved to&#39;</span><span class="p">,</span> <span class="n">DATASETS_DIR</span> <span class="o">+</span>
                  <span class="n">name</span><span class="p">)</span>

        <span class="n">reader</span> <span class="o">=</span> <span class="n">Reader</span><span class="p">(</span><span class="o">**</span><span class="n">dataset</span><span class="o">.</span><span class="n">reader_params</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">load_from_file</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">reader</span><span class="o">=</span><span class="n">reader</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dataset.load_from_file"><a class="viewcode-back" href="../../dataset.html#surprise.dataset.Dataset.load_from_file">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load_from_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load a dataset from a (custom) file.</span>

<span class="sd">        Use this if you want to use a custom dataset and all of the ratings are</span>
<span class="sd">        stored in one file. You will have to split your dataset using the</span>
<span class="sd">        :meth:`split &lt;DatasetAutoFolds.split&gt;` method. See an example in the</span>
<span class="sd">        :ref:`User Guide &lt;load_from_file_example&gt;`.</span>


<span class="sd">        Args:</span>
<span class="sd">            file_path(:obj:`string`): The path to the file containing ratings.</span>
<span class="sd">            reader(:obj:`Reader`): A reader to read the file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">DatasetAutoFolds</span><span class="p">(</span><span class="n">ratings_file</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">reader</span><span class="o">=</span><span class="n">reader</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dataset.load_from_folds"><a class="viewcode-back" href="../../dataset.html#surprise.dataset.Dataset.load_from_folds">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load_from_folds</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">folds_files</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load a dataset where folds (for cross-validation) are predefined by</span>
<span class="sd">        some files.</span>

<span class="sd">        The purpose of this method is to cover a common use case where a</span>
<span class="sd">        dataset is already split into predefined folds, such as the</span>
<span class="sd">        movielens-100k dataset which defines files u1.base, u1.test, u2.base,</span>
<span class="sd">        u2.test, etc... It can also be used when you don&#39;t want to perform</span>
<span class="sd">        cross-validation but still want to specify your training and testing</span>
<span class="sd">        data (which comes down to 1-fold cross-validation anyway). See an</span>
<span class="sd">        example in the :ref:`User Guide &lt;load_from_folds_example&gt;`.</span>


<span class="sd">        Args:</span>
<span class="sd">            folds_files(:obj:`iterable` of :obj:`tuples`): The list of the</span>
<span class="sd">                folds. A fold is a tuple of the form ``(path_to_train_file,</span>
<span class="sd">                path_to_test_file)``.</span>
<span class="sd">            reader(:obj:`Reader`): A reader to read the files.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">DatasetUserFolds</span><span class="p">(</span><span class="n">folds_files</span><span class="o">=</span><span class="n">folds_files</span><span class="p">,</span> <span class="n">reader</span><span class="o">=</span><span class="n">reader</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dataset.load_from_df"><a class="viewcode-back" href="../../dataset.html#surprise.dataset.Dataset.load_from_df">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load_from_df</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load a dataset from a pandas dataframe.</span>

<span class="sd">        Use this if you want to use a custom dataset that is stored in a pandas</span>
<span class="sd">        dataframe. See the :ref:`User Guide&lt;load_from_df_example&gt;` for an</span>
<span class="sd">        example.</span>

<span class="sd">        Args:</span>
<span class="sd">            df(`Dataframe`): The dataframe containing the ratings. It must have</span>
<span class="sd">                three columns, corresponding to the user (raw) ids, the item</span>
<span class="sd">                (raw) ids, and the ratings, in this order.</span>
<span class="sd">            reader(:obj:`Reader`): A reader to read the file. Only the</span>
<span class="sd">                ``rating_scale`` field needs to be specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">DatasetAutoFolds</span><span class="p">(</span><span class="n">reader</span><span class="o">=</span><span class="n">reader</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">read_ratings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of ratings (user, item, rating, timestamp) read from</span>
<span class="sd">        file_name&quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">raw_ratings</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">parse_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span>
                           <span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">skip_lines</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">raw_ratings</span>

<div class="viewcode-block" id="Dataset.folds"><a class="viewcode-back" href="../../dataset.html#surprise.dataset.Dataset.folds">[docs]</a>    <span class="k">def</span> <span class="nf">folds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generator function to iterate over the folds of the Dataset.</span>

<span class="sd">        See :ref:`User Guide &lt;iterate_over_folds&gt;` for usage.</span>

<span class="sd">        Yields:</span>
<span class="sd">            tuple: :class:`Trainset` and testset of current fold.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">raw_trainset</span><span class="p">,</span> <span class="n">raw_testset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_folds</span><span class="p">():</span>
            <span class="n">trainset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct_trainset</span><span class="p">(</span><span class="n">raw_trainset</span><span class="p">)</span>
            <span class="n">testset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct_testset</span><span class="p">(</span><span class="n">raw_testset</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">trainset</span><span class="p">,</span> <span class="n">testset</span></div>

    <span class="k">def</span> <span class="nf">construct_trainset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw_trainset</span><span class="p">):</span>

        <span class="n">raw2inner_id_users</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">raw2inner_id_items</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">current_u_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">current_i_index</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">ur</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">ir</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="c1"># user raw id, item raw id, translated rating, time stamp</span>
        <span class="k">for</span> <span class="n">urid</span><span class="p">,</span> <span class="n">irid</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">timestamp</span> <span class="ow">in</span> <span class="n">raw_trainset</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">uid</span> <span class="o">=</span> <span class="n">raw2inner_id_users</span><span class="p">[</span><span class="n">urid</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">uid</span> <span class="o">=</span> <span class="n">current_u_index</span>
                <span class="n">raw2inner_id_users</span><span class="p">[</span><span class="n">urid</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_u_index</span>
                <span class="n">current_u_index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">iid</span> <span class="o">=</span> <span class="n">raw2inner_id_items</span><span class="p">[</span><span class="n">irid</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">iid</span> <span class="o">=</span> <span class="n">current_i_index</span>
                <span class="n">raw2inner_id_items</span><span class="p">[</span><span class="n">irid</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_i_index</span>
                <span class="n">current_i_index</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">ur</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">iid</span><span class="p">,</span> <span class="n">r</span><span class="p">))</span>
            <span class="n">ir</span><span class="p">[</span><span class="n">iid</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">uid</span><span class="p">,</span> <span class="n">r</span><span class="p">))</span>

        <span class="n">n_users</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ur</span><span class="p">)</span>  <span class="c1"># number of users</span>
        <span class="n">n_items</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ir</span><span class="p">)</span>  <span class="c1"># number of items</span>
        <span class="n">n_ratings</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_trainset</span><span class="p">)</span>

        <span class="n">trainset</span> <span class="o">=</span> <span class="n">Trainset</span><span class="p">(</span><span class="n">ur</span><span class="p">,</span>
                            <span class="n">ir</span><span class="p">,</span>
                            <span class="n">n_users</span><span class="p">,</span>
                            <span class="n">n_items</span><span class="p">,</span>
                            <span class="n">n_ratings</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">rating_scale</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span>
                            <span class="n">raw2inner_id_users</span><span class="p">,</span>
                            <span class="n">raw2inner_id_items</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">trainset</span>

    <span class="k">def</span> <span class="nf">construct_testset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw_testset</span><span class="p">):</span>

        <span class="k">return</span> <span class="p">[(</span><span class="n">ruid</span><span class="p">,</span> <span class="n">riid</span><span class="p">,</span> <span class="n">r_ui_trans</span><span class="p">)</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">ruid</span><span class="p">,</span> <span class="n">riid</span><span class="p">,</span> <span class="n">r_ui_trans</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">raw_testset</span><span class="p">]</span></div>


<span class="k">class</span> <span class="nc">DatasetUserFolds</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A derived class from :class:`Dataset` for which folds (for</span>
<span class="sd">    cross-validation) are predefined.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folds_files</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reader</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">Dataset</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">folds_files</span> <span class="o">=</span> <span class="n">folds_files</span>

        <span class="c1"># check that all files actually exist.</span>
        <span class="k">for</span> <span class="n">train_test_files</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">folds_files</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">train_test_files</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">f</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;File &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; does not exist.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">raw_folds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">train_file</span><span class="p">,</span> <span class="n">test_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">folds_files</span><span class="p">:</span>
            <span class="n">raw_train_ratings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_ratings</span><span class="p">(</span><span class="n">train_file</span><span class="p">)</span>
            <span class="n">raw_test_ratings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_ratings</span><span class="p">(</span><span class="n">test_file</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">raw_train_ratings</span><span class="p">,</span> <span class="n">raw_test_ratings</span>


<div class="viewcode-block" id="DatasetAutoFolds"><a class="viewcode-back" href="../../dataset.html#surprise.dataset.DatasetAutoFolds">[docs]</a><span class="k">class</span> <span class="nc">DatasetAutoFolds</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A derived class from :class:`Dataset` for which folds (for</span>
<span class="sd">    cross-validation) are not predefined. (Or for when there are no folds at</span>
<span class="sd">    all).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ratings_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reader</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">Dataset</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_folds</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shuffle</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">ratings_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ratings_file</span> <span class="o">=</span> <span class="n">ratings_file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raw_ratings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_ratings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ratings_file</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raw_ratings</span> <span class="o">=</span> <span class="p">[(</span><span class="n">uid</span><span class="p">,</span> <span class="n">iid</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                                <span class="k">for</span> <span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">iid</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="ow">in</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">itertuples</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Must specify ratings file or dataframe.&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="DatasetAutoFolds.build_full_trainset"><a class="viewcode-back" href="../../dataset.html#surprise.dataset.DatasetAutoFolds.build_full_trainset">[docs]</a>    <span class="k">def</span> <span class="nf">build_full_trainset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Do not split the dataset into folds and just return a trainset as</span>
<span class="sd">        is, built from the whole dataset.</span>

<span class="sd">        User can then query for predictions, as shown in the :ref:`User Guide</span>
<span class="sd">        &lt;train_on_whole_trainset&gt;`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The :class:`Trainset`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct_trainset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_ratings</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">raw_folds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shuffle</span><span class="p">:</span>
            <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_ratings</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shuffle</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># set to false for future calls to raw_folds</span>

        <span class="k">def</span> <span class="nf">k_folds</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">n_folds</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Inspired from scikit learn KFold method.&quot;&quot;&quot;</span>

            <span class="k">if</span> <span class="n">n_folds</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="ow">or</span> <span class="n">n_folds</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Incorrect value for n_folds.&#39;</span><span class="p">)</span>

            <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">fold_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_folds</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                <span class="n">stop</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="o">//</span> <span class="n">n_folds</span>
                <span class="k">if</span> <span class="n">fold_i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="o">%</span> <span class="n">n_folds</span><span class="p">:</span>
                    <span class="n">stop</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">yield</span> <span class="n">seq</span><span class="p">[:</span><span class="n">start</span><span class="p">]</span> <span class="o">+</span> <span class="n">seq</span><span class="p">[</span><span class="n">stop</span><span class="p">:],</span> <span class="n">seq</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">k_folds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_ratings</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_folds</span><span class="p">)</span>

<div class="viewcode-block" id="DatasetAutoFolds.split"><a class="viewcode-back" href="../../dataset.html#surprise.dataset.DatasetAutoFolds.split">[docs]</a>    <span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_folds</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Split the dataset into folds for future cross-validation.</span>

<span class="sd">        If you forget to call :meth:`split`, the dataset will be automatically</span>
<span class="sd">        shuffled and split for 5-folds cross-validation.</span>

<span class="sd">        You can obtain repeatable splits over your all your experiments by</span>
<span class="sd">        seeding the RNG: ::</span>

<span class="sd">            import random</span>
<span class="sd">            random.seed(my_seed)  # call this before you call split!</span>

<span class="sd">        Args:</span>
<span class="sd">            n_folds(:obj:`int`): The number of folds.</span>
<span class="sd">            shuffle(:obj:`bool`): Whether to shuffle ratings before splitting.</span>
<span class="sd">                If ``False``, folds will always be the same each time the</span>
<span class="sd">                experiment is run. Default is ``True``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n_folds</span> <span class="o">=</span> <span class="n">n_folds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shuffle</span> <span class="o">=</span> <span class="n">shuffle</span></div></div>


<div class="viewcode-block" id="Reader"><a class="viewcode-back" href="../../dataset.html#surprise.dataset.Reader">[docs]</a><span class="k">class</span> <span class="nc">Reader</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;The Reader class is used to parse a file containing ratings.</span>

<span class="sd">    Such a file is assumed to specify only one rating per line, and each line</span>
<span class="sd">    needs to respect the following structure: ::</span>

<span class="sd">        user ; item ; rating ; [timestamp]</span>

<span class="sd">    where the order of the fields and the separator (here &#39;;&#39;) may be</span>
<span class="sd">    arbitrarily defined (see below).  brackets indicate that the timestamp</span>
<span class="sd">    field is optional.</span>


<span class="sd">    Args:</span>
<span class="sd">        name(:obj:`string`, optional): If specified, a Reader for one of the</span>
<span class="sd">            built-in datasets is returned and any other parameter is ignored.</span>
<span class="sd">            Accepted values are &#39;ml-100k&#39;, &#39;ml-1m&#39;, and &#39;jester&#39;. Default</span>
<span class="sd">            is ``None``.</span>
<span class="sd">        line_format(:obj:`string`): The fields names, in the order at which</span>
<span class="sd">            they are encountered on a line. Default is ``&#39;user item rating&#39;``.</span>
<span class="sd">        sep(char): the separator between fields. Example : ``&#39;;&#39;``.</span>
<span class="sd">        rating_scale(:obj:`tuple`, optional): The rating scale used for every</span>
<span class="sd">            rating.  Default is ``(1, 5)``.</span>
<span class="sd">        skip_lines(:obj:`int`, optional): Number of lines to skip at the</span>
<span class="sd">            beginning of the file. Default is ``0``.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">line_format</span><span class="o">=</span><span class="s1">&#39;user item rating&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">rating_scale</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">skip_lines</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">BUILTIN_DATASETS</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">reader_params</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;unknown reader &#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span>
                                 <span class="s1">&#39;. Accepted values are &#39;</span> <span class="o">+</span>
                                 <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BUILTIN_DATASETS</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sep</span> <span class="o">=</span> <span class="n">sep</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skip_lines</span> <span class="o">=</span> <span class="n">skip_lines</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rating_scale</span> <span class="o">=</span> <span class="n">rating_scale</span>

            <span class="n">lower_bound</span><span class="p">,</span> <span class="n">higher_bound</span> <span class="o">=</span> <span class="n">rating_scale</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="o">-</span><span class="n">lower_bound</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">lower_bound</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

            <span class="n">splitted_format</span> <span class="o">=</span> <span class="n">line_format</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

            <span class="n">entities</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;item&#39;</span><span class="p">,</span> <span class="s1">&#39;rating&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="n">splitted_format</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">with_timestamp</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">entities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">with_timestamp</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># check that all fields are correct</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">entities</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">splitted_format</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;line_format parameter is incorrect.&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">indexes</span> <span class="o">=</span> <span class="p">[</span><span class="n">splitted_format</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span> <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span>
                            <span class="n">entities</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">parse_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Parse a line.</span>

<span class="sd">        Ratings are translated so that they are all strictly positive.</span>

<span class="sd">        Args:</span>
<span class="sd">            line(str): The line to parse</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: User id, item id, rating and timestamp. The timestamp is set</span>
<span class="sd">            to ``None`` if it does no exist.</span>
<span class="sd">            &#39;&#39;&#39;</span>

        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_timestamp</span><span class="p">:</span>
                <span class="n">uid</span><span class="p">,</span> <span class="n">iid</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">timestamp</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                                          <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">uid</span><span class="p">,</span> <span class="n">iid</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                               <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="p">)</span>
                <span class="n">timestamp</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span><span class="s1">&#39;Impossible to parse line.&#39;</span> <span class="o">+</span>
                              <span class="s1">&#39; Check the line_format  and sep parameters.&#39;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">uid</span><span class="p">,</span> <span class="n">iid</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="n">timestamp</span></div>


<div class="viewcode-block" id="Trainset"><a class="viewcode-back" href="../../dataset.html#surprise.dataset.Trainset">[docs]</a><span class="k">class</span> <span class="nc">Trainset</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A trainset contains all useful data that constitutes a training set.</span>

<span class="sd">    It is used by the :meth:`train()</span>
<span class="sd">    &lt;surprise.prediction_algorithms.algo_base.AlgoBase.train&gt;` method of every</span>
<span class="sd">    prediction algorithm. You should not try to built such an object on your</span>
<span class="sd">    own but rather use the :meth:`Dataset.folds` method or the</span>
<span class="sd">    :meth:`DatasetAutoFolds.build_full_trainset` method.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        ur(:obj:`defaultdict` of :obj:`list`): The users ratings. This is a</span>
<span class="sd">            dictionary containing lists of tuples of the form ``(item_inner_id,</span>
<span class="sd">            rating)``. The keys are user inner ids.</span>
<span class="sd">        ir(:obj:`defaultdict` of :obj:`list`): The items ratings. This is a</span>
<span class="sd">            dictionary containing lists of tuples of the form ``(user_inner_id,</span>
<span class="sd">            rating)``. The keys are item inner ids.</span>
<span class="sd">        n_users: Total number of users :math:`|U|`.</span>
<span class="sd">        n_items: Total number of items :math:`|I|`.</span>
<span class="sd">        n_ratings: Total number of ratings :math:`|R_{train}|`.</span>
<span class="sd">        rating_scale(tuple): The minimum and maximal rating of the rating</span>
<span class="sd">            scale.</span>
<span class="sd">        global_mean: The mean of all ratings :math:`\\mu`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ur</span><span class="p">,</span> <span class="n">ir</span><span class="p">,</span> <span class="n">n_users</span><span class="p">,</span> <span class="n">n_items</span><span class="p">,</span> <span class="n">n_ratings</span><span class="p">,</span> <span class="n">rating_scale</span><span class="p">,</span>
                 <span class="n">offset</span><span class="p">,</span> <span class="n">raw2inner_id_users</span><span class="p">,</span> <span class="n">raw2inner_id_items</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ur</span> <span class="o">=</span> <span class="n">ur</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ir</span> <span class="o">=</span> <span class="n">ir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_users</span> <span class="o">=</span> <span class="n">n_users</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_items</span> <span class="o">=</span> <span class="n">n_items</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_ratings</span> <span class="o">=</span> <span class="n">n_ratings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rating_scale</span> <span class="o">=</span> <span class="n">rating_scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raw2inner_id_users</span> <span class="o">=</span> <span class="n">raw2inner_id_users</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raw2inner_id_items</span> <span class="o">=</span> <span class="n">raw2inner_id_items</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_global_mean</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># inner2raw dicts could be built right now (or even before) but they</span>
        <span class="c1"># are not always useful so we wait until we need them.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inner2raw_id_users</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inner2raw_id_items</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Trainset.knows_user"><a class="viewcode-back" href="../../dataset.html#surprise.dataset.Trainset.knows_user">[docs]</a>    <span class="k">def</span> <span class="nf">knows_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Indicate if the user is part of the trainset.</span>

<span class="sd">        A user is part of the trainset if the user has at least one rating.</span>

<span class="sd">        Args:</span>
<span class="sd">            uid(int): The (inner) user id. See :ref:`this</span>
<span class="sd">                note&lt;raw_inner_note&gt;`.</span>
<span class="sd">        Returns:</span>
<span class="sd">            ``True`` if user is part of the trainset, else ``False``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">uid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ur</span></div>

<div class="viewcode-block" id="Trainset.knows_item"><a class="viewcode-back" href="../../dataset.html#surprise.dataset.Trainset.knows_item">[docs]</a>    <span class="k">def</span> <span class="nf">knows_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Indicate if the item is part of the trainset.</span>

<span class="sd">        An item is part of the trainset if the item was rated at least once.</span>

<span class="sd">        Args:</span>
<span class="sd">            iid(int): The (inner) item id. See :ref:`this</span>
<span class="sd">                note&lt;raw_inner_note&gt;`.</span>
<span class="sd">        Returns:</span>
<span class="sd">            ``True`` if item is part of the trainset, else ``False``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">iid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ir</span></div>

<div class="viewcode-block" id="Trainset.to_inner_uid"><a class="viewcode-back" href="../../dataset.html#surprise.dataset.Trainset.to_inner_uid">[docs]</a>    <span class="k">def</span> <span class="nf">to_inner_uid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ruid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a **user** raw id to an inner id.</span>

<span class="sd">        See :ref:`this note&lt;raw_inner_note&gt;`.</span>

<span class="sd">        Args:</span>
<span class="sd">            ruid(str): The user raw id.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: The user inner id.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: When user is not part of the trainset.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw2inner_id_users</span><span class="p">[</span><span class="n">ruid</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span><span class="s1">&#39;User &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ruid</span><span class="p">)</span> <span class="o">+</span>
                              <span class="s1">&#39; is not part of the trainset.&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="Trainset.to_raw_uid"><a class="viewcode-back" href="../../dataset.html#surprise.dataset.Trainset.to_raw_uid">[docs]</a>    <span class="k">def</span> <span class="nf">to_raw_uid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iuid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a **user** inner id to a raw id.</span>

<span class="sd">        See :ref:`this note&lt;raw_inner_note&gt;`.</span>

<span class="sd">        Args:</span>
<span class="sd">            iuid(int): The user inner id.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The user raw id.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: When ``iuid`` is not an inner id.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner2raw_id_users</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inner2raw_id_users</span> <span class="o">=</span> <span class="p">{</span><span class="n">inner</span><span class="p">:</span> <span class="n">raw</span> <span class="k">for</span> <span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">inner</span><span class="p">)</span> <span class="ow">in</span>
                                        <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw2inner_id_users</span><span class="p">)}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner2raw_id_users</span><span class="p">[</span><span class="n">iuid</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">iuid</span><span class="p">)</span> <span class="o">+</span>
                              <span class="s1">&#39; is not a valid inner id.&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="Trainset.to_inner_iid"><a class="viewcode-back" href="../../dataset.html#surprise.dataset.Trainset.to_inner_iid">[docs]</a>    <span class="k">def</span> <span class="nf">to_inner_iid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">riid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert an **item** raw id to an inner id.</span>

<span class="sd">        See :ref:`this note&lt;raw_inner_note&gt;`.</span>

<span class="sd">        Args:</span>
<span class="sd">            riid(str): The item raw id.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: The item inner id.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: When item is not part of the trainset.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw2inner_id_items</span><span class="p">[</span><span class="n">riid</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span><span class="s1">&#39;Item &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">riid</span><span class="p">)</span> <span class="o">+</span>
                              <span class="s1">&#39; is not part of the trainset.&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="Trainset.to_raw_iid"><a class="viewcode-back" href="../../dataset.html#surprise.dataset.Trainset.to_raw_iid">[docs]</a>    <span class="k">def</span> <span class="nf">to_raw_iid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iiid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert an **item** inner id to a raw id.</span>

<span class="sd">        See :ref:`this note&lt;raw_inner_note&gt;`.</span>

<span class="sd">        Args:</span>
<span class="sd">            iiid(int): The item inner id.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The item raw id.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: When ``iiid`` is not an inner id.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner2raw_id_items</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inner2raw_id_items</span> <span class="o">=</span> <span class="p">{</span><span class="n">inner</span><span class="p">:</span> <span class="n">raw</span> <span class="k">for</span> <span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">inner</span><span class="p">)</span> <span class="ow">in</span>
                                        <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw2inner_id_items</span><span class="p">)}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner2raw_id_items</span><span class="p">[</span><span class="n">iiid</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">iiid</span><span class="p">)</span> <span class="o">+</span>
                              <span class="s1">&#39; is not a valid inner id.&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="Trainset.all_ratings"><a class="viewcode-back" href="../../dataset.html#surprise.dataset.Trainset.all_ratings">[docs]</a>    <span class="k">def</span> <span class="nf">all_ratings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generator function to iterate over all ratings.</span>

<span class="sd">        Yields:</span>
<span class="sd">            A tuple ``(uid, iid, rating)`` where ids are inner ids (see</span>
<span class="sd">            :ref:`this note &lt;raw_inner_note&gt;`).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">u_ratings</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ur</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">u_ratings</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">u</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span></div>

<div class="viewcode-block" id="Trainset.build_testset"><a class="viewcode-back" href="../../dataset.html#surprise.dataset.Trainset.build_testset">[docs]</a>    <span class="k">def</span> <span class="nf">build_testset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of ratings that can be used as a testset in the</span>
<span class="sd">        :meth:`test() &lt;surprise.prediction_algorithms.algo_base.AlgoBase.test&gt;`</span>
<span class="sd">        method.</span>

<span class="sd">        The ratings are all the ratings that are in the trainset, i.e. all the</span>
<span class="sd">        ratings returned by the :meth:`all_ratings()</span>
<span class="sd">        &lt;surprise.dataset.Trainset.all_ratings&gt;` generator. This is useful in</span>
<span class="sd">        cases where you want to to test your algorithm on the trainset.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_raw_uid</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_raw_iid</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">r</span><span class="p">)</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_ratings</span><span class="p">()]</span></div>

<div class="viewcode-block" id="Trainset.build_anti_testset"><a class="viewcode-back" href="../../dataset.html#surprise.dataset.Trainset.build_anti_testset">[docs]</a>    <span class="k">def</span> <span class="nf">build_anti_testset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of ratings that can be used as a testset in the</span>
<span class="sd">        :meth:`test() &lt;surprise.prediction_algorithms.algo_base.AlgoBase.test&gt;`</span>
<span class="sd">        method.</span>

<span class="sd">        The ratings are all the ratings that are **not** in the trainset, i.e.</span>
<span class="sd">        all the ratings :math:`r_{ui}` where the user :math:`u` is known, the</span>
<span class="sd">        item :math:`i` is known, but the rating :math:`r_{ui}`  is not in the</span>
<span class="sd">        trainset. As :math:`r_{ui}` is unknown, it is assumed to be equal to</span>
<span class="sd">        the mean of all ratings :meth:`global_mean</span>
<span class="sd">        &lt;surprise.dataset.Trainset.global_mean&gt;`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">anti_testset</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_users</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_items</span><span class="p">():</span>
                <span class="n">user_items</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ur</span><span class="p">[</span><span class="n">u</span><span class="p">]]</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">user_items</span><span class="p">:</span>
                    <span class="n">r_ui</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_raw_uid</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_raw_iid</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">global_mean</span><span class="p">)</span>
                    <span class="n">anti_testset</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_ui</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">anti_testset</span></div>

<div class="viewcode-block" id="Trainset.all_users"><a class="viewcode-back" href="../../dataset.html#surprise.dataset.Trainset.all_users">[docs]</a>    <span class="k">def</span> <span class="nf">all_users</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generator function to iterate over all users.</span>

<span class="sd">        Yields:</span>
<span class="sd">            Inner id of users.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_users</span><span class="p">)</span></div>

<div class="viewcode-block" id="Trainset.all_items"><a class="viewcode-back" href="../../dataset.html#surprise.dataset.Trainset.all_items">[docs]</a>    <span class="k">def</span> <span class="nf">all_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generator function to iterate over all items.</span>

<span class="sd">        Yields:</span>
<span class="sd">            Inner id of items.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_items</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">global_mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the mean of all ratings.</span>

<span class="sd">        It&#39;s only computed once.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_global_mean</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_global_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="ow">in</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">all_ratings</span><span class="p">()])</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_global_mean</span></div>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Nicolas Hug.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>